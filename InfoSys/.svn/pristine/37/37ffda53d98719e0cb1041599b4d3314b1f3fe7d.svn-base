<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:p="http://primefaces.org/ui" xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets">
<h:head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<h:outputStylesheet library="css" name="styles.css" />
	<h:outputStylesheet library="css" name="grid.css" />
	<h:outputStylesheet library="css" name="bootstrap.css" />
	<h:outputScript name="utilities.js" library="javascript" target="head" />
	<script type="text/javascript">
		window.onkeypress = function(e) {
			var keyCode = window.event.keyCode || e.keyCode || e.which;
			if (keyCode == '13') {
				document.getElementById('searchInfoForm:searchInfoBtnID').click();
				return false;
			}
		};

		function back() {
			window.close();
		}

		function selectInfo(callerId) {
			var idTokens = callerId.split(':');
			var infoId = document.getElementById('searchInfoForm:infoListDataTableId:' + idTokens[2] + ':infoId').value;
			var infoNumber = document.getElementById('searchInfoForm:infoListDataTableId:' + idTokens[2] + ':infoNumberId').innerHTML;
			returnVal = new Array();
			returnVal[0] = infoId;
			returnVal[1] = infoNumber;
			window.returnValue = returnVal;

			window.opener.HandlePopupResult(returnVal);
			window.close();
		}

		function handleDownloadFiles(e) {
			openDownloadPopupFlagId = document.getElementById('searchInfoForm:openDownloadPopupFlagId').value;
			openDownloadDialogueFlagId = document.getElementById('searchInfoForm:openDownloadDialogueFlagId').value;

			if (e.status == 'success') {
				if (openDownloadPopupFlagId == 'true') {
					downloadFile();
				} else if (openDownloadDialogueFlagId == 'true') {
					PF('dlg').show();
				}
			}
		}

		function downloadFile() {
			downloadedFileParamId = document.getElementById('searchInfoForm:downloadedFileParamId').value;
			openDownloadFile('#{followUpLetters.boolServerDownloadPath}', downloadedFileParamId);
			return false;
		}

		window.onunload = unloadPage;
		function unloadPage() {
			window.opener.releaseMask();
		}
	</script>
</h:head>
<h:body styleClass="screenBg" onunload="unloadPage();">
	<h:form id="searchInfoForm" dir="#{msgs.dir}">
		<ui:decorate template="/Main/Template.xhtml">
			<table border="0" cellpadding="0" cellspacing="0" width="100%" class="bgcolor-pup">

				<tr>
					<td width="100%" height="5" />
				</tr>
				<tr>
					<td class="screenTitle">
						<h:outputText value="#{msgs.title_followUpLetters}" />
					</td>
				</tr>
				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td width="100%">
						<h:panelGroup id="sectionFollowUpDataId">
							<table class="sectionContent" border="0" cellpadding="0" cellspacing="0">
								<tr>
									<th width="10%">
										<h:outputText value="#{msgs.label_contactNumber}" />
										<h:outputText value="*" style="color:red;" />
									</th>
									<td width="40%">
										<h:inputText disabled="true" value="#{followUpLetters.followUpData.contactNumber}" />
									</td>
									<td width="50%" colspan="4"></td>
								</tr>
								<tr>
									<td width="100%;" colspan="6">
										<p:accordionPanel activeIndex="-1">
											<p:tab title="#{msgs.title_followUpLetters}">
												<h:panelGroup id="infoListId">
													<p:dataTable var="result" value="#{followUpLetters.letterData}" widgetVar="followUpLetters" emptyMessage="#{msgs.title_emptyFollowUpLetters}" paginator="true" rowHover="true" reflow="true" filteredValue="#{followUpLetters.filteredLetterData}">
														<p:column style="text-align: center;">
															<f:facet name="header"> # </f:facet>
							                                #{index + 1}
							                            </p:column>

														<p:column filterBy="#{result.letterNumber}" headerText="#{msgs.label_letterNumber}" filterMatchMode="contains">
															<h:outputText value="#{result.letterNumber}" />
														</p:column>

														<p:column filterBy="#{result.letterDateString}" headerText="#{msgs.label_dateD}" filterMatchMode="contains">
															<h:outputText value="#{result.letterDateString}" />
														</p:column>

														<p:column filterBy="#{result.type}" headerText="#{msgs.label_letterType}" filterMatchMode="exact">
															<f:facet name="filter">
																<p:selectOneMenu onchange="PF('followUpLetters').filter()" style="width:100%">
																	<f:selectItem itemLabel="#{msgs.label_all}" itemValue="#{null}" />
																	<f:selectItem itemLabel="#{msgs.label_incoming}" itemValue="0" />
																	<f:selectItem itemLabel="#{msgs.label_issued}" itemValue="1" />
																</p:selectOneMenu>
															</f:facet>
															<h:outputText rendered="#{result.type == 0}" value="#{msgs.label_incoming}" style="width:100%" />
															<h:outputText rendered="#{result.type == 1}" value="#{msgs.label_issued}" style="width:100%" />
														</p:column>


														<p:column filterBy="#{result.organization}" headerText="#{msgs.label_unitSource}" filterMatchMode="contains">
															<h:outputText value="#{result.organization}" />
														</p:column>

														<p:column filterBy="#{result.notes}" headerText="#{msgs.label_comment}" filterMatchMode="contains">
															<h:outputText value="#{result.notes}" />
														</p:column>
														
														<p:column styleClass='centerText'>
															<f:facet name="header"> #{msgs.label_view} </f:facet>
															<h:commandButton value="&#xF0F6;" styleClass="btn btn-trans-icon" onclick="this.form.target='_blank'" action="#{followUpLetters.viewFollowUpLetters(result)}" />
														</p:column>

														<p:column styleClass='centerText'>
															<f:facet name="header"> #{msgs.label_edit} </f:facet>
															<h:commandButton value="&#xf14b;" styleClass="btn btn-trans-icon" onclick="this.form.target='_blank'" action="#{followUpLetters.editFollowUpLetters(result)}" />
														</p:column>

														<p:column styleClass='centerText' headerText="#{msgs.label_archiveDocumentsShow}">
															<h:commandButton styleClass="btn btn-success" value="&#xf0c5; #{msgs.label_archiveDocumentsShow}">
																<f:ajax render="searchInfoForm:downloadDlgPanelId searchInfoForm:openDownloadDialogueFlagId searchInfoForm:openDownloadPopupFlagId searchInfoForm:downloadedFileParamId" listener="#{followUpLetters.getDownloadedAttachmentsIdList(result.id)}" onevent="handleDownloadFiles" />
															</h:commandButton>
														</p:column>

													</p:dataTable>
												</h:panelGroup>
											</p:tab>
										</p:accordionPanel>
									</td>
								</tr>
							</table>
						</h:panelGroup>
					</td>
				</tr>
				<tr>
					<td width="100%">
						<h:panelGroup id="downloadDlgPanelId">
							<p:dialog dir="#{msgs.dir}" header="#{msgs.label_archiveDocumentsShow}" id="dlgId" widgetVar="dlg" modal="true" height="180px;" width="720px">
								<h:panelGroup id="internalDlgPanelId">
									<table width="100%">
										<tr>
											<td>
												<p:dataTable tableStyle="table-layout:auto" reflow="true" liveResize="true" paginatorPosition="bottom" id="fileListIds" paginator="true" style="width:100%" rowIndexVar="index" rows="10" var="row" value="#{followUpLetters.attachmentList}" widgetVar="table" rowHover="true">
													<p:column styleClass='centerText'>
														<f:facet name="header">#</f:facet>
					                                    #{index + 1}
				                                   	</p:column>
													<p:column styleClass='centerText'>
														<f:facet name="header">
																#{msgs.label_fileName}
															</f:facet>
														<h:outputText value="#{row.fileName}" />
													</p:column>
													<p:column styleClass='centerText'>
														<f:facet name="header">
															#{msgs.label_download}
														</f:facet>
														<h:commandButton styleClass="btn btn-success" value="&#xf019; #{msgs.label_download}">
															<f:ajax render="searchInfoForm:internalDlgPanelId searchInfoForm:downloadedFileParamId" listener="#{followUpLetters.getDownloadParam(row.attachmentId)}" onevent="function(e){if(e.status == 'success') return downloadFile();}" />
														</h:commandButton>
													</p:column>
												</p:dataTable>
											</td>
										</tr>
									</table>
								</h:panelGroup>
							</p:dialog>
							<h:inputHidden id="downloadedFileParamId" value="#{followUpLetters.downloadFileParamId}" />
							<h:inputHidden id="openDownloadPopupFlagId" value="#{followUpLetters.openDownloadPopupFlag}" />
							<h:inputHidden id="openDownloadDialogueFlagId" value="#{followUpLetters.openDownloadDialogueFlag}" />
						</h:panelGroup>
					</td>
				</tr>
			</table>
		</ui:decorate>
	</h:form>
</h:body>
</html>