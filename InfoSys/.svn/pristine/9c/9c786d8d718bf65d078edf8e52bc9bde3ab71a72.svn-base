
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:p="http://primefaces.org/ui" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:f="http://java.sun.com/jsf/core" xmlns:util="http://java.sun.com/jsf/composite/util" xmlns:code="http://java.sun.com/jsf/composite/code">
<h:head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<h:outputStylesheet library="css" name="styles.css" />
	<h:outputStylesheet library="css" name="grid.css" />
	<h:outputStylesheet library="css" name="bootstrap.css" />
	<h:outputScript name="utilities.js" library="javascript" target="head" />
	<script type="text/javascript">
		var mode;
		function getUnit(contextPath) {
			mode = 11;
			sectorId = document.getElementById('formId:selectedSectorId').value;
			sectorIds = document.getElementById('formId:sectorIdsId').value;
			openDepartmentsMiniSearch(contextPath, 6, sectorId == '' || sectorId == null ? sectorIds : sectorId, null);
			return false;
		}

		function openCommunicationNodes(contextPath, followUpId) {
			mode = 3;
			var modeCommunication = 1;
			var followUp = followUpId;
			openCommunicationNodesMiniSearch(contextPath, followUp, modeCommunication);
			return false;
		}
		function getNetwork(contextPath) {
			mode = 1;
			openNetworksMiniSearch(contextPath);
			return false;
		}

		function HandlePopupResult(ret) {
			unMaskScreen();
			if (ret != null) {
				if (mode == 1) {
					document.getElementById('formId:followUpAdvancedSearchPanelId:selectedNetworkIdId').value = ret[0];
					document.getElementById('formId:followUpAdvancedSearchPanelId:selectedNetworkNumberId').value = ret[1];
				} else if (mode == 2) {
					document.getElementById('formId:selectedFollowUpId').value = ret[0];
					document.getElementById('formId:selectedFollowUpCodeId').value = ret[1];
				}
				return true;
			}
			return false;
		}

		function releaseMask() {
			unMaskScreen();
		}
	</script>
</h:head>
<h:body styleClass="screenBg">
	<h:form id="formId" dir="#{msgs.dir}">
		<ui:decorate template="/Main/Template.xhtml">
			<table border="0" cellpadding="0" cellspacing="0" width="100%">
				<tr>
					<td width="100%" height="0" />
				</tr>

				<tr>
					<td class="screenTitle">
						<h:outputText value="#{msgs.title_followUpManagement}" />
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td colspan="2">
						<table class="sectionTitle" border="0" cellpadding="0" cellspacing="0">
							<tr>
								<td>
									<h:outputText value="#{msgs.label_searchData}" />
								</td>
							</tr>
						</table>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td width="100%">
						<h:panelGroup id="followUpSearchPanelId">
							<table class="sectionContent" border="0" cellpadding="0" cellspacing="0">
								<tr>
									<th width="15%">#{msgs.label_contactNumber}</th>
									<td width="20%">
										<h:inputText styleClass="form-control" maxlength="15" value="#{followUpManagement.selectedContactNum}" style="width: 75%;margin-left: 5px;" />
									</td>
									<th width="15%">#{msgs.label_ghostSocialId}</th>
									<td width="20%">
										<h:inputText styleClass="form-control" value="#{followUpManagement.selectedSocialId}" maxlength="10" onkeypress="return checkDigit(event)" />
									</td>

								</tr>
								<tr>
									<th width="15%">#{msgs.label_ghostName}</th>
									<td width="20%">
										<h:inputText styleClass="form-control" value="#{followUpManagement.selectedGhostName}" />
									</td>
									<th width="15%">#{msgs.label_theCode}</th>
									<td  width="20%">
										<h:inputText styleClass="form-control" value="#{followUpManagement.selectedCode}" />
									</td>
								</tr>
							</table>
						</h:panelGroup>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td width="100%;" colspan="6">
						<p:accordionPanel id="followUpAdvancedSearchPanelId" activeIndex="-1">
							<p:tab title="#{msgs.label_advancedSearch}">
								<h:panelGroup id="followupAdvancedSearchId">
									<table class="sectionContent" border="0" cellpadding="0" cellspacing="0" width="100%">
										<tr>
											<th width="15%">#{msgs.label_region}</th>
											<td width="20%">
												<h:selectOneMenu styleClass="form-control" value="#{followUpManagement.selectedRegionId}">
													<f:selectItem itemValue="-1" itemLabel="#{msgs.label_all}" />
													<f:selectItems value="#{followUpManagement.regionsList}" var="region" itemLabel="#{region.regionName}" itemValue="#{region.id}" />
													<f:ajax event="change" execute="@this" render="formId:followUpAdvancedSearchPanelId:sectorListPanelId" listener="#{followUpManagement.getRegionSectors()}" />
												</h:selectOneMenu>
											</td>

											<th width="15%;">
												<h:outputText value="#{msgs.label_startFollowUpDate}" />
											</th>
											<td width="20%">
												<util:advancedHijriDate value="#{followUpManagement.followUpStartDate}" />
											</td>

										</tr>
										<tr>
											<th width="15%">#{msgs.label_sector}</th>
											<td width="20%">
												<h:panelGroup id="sectorListPanelId">
													<h:selectOneMenu styleClass="form-control" value="#{followUpManagement.selectedSectorId}">
														<f:selectItem itemValue="" itemLabel=" " />
														<f:selectItems value="#{followUpManagement.sectorsList}" var="sector" itemLabel="#{sector.arabicName}" itemValue="#{sector.id}" />
													</h:selectOneMenu>
												</h:panelGroup>
											</td>

											<th width="15%;">
												<h:outputText value="#{msgs.label_endFollowUpDate}" />
											</th>
											<td width="20%">
												<util:advancedHijriDate value="#{followUpManagement.followUpEndDate}" />
											</td>

										</tr>
										<tr>
											<th width="15%">#{msgs.label_network}</th>
											<td width="20%">
												<h:inputText style="width:90%" disabled="true" id="selectedNetworkNumberId" value="#{followUpManagement.selectedNetworkNumber}" />
												<h:inputHidden id="selectedNetworkIdId" value="#{followUpManagement.selectedNetworkId}" />
												<h:commandButton value="&#xf002;" styleClass="btn btn-trans-icon" onclick="return getNetwork('#{request.contextPath}');" />
											</td>
											<th width="15%">#{msgs.label_direct}</th>
											<td width="20%">
												<h:selectOneMenu id="directFlagId" value="#{followUpManagement.directFlag}" styleClass="form-control">
													<f:selectItem itemLabel="#{msgs.label_all}" itemValue="-1" />
													<f:selectItem itemLabel="#{msgs.label_yes}" itemValue="1" />
													<f:selectItem itemLabel="#{msgs.label_no}" itemValue="0" />
												</h:selectOneMenu>
											</td>
										</tr>
										<tr>
											<th width="15%">#{msgs.label_followUpCaseType}</th>
											<td width="20%">
												<h:selectOneMenu styleClass="form-control" value="#{followUpManagement.domainIdCasesType}">
													<f:selectItem itemValue="#{null}" itemLabel="#{msgs.label_all}" />
													<f:selectItems value="#{followUpManagement.casesTypeDomainList}" var="casesType" itemLabel="#{casesType.description}" itemValue="#{casesType.id}" />
												</h:selectOneMenu>
											</td>
											<th width="15%"></th>
											<td width="20%"></td>

										</tr>

										<tr>
											<th width="15%">#{msgs.label_conversationType}</th>
											<td width="20%">
												<h:selectOneMenu id="conversationTypeId" value="#{followUpManagement.conversationType}" styleClass="form-control">
													<f:selectItem noSelectionOption="true" itemLabel="#{msgs.label_all}" itemValue="-1" />
													<f:selectItem itemLabel="#{msgs.label_direct}" itemValue="0" />
													<f:selectItem itemLabel="#{msgs.label_injection}" itemValue="1" />
												</h:selectOneMenu>
											</td>

											<th width="15%">#{msgs.label_conversationResult}</th>
											<td width="20%">
												<h:selectOneMenu id="conversationResultId" value="#{followUpManagement.conversationResult}" styleClass="form-control">
													<f:selectItem itemLabel="#{msgs.label_all}" itemValue="-1" />
													<f:selectItem itemLabel="#{msgs.label_conversationNoResults}" itemValue="0" />
													<f:selectItem itemLabel="#{msgs.label_negative}" itemValue="1" />
													<f:selectItem itemLabel="#{msgs.label_positive}" itemValue="2" />
												</h:selectOneMenu>
											</td>
										</tr>

										<tr>
											<th width="15%;">
												<h:outputText value="#{msgs.label_conversationFromDate}" />
											</th>
											<td width="20%">
												<util:advancedHijriDate value="#{followUpManagement.fromDateConversation}" />
											</td>
											<th width="15%;">
												<h:outputText value="#{msgs.label_conversationToDate}" />
											</th>
											<td width="20%">
												<util:advancedHijriDate value="#{followUpManagement.toDateConversation}" />
											</td>

										</tr>

										<tr>
											<th width="15%;">
												<h:outputText value="#{msgs.label_conversationLocation}" />
											</th>
											<td>
												<code:coordinates latitude="#{followUpManagement.coordinateLatitude}" longitude="#{followUpManagement.coordinateLongitude}" />
											</td>
											<th width="15%;">
												<h:outputText value="#{msgs.label_conversationDetailsData}" />
											</th>
											<td>
												<h:inputTextarea value="#{followUpManagement.conversationDetails}" /> 
											</td>
										</tr>
										<tr>
											<th width="15%">#{msgs.label_followUpResultType}</th>
											<td width="20%">
												<h:selectOneMenu id="followUpResultChoiceId" value="#{followUpManagement.followUpResultChoiceId}" styleClass="form-control">
													<f:selectItem itemLabel="#{msgs.label_all}" itemValue="-1" />
													<f:selectItems value="#{followUpManagement.followUpResultsList}" var="item" itemLabel="#{item.description}" itemValue="#{item.id}" />
												</h:selectOneMenu>
											</td>
											<th width="15%;">
												<h:outputText value="#{msgs.label_conversationContactNumber}" />
											</th>
											<td>
												<h:inputText styleClass="form-control" maxlength="15"  value="#{followUpManagement.contactNumber}" />
											</td>
										</tr>

										<tr>
											<th width="15%;">
												<h:outputText value="#{msgs.label_fromDate}" />
											</th>
											<td width="20%">
												<util:advancedHijriDate value="#{followUpManagement.fromDateResult}" />
											</td>
											<th width="15%;">
												<h:outputText value="#{msgs.label_toDate}" />
											</th>
											<td>
												<util:advancedHijriDate value="#{followUpManagement.toDateResult}" />
											</td>

										</tr>
									</table>
								</h:panelGroup>
							</p:tab>
						</p:accordionPanel>
					</td>
				</tr>
				<tr>
					<td width="100%" height="5" />
				</tr>
				<tr>
					<td>
						<table class="actionsSection" border="0" cellpadding="0" cellspacing="0" width="100%">
							<tr>
								<td>
									<h:commandButton id="resetBtnId" styleClass="btn btn-default" value="&#xf021; #{msgs.label_reset}" action="#{followUpManagement.init()}">
										<f:ajax render="formId:followUpsPanelId formId:followUpAdvancedSearchPanelId formId:followUpSearchPanelId" />
									</h:commandButton>
									<h:commandButton id="advancedSearchBtnId" styleClass="btn btn-default" value="&#xf002; #{msgs.label_search}" action="#{followUpManagement.searchFollowUps()}">
										<f:ajax render="formId:followUpsPanelId" execute="formId:followUpAdvancedSearchPanelId formId:followUpSearchPanelId" />
									</h:commandButton>
								</td>
							</tr>
						</table>
					</td>
				</tr>
				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td>
						<h:panelGroup id="classesPaneId">
							<table width="100%">
								<tr>
									<td>
										<table width="100%">
											<tr>
												<td colspan="2">
													<table class="sectionTitle" border="0" cellpadding="0" cellspacing="0">
														<tr>
															<td>
																<h:outputText value="#{msgs.title_searchResults}" />
															</td>
														</tr>

													</table>
												</td>
											</tr>
											<tr>
												<td height="20px"></td>
											</tr>
											<tr>
												<td align="center" width="100%">
													<h:panelGroup id="followUpsPanelId">
														<p:dataTable sortMode="multiple" reflow="true" tableStyle="table-layout: auto" paginator="true" id="followUpsId" rows="#{followUpManagement.rowsCount}" rowIndexVar="index" var="row" value="#{followUpManagement.followUpDataList}" rowHover="true">
															<p:column styleClass='centerText'>
																<f:facet name="header">#</f:facet>
					                                            #{index + 1}
					                                    </p:column>
															<p:column styleClass='centerText'>
																<f:facet name="header">#{msgs.label_contactNumber}</f:facet>
																<h:outputText value="#{row.contactNumber}" />
															</p:column>
															<p:column styleClass='centerText'>
																<f:facet name="header">#{msgs.label_followUpCode}</f:facet>
																<h:outputText value="#{row.code}" />

																<h:inputHidden id="followUpIdId" value="#{row.id}" />
																<h:inputHidden id="followUpCodeId" value="#{row.code}" />

															</p:column>
															<p:column styleClass='centerText'>
																<f:facet name="header">#{msgs.label_aliasName}</f:facet>
																<h:outputText value="#{row.aliasName}" />
															</p:column>
															<p:column styleClass='centerText'>
																<f:facet name="header">#{msgs.label_startingDate}</f:facet>
																<h:outputText value="#{row.followUpStartDateString}" />
															</p:column>
															<p:column styleClass='centerText'>
																<f:facet name="header">#{msgs.label_endingDate}</f:facet>
																<h:outputText value="#{row.followUpEndDateString}" />
															</p:column>
															<p:column styleClass='centerText'>
																<f:facet name="header">#{msgs.label_followUpDirect}</f:facet>
																<h:outputText value="#{row.directFlag? msgs.label_followUpDirect : msgs.label_followUpNotDirect}" />
															</p:column>
															<p:column styleClass='centerText'>
																<f:facet name="header">#{msgs.label_followUpStatus}</f:facet>
																<h:outputText value="#{msgs.label_active}" rendered="#{row.status == 0}" />
																<h:outputText value="#{msgs.label_suspended}" rendered="#{row.status == 1}" />
																<h:outputText value="#{msgs.label_finished}" rendered="#{row.status == 3}" />
															</p:column>
															<p:column styleClass='centerText'>
																<f:facet name="header"> #{msgs.label_contactCodes} </f:facet>
																<h:commandButton id="contactCodeBtnId" value="&#xf095;" styleClass="btn btn-trans-icon" onclick="return openCommunicationNodes('#{request.contextPath}','#{row.id}');" />
															</p:column>
															<p:column styleClass='centerText'>
																<f:facet name="header"> #{msgs.label_edit} </f:facet>
																<h:commandButton value="&#xf14b;" styleClass="btn btn-trans-icon" title="#{msgs.label_edit}" onclick="this.form.target='_blank'" action="#{followUpManagement.editFollowUp(row)}" />
															</p:column>
															<p:column styleClass='centerText'>
																<f:facet name="header"> #{msgs.label_followUpConversations} </f:facet>
																<h:commandButton value="&#xf086;" styleClass="btn btn-trans-icon" onclick="this.form.target='_blank'" action="#{followUpManagement.viewFollowUpConversations(row)}" />
															</p:column>
															<p:column styleClass='centerText'>
																<f:facet name="header"> #{msgs.title_followUpResult} </f:facet>
																<h:commandButton id="viewBtnId" value="&#xF0F6;" styleClass="btn btn-trans-icon" onclick="this.form.target='_blank'" action="#{followUpManagement.viewFollowUpResult(row)}" />
															</p:column>
															<p:column styleClass='centerText'>
																<f:facet name="header"> #{msgs.label_followUpLetters} </f:facet>
																<h:commandButton value="&#xf0c5;" styleClass="btn btn-trans-icon" onclick="this.form.target='_blank'" action="#{followUpManagement.viewFollowUpLetters(row)}" />
															</p:column>
														</p:dataTable>
													</h:panelGroup>
												</td>
											</tr>
										</table>
									</td>
								</tr>
							</table>
						</h:panelGroup>
					</td>
				</tr>


				<tr>
					<td width="100%" height="5" />
				</tr>
			</table>
		</ui:decorate>
	</h:form>
</h:body>
</html>