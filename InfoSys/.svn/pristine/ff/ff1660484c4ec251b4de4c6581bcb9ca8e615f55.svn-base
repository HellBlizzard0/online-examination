<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:p="http://primefaces.org/ui" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:f="http://java.sun.com/jsf/core" xmlns:util="http://java.sun.com/jsf/composite/util" xmlns:code="http://java.sun.com/jsf/composite/code">
<h:head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<h:outputStylesheet library="css" name="styles.css" />
	<h:outputStylesheet library="css" name="grid.css" />
	<h:outputStylesheet library="css" name="bootstrap.css" />
	<h:outputScript name="utilities.js" library="javascript" target="head" />
	<script type="text/javascript">
		function expandClassificationTypeFieldSet(e){
			if(e.status == 'success'){
				$(document.getElementById('formId:followUpDetialsContainerId')).children('.ui-fieldset-content').css({'display':'block'});
			}
		}
	
		function collapseClassificationTypeFieldSet(e){
			if(e.status == 'success'){
				$(document.getElementById('formId:followUpDetialsContainerId')).children('.ui-fieldset-content').css({'display':'none'});
			}
		}
		
		var m;

		function getEmployee(contextPath, mode) {
			m = 1;
			openEmpsMiniSearch(contextPath, mode, null);
			return false;
		}
		
		function getNetwork(contextPath, mode) {
			m = 2;
			openNetworksMiniSearch(contextPath);
			return false;
		}

		function HandlePopupResult(ret) {
			unMaskScreen();
			if (ret != null) {
				if (m == 1) {
					document.getElementById('formId:selectedEmployeeIdId').value = ret[0];
					document.getElementById('formId:selectedEmployeeNameId').value = ret[1];
					document.getElementById('formId:selectedEmployeeSocialIdId').value = ret[2];
					document.getElementById('formId:employeeNameId').value = ret[1];
					document.getElementById('formId:employeeIdentityId').value = ret[2];
				} else if (m == 2) {
					document.getElementById('formId:selectedNetworkIdId').value = ret[0];
					document.getElementById('formId:selectedNetworkDescId').value = ret[1];
					document.getElementById('formId:networkDescId').value = ret[1];
					document.getElementById('formId:valuesForNetworkRole').click();
				}
				return true;
			}
			return false;
		}
		
		function addingNetwork(data)
		{
		    var isSave = document.getElementById('formId:saveNetworkHiddenId').value;
			if(data.status == 'success' &amp;&amp; isSave=='true' ) {
			   	PF('networkDialog').hide();
			   }
			   return false;
		}
		
	  	function uploadFile(){
	  		fileArchivingParam = document.getElementById('formId:fileArchivingParamId').value;
	  		openUploadFile('#{followUpReg.boolServerUploadPath}', fileArchivingParam);
	  		return false;
	      }
	  	
	  	function releaseMask() {
			unMaskScreen();
		}
	</script>
</h:head>

<h:body styleClass="screenBg">
	<h:form id="formId" dir="#{msgs.dir}">
		<ui:decorate template="/Main/Template.xhtml">
			<table border="0" cellpadding="0" cellspacing="0" width="100%">
				<tr>
					<td width="100%" height="0" />
				</tr>

				<tr>
					<td class="screenTitle">#{msgs.title_followUpRegistration}</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td>
						<h:panelGroup id="searchContainerId">
							<table class="sectionContent" border="0" cellpadding="0" cellspacing="0">
								<tr>
									<th width="15%">#{msgs.label_contactNumber}</th>
									<td width="35%">
										<h:inputText styleClass="form-control" id="contactNumberSearchId" maxlength="15" value="#{followUpReg.searchContactNumber}" rendered="#{followUpReg.followUp.id == null}" />
										<h:inputText styleClass="form-control" disabled="true" value="#{followUpReg.followUp.contactNumber}" rendered="#{followUpReg.followUp.id != null}" />
									</td>


									<th width="15%">#{msgs.label_theCode}</th>
									<td width="20%">
										<h:inputText styleClass="form-control" id="codeSearchId" value="#{followUpReg.searchCode}" rendered="#{followUpReg.followUp.id == null}" />
										<h:inputText styleClass="form-control" disabled="true" value="#{followUpReg.followUp.code}" rendered="#{followUpReg.followUp.id != null}" />
									</td>
									<td width="20%">
										<table class="actionsSection" border="0" cellpadding="0" cellspacing="0">
											<tr>
												<td>
													<h:commandButton styleClass="btn btn-default" id="searchBtnId" value="&#xf002; #{msgs.label_dataRetrieval}" action="#{followUpReg.searchFollowUps()}" rendered="#{followUpReg.followUp.id == null}">
														<f:ajax render="formId:ghostInfoTitleId formId:ghostInfoContainerId formId:followUpDetialsTitleId formId:followUpDetialsContainerId formId:actionPanelId formId:searchContainerId" execute="formId:searchContainerId" />
													</h:commandButton>
												</td>
											</tr>
										</table>
									</td>

								</tr>
							</table>
						</h:panelGroup>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td>
						<h:panelGroup id="ghostInfoTitleId">
							<h:panelGroup rendered="#{followUpReg.followUp.contactNumber != null}">
								<table class="sectionTitle" border="0" cellpadding="0" cellspacing="0">
									<tr>
										<td>
											<h:outputText value="#{msgs.label_ghostInfo}" />
										</td>
									</tr>
								</table>
							</h:panelGroup>
						</h:panelGroup>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>
				<tr>
					<td>
						<h:panelGroup id="ghostInfoContainerId">
							<h:panelGroup rendered="#{followUpReg.followUp.contactNumber != null}">
								<table class="sectionContent" border="0" cellpadding="0" cellspacing="0">
									<tr>
										<th width="15%">#{msgs.label_contactNumber}</th>
										<td width="20%">
											<h:inputText disabled="true" styleClass="form-control" id="contactNumberId" value="#{followUpReg.followUp.contactNumber}" />
										</td>

										<th width="15%">#{msgs.label_theCode}</th>
										<td width="20%">
											<h:inputText styleClass="form-control" id="codeId" value="#{followUpReg.followUp.code}" />
										</td>

									</tr>

									<tr>
										<th width="15%">#{msgs.label_ownerName}</th>
										<td width="20%">
											<h:inputText styleClass="form-control" id="ownerNameId" value="#{followUpReg.followUp.ownerName}" />
										</td>
										<th width="15%">#{msgs.label_ownerIdentity}</th>
										<td width="20%">
											<h:inputText styleClass="form-control" id="ownerIdentityId" value="#{followUpReg.followUp.ownerSocialId}" maxlength="10" onkeypress="return checkDigit(event)" />
										</td>
									</tr>

									<tr>
										<th width="15%">#{msgs.label_ghostType}</th>
										<td width="20%">
											<h:selectOneRadio value="#{followUpReg.followUp.ghostType}">
												<f:selectItem itemLabel="#{msgs.label_employeeTitle}" itemValue="#{followUpReg.employeeType}" />
												<f:selectItem itemLabel="#{msgs.label_nonEmployee}" itemValue="#{followUpReg.nonEmployeeType}" />
												<f:ajax event="change" execute="@this" render="formId:employeeTitleId formId:empNonEmpNameId formId:socialIdId formId:ghostCategoryPanelId formId:ghostCategoryPanelLabelId" />
											</h:selectOneRadio>
										</td>
										<th width="15%">#{msgs.label_aliasName}</th>
										<td width="20%">
											<h:inputText styleClass="form-control" id="aliasNameId" value="#{followUpReg.followUp.aliasName}" />
										</td>
									</tr>

									<tr>
										<th width="15%">
											<h:panelGroup id="employeeTitleId">
												<h:outputText value="#{msgs.label_employeeTitle}" rendered="#{followUpReg.followUp.ghostType == followUpReg.employeeType}" />
												<h:outputText value="#{msgs.label_nonEmployeeName}" rendered="#{followUpReg.followUp.ghostType == followUpReg.nonEmployeeType}" />
											</h:panelGroup>
										</th>
										<td width="20%">
											<h:panelGroup id="empNonEmpNameId">
												<h:inputText id="employeeNameId" disabled="true" styleClass="form-control" value="#{followUpReg.followUp.employeeName}" rendered="#{followUpReg.followUp.ghostType == followUpReg.employeeType}" style="width:75%;" />
												<h:commandButton id="selectEmpBtnId" value="&#xf002;" styleClass="btn btn-trans-icon" onclick="return getEmployee('#{request.contextPath}', 1, null);" rendered="#{followUpReg.followUp.ghostType == followUpReg.employeeType}" />
												<h:inputHidden id="selectedEmployeeIdId" value="#{followUpReg.followUp.employeeId}" />
												<h:inputHidden id="selectedEmployeeNameId" value="#{followUpReg.followUp.employeeName}" />
												<h:inputHidden id="selectedEmployeeSocialIdId" value="#{followUpReg.followUp.employeeSocialId}" />
												<h:inputText styleClass="form-control" id="nonEmployeeNameId" value="#{followUpReg.followUp.nonEmployeeName}" rendered="#{followUpReg.followUp.ghostType == followUpReg.nonEmployeeType}" />
											</h:panelGroup>
										</td>

										<th width="15%">#{msgs.label_socialId}</th>
										<td width="20%">
											<h:panelGroup id="socialIdId">
												<h:inputText id="employeeIdentityId" disabled="true" value="#{followUpReg.followUp.employeeSocialId}" rendered="#{followUpReg.followUp.ghostType == followUpReg.employeeType}" />
												<h:inputText styleClass="form-control" id="nonEmployeeIdentityId" value="#{followUpReg.followUp.nonEmployeeSocialId}" rendered="#{followUpReg.followUp.ghostType == followUpReg.nonEmployeeType}" maxlength="10" onkeypress="return checkDigit(event)" />
											</h:panelGroup>
										</td>

									</tr>

									<tr>
										<th width="15%">
											<h:panelGroup id="ghostCategoryPanelLabelId">
												<h:panelGroup rendered="#{followUpReg.followUp.ghostType == followUpReg.nonEmployeeType}">
													<h:outputText value="#{msgs.label_ghostCategory}" />
												</h:panelGroup>
											</h:panelGroup>
										</th>
										<td width="20%">
											<h:panelGroup id="ghostCategoryPanelId">
												<h:panelGroup rendered="#{followUpReg.followUp.ghostType == followUpReg.nonEmployeeType}">
													<h:selectOneRadio value="#{followUpReg.followUp.ghostCategory}">
														<f:selectItem itemLabel="#{msgs.label_civil}" itemValue="#{followUpReg.ghostCivilCategory}" />
														<f:selectItem itemLabel="#{msgs.label_military}" itemValue="#{followUpReg.ghostMilitaryCategory}" />
														<f:ajax event="change" execute="@this" render="formId:employeeTitleId formId:empNonEmpNameId formId:socialIdId" />
													</h:selectOneRadio>
												</h:panelGroup>
											</h:panelGroup>
										</td>
									</tr>
								</table>
							</h:panelGroup>
						</h:panelGroup>
					</td>
				</tr>


				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td>
						<h:panelGroup id="followUpDetialsTitleId">
							<h:panelGroup rendered="#{followUpReg.followUp.contactNumber != null}">
								<table class="sectionTitle" border="0" cellpadding="0" cellspacing="0">
									<tr>
										<td>
											<h:outputText value="#{msgs.label_followUpDetials}" />
										</td>
									</tr>
								</table>
							</h:panelGroup>
						</h:panelGroup>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>
				<tr>
					<td>
						<h:panelGroup id="followUpDetialsContainerId">
							<h:panelGroup rendered="#{followUpReg.followUp.contactNumber != null}">
								<table class="sectionContent" border="0" cellpadding="0" cellspacing="0">
									<tr>
										<th width="15%">#{msgs.label_followUpDataSource}</th>
										<td width="20%">
											<h:inputTextarea value="#{followUpReg.followUp.informationSource}" />
										</td>

										<th width="15%" rowspan="2">#{msgs.label_followUpCoordinates}</th>
										<td width="20%" rowspan="2">
											<code:coordinates latitude="#{followUpReg.followUp.coordinateLatitude}" longitude="#{followUpReg.followUp.coordinateLongitude}" emptyLatitude="#{followUpReg.followUp.coordinateLatitude == null or followUpReg.followUp.coordinateLatitude == 0.0 ? true : false}" emptyLongitude="#{followUpReg.followUp.coordinateLongitude == null or followUpReg.followUp.coordinateLongitude == 0.0 ? true : false}" />
										</td>

									</tr>

									<tr>
										<th width="15%">
											#{msgs.label_followUpStartDate}
											<h:outputText value="*" style="color:red;" />
										</th>
										<td width="20%">
											<util:advancedHijriDate id="startDateId" value="#{followUpReg.followUp.followUpStartDate}" />
										</td>
									</tr>

									<tr>
										<th width="15%">
											#{msgs.label_followUpPeriod}
											<h:outputText value="*" style="color:red;" />
										</th>
										<td width="20%">
											<h:inputText styleClass="form-control" onkeypress="return checkDigit(event);" value="#{followUpReg.followUp.followUpPeriod}" style="width: 50%; margin-left: 5px;">
												<f:ajax event="blur" listener="#{followUpReg.calculateEndDate()}" execute="@this formId:startDateId" render="formId:endDateStrId" />
											</h:inputText>
											<h:outputText value="#{msgs.label_day}" />
										</td>

										<th width="15%" rowspan="3">#{msgs.label_followUpLocation}</th>
										<td width="20%" rowspan="3">
											<h:inputTextarea onkeypress="return valdiateMaxLength(this, 250);" onblur="return isValdiateMaxLength(this, 250);" id="locationId" styleClass="form-control" rows="4" value="#{followUpReg.followUp.followUplocation}" style=" resize:none; " />
										</td>
									</tr>
									<tr>
										<th width="15%">#{msgs.label_followUpEndDate}</th>
										<td width="20%">
											<h:inputText disabled="true" styleClass="form-control" id="endDateStrId" value="#{followUpReg.followUp.followUpEndDateString}" />
										</td>
									</tr>
									<tr>
										<th width="15%">
											#{msgs.label_region}
											<h:outputText value="*" style="color:red;" />
										</th>
										<td width="20%">
											<h:selectOneMenu styleClass="form-control" value="#{followUpReg.followUp.regionId}">
												<f:selectItem itemValue="" itemLabel=" " />
												<f:selectItems value="#{followUpReg.regionsList}" var="region" itemLabel="#{region.regionName}" itemValue="#{region.id}" />
												<f:ajax event="change" execute="@this" render=" formId:sectorListPanelId formId:sectorTitleId" listener="#{followUpReg.getRegionSectors()}" />
											</h:selectOneMenu>
										</td>
									</tr>


									<tr>
										<th width="15%">#{msgs.label_network}</th>
										<td width="20%">
											<h:inputText id="networkDescId" disabled="true" value="#{followUpReg.followUp.followUpNetworkNum}" style="width: 50%;" />
											<h:commandButton value="&#xf002;" styleClass="btn btn-trans-icon" onclick="return getNetwork('#{request.contextPath}');" title="#{msgs.label_network}" />
											<h:commandButton id="valuesForNetworkRole" style="display:none;">
												<f:ajax render="formId:followUpNetworkRoleId" execute="formId:selectedNetworkIdId" />
											</h:commandButton>
											<h:inputHidden id="selectedNetworkIdId" value="#{followUpReg.followUp.followUpNetworkId}" />
											<h:inputHidden id="selectedNetworkDescId" value="#{followUpReg.followUp.followUpNetworkNum}" />
											<h:commandButton action="#{followUpReg.openNetworkDialog()}" value="&#xf067; &nbsp; #{msgs.label_followUpNewNetwork}" styleClass="btn btn-default">
												<f:ajax execute="@this" render="formId:networkAddingDialogId" onevent="function(event){if(event.status == 'success')PF('networkDialog').show();} ">
												</f:ajax>
											</h:commandButton>
										</td>

										<th width="15%">
											<h:panelGroup id="sectorTitleId">
												<h:outputText value="#{msgs.label_sector}" rendered="#{not empty followUpReg.sectorsList}" />
											</h:panelGroup>
										</th>
										<td width="20%">
											<h:panelGroup id="sectorListPanelId">
												<h:selectOneMenu styleClass="form-control" value="#{followUpReg.followUp.sectorId}" rendered="#{not empty followUpReg.sectorsList}">
													<f:selectItem itemValue="" itemLabel=" " />
													<f:selectItems value="#{followUpReg.sectorsList}" var="sector" itemLabel="#{sector.arabicName}" itemValue="#{sector.id}" />
												</h:selectOneMenu>
											</h:panelGroup>
										</td>

									</tr>

									<tr>
										<th width="15%">#{msgs.label_followUpNetworkRole}</th>
										<td width="20%">
											<h:selectOneMenu id="followUpNetworkRoleId" disabled="#{followUpReg.followUp.followUpNetworkNum == null and followUpReg.followUp.followUpNetworkId == null}" styleClass="form-control" value="#{followUpReg.followUp.domainIdNetworkRole}">
												<f:selectItem itemValue="#{null}" itemLabel=" " />
												<f:selectItems value="#{followUpReg.networkRoleDomainList}" var="networkRole" itemLabel="#{networkRole.description}" itemValue="#{networkRole.id}" />
											</h:selectOneMenu>
										</td>

										<th width="15%">#{msgs.label_followUpDirect}</th>
										<td width="20%">
											<h:selectBooleanCheckbox value="#{followUpReg.followUp.directFlag}" />
										</td>

									</tr>

									<tr>
										<th width="15%">#{msgs.label_followUpMontrReason}</th>
										<td width="20%">
											<h:selectOneMenu styleClass="form-control" value="#{followUpReg.followUp.domainIdMontrReason}">
												<f:selectItem itemValue="#{null}" itemLabel=" " />
												<f:selectItems value="#{followUpReg.montrReasonDomainList}" var="montrReason" itemLabel="#{montrReason.description}" itemValue="#{montrReason.id}" />
											</h:selectOneMenu>
										</td>

										<th width="15%">#{msgs.label_followUpCaseType}</th>
										<td width="20%">
											<h:selectOneMenu styleClass="form-control" value="#{followUpReg.followUp.domainIdCasesType}">
												<f:selectItem itemValue="#{null}" itemLabel=" " />
												<f:selectItems value="#{followUpReg.casesTypeDomainList}" var="casesType" itemLabel="#{casesType.description}" itemValue="#{casesType.id}" />
											</h:selectOneMenu>
										</td>
									</tr>


								</table>
							</h:panelGroup>
						</h:panelGroup>
					</td>
				</tr>

				<tr>
					<td>
						<table class="actionsSection" border="0" cellpadding="0" cellspacing="0">
							<tr>
								<td width="100%">
									<h:panelGroup id="actionPanelId">
										<h:commandButton styleClass="btn btn-success" id="archiveBtnUploadId" value="&#xf187; #{msgs.label_attachmentUpload}" rendered="#{followUpReg.followUp.id != null}">
											<f:ajax listener="#{followUpReg.getUploadParam(followUpReg.followUp.id)}" render="formId:fileArchivingParamId" onevent="function(e){if(e.status == 'success') return uploadFile();}" />
										</h:commandButton>
										<h:inputHidden id="fileArchivingParamId" value="#{followUpReg.fileArchivingParam}" />
										<h:commandButton styleClass="btn btn-success" value="#{msgs.label_save}" action="#{followUpReg.saveFollowUp()}" rendered="#{followUpReg.followUp.contactNumber != null}">
											<f:ajax render="@form" execute="formId:ghostInfoContainerId formId:followUpDetialsContainerId formId:networkAddingDialogId" onevent="expandClassificationTypeFieldSet" />
										</h:commandButton>

									</h:panelGroup>
								</td>
							</tr>
						</table>
					</td>
				</tr>
			</table>

			<h:panelGroup id="networkAddingDialogId">
				<p:dialog widgetVar="networkDialog" modal="true" height="300px" header="#{msgs.label_followUpdAddNewNetwork}" dir="#{msgs.dir}" id="networkDetailsId">
					<h:panelGroup id="networkPanelId">
						<table>
							<tr>
								<td>
									<table class="sectionContent" border="0" cellpadding="0" cellspacing="0">
										<tr>
											<th width="15%">
												<h:outputText value="#{msgs.label_followUpNetworkNum}" />
												<h:outputText value="*" style="color:red;" />
											</th>
											<td width="25%">
												<h:inputText disabled="true" styleClass="form-control" value="#{followUpReg.newNetwork.networkNumber}" />
											</td>
										</tr>

										<tr>
											<th width="15%">
												<h:outputText value="#{msgs.label_followUpNetworkDesc}" />
												<h:outputText value="*" style="color:red;" />
											</th>
											<td width="25%">
												<h:inputTextarea onkeypress="return valdiateMaxLength(this, 500);" onblur="return isValdiateMaxLength(this, 500);" styleClass="form-control" rows="6" value="#{followUpReg.newNetwork.description}" />
											</td>
										</tr>
									</table>
								</td>
							</tr>

							<tr>
								<td width="100%" height="5" />
							</tr>
							<tr>
								<td>
									<table class="actionsSection">
										<tr>
											<td>
												<h:commandButton styleClass="btn btn-success" value="&#xf0c7; #{msgs.label_save}" action="#{followUpReg.saveNetwork()}">
													<f:ajax execute="formId:networkAddingDialogId" render="formId:networkPanelId formId:saveNetworkHiddenId formId:selectedNetworkIdId formId:selectedNetworkDescId formId:networkDescId" onevent="addingNetwork" />
												</h:commandButton>
												<h:inputHidden value="#{followUpReg.save}" id="saveNetworkHiddenId" />
											</td>
										</tr>
									</table>
								</td>
							</tr>
						</table>
					</h:panelGroup>
				</p:dialog>
			</h:panelGroup>
		</ui:decorate>
	</h:form>
</h:body>
</html>