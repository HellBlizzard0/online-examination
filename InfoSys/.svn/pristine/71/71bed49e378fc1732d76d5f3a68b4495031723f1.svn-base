<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:p="http://primefaces.org/ui" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:f="http://java.sun.com/jsf/core"
      xmlns:util="http://java.sun.com/jsf/composite/util">
<h:head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

	<h:outputStylesheet library="css" name="styles.css" />
	<h:outputStylesheet library="css" name="grid.css" />
	<h:outputScript name="utilities.js" library="javascript" target="head" />

	<script type="text/javascript">    
	        function getEmp(contextPath){
	        	openEmpsMiniSearch(contextPath, 1);
	        }

	        function getWorkflow(contextPath, instanceId){
	        	openWorkflowRepresentation(contextPath, 1, instanceId);
		    }
	        
	        function HandlePopupResult(ret){ 
	            if(ret != null){
	               document.getElementById('wfOutboxForm:searchEmpIDId').value = ret[0];
	               document.getElementById('wfOutboxForm:searchNameId').innerHTML = ret[1];
	               document.getElementById('wfOutboxForm:searchRequsterBtnId').click();
		        }
	        }
            
            function releaseMask(){
	          unMaskScreen();
	     	} 

            window.onkeypress = function(e) {
         		  var keyCode = window.event.keyCode || e.keyCode || e.which;
         	      if (keyCode == '13') {
         	    	  return false;
         	      }
            };
        </script>
</h:head>
<h:body styleClass="screenBg">
	<f:event type="preRenderComponent" listener="#{wfOutbox.init}" />
	<h:form id="wfOutboxForm" dir="#{msgs.dir}">
		<ui:decorate template="/Main/Template.xhtml">

			<table border="0" cellpadding="0" cellspacing="0" width="100%">


				<tr>
					<td class="screenTitle">
						<h:outputText value="#{wfOutbox.screenTitle}" />
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td>
						<table class="sectionContent" border="0" cellpadding="0" cellspacing="0">
							<tr>
								<th width="15%">
									<h:outputText value="#{msgs.label_searchBy}" />
								</th>
								<td width="20%" colspan="0">
									<h:selectOneMenu value="#{wfOutbox.selectedProcessGroupId}">
										<f:selectItem itemLabel="#{msgs.label_searchByModule}" itemValue="0" />
										<f:selectItems value="#{wfOutbox.processesGroups}" var="pG" itemLabel="#{pG.processGroupName}" itemValue="#{pG.processGroupId}" />

										<f:ajax event="change" listener="#{wfOutbox.searchProcesses}" execute="@this" render="notifyMessagesId processesId instancesId" />
									</h:selectOneMenu>

									<h:selectOneMenu id="processesId" value="#{wfOutbox.selectedProcessId}">
										<f:selectItem itemLabel="#{msgs.label_searchByProcess}" itemValue="0" />
										<f:selectItems value="#{wfOutbox.processes}" var="p" itemLabel="#{p.processName}" itemValue="#{p.processId}" />

										<f:ajax event="change" listener="#{wfOutbox.searchByProcess}" execute="@this" render="notifyMessagesId instancesId" />
									</h:selectOneMenu>
								</td>
								<td width="65%" colspan="2"></td>
							</tr>
							<tr>
								<th width="15%">
									<h:outputText value="#{msgs.label_selectEmp}" />
								</th>
								<td width="20%">
									<h:outputText id="searchNameId" value="#{wfOutbox.searchByRequesterName}" />
									<h:inputHidden id="searchEmpIDId" value="#{wfOutbox.searchByRequesterId}" />
									<h:commandButton title="#{msgs.label_selectEmp}" onclick="getEmp('#{request.contextPath}'); return false;" value="&#xf002;" styleClass="btn btn-trans-icon" />
									<h:commandButton id="searchRequsterBtnId" action="#{wfOutbox.searchByRequesterId}" style="display: none;">
										<f:ajax render="notifyMessagesId instancesId" execute="searchEmpIDId" />
									</h:commandButton>
								</td>
								<td width="10%">
									<h:commandButton action="#{wfOutbox.sortASC}" title="#{msgs.label_sortAsc}" value="&#xf062;" styleClass="btn btn-trans-icon">
										<f:ajax render="notifyMessagesId instancesId" />
									</h:commandButton>
									<h:commandButton action="#{wfOutbox.sortDESC}" title="#{msgs.label_sortDesc}" value="&#xf063;" styleClass="btn btn-trans-icon">
										<f:ajax render="notifyMessagesId instancesId" />
									</h:commandButton>
								</td>
								<td width="60%"></td>
							</tr>
							<tr>
								<th width="15%">
									<h:outputText value="#{msgs.label_searchByTaskDetails}" />
								</th>
								<td width="40%">
									<h:inputText styleClass="inputWithIcon" id="taskDetailsId" value="#{wfOutbox.searchDetails}">
									</h:inputText>
									<h:commandButton action="#{wfOutbox.searchByRequesterId()}" title="#{msgs.label_search}" value="&#xf002;" styleClass="btn btn-trans-icon">
										<f:ajax execute="taskDetailsId" render="notifyMessagesId instancesId" />
									</h:commandButton>
								</td>
								
							</tr>
							<tr>
								<th width="15%">#{msgs.label_requestDate}</th>
								<td width="40%">
									<util:advancedHijriDate id="fromDateId" value="#{wfOutbox.fromDate}" />
									#{msgs.label_to}
									<util:advancedHijriDate id="toDateId" value="#{wfOutbox.toDate}" />
									<h:commandButton action="#{wfOutbox.searchByRequesterId()}" title="#{msgs.label_search}" value="&#xf002;" styleClass="btn btn-trans-icon">
										<f:ajax execute="fromDateId toDateId" render="notifyMessagesId instancesId" />
									</h:commandButton>
								</td>
								
							</tr>
							
						</table>
					</td>
				</tr>

				<tr>
					<td width="100%" height="15" />
				</tr>

				<tr>
					<td width="100%">
						<h:panelGroup id="currentProcessesId">
							<div class="tab-border">
								<h:commandButton action="#{wfOutbox.getRunningInstances}" value="#{msgs.label_currentTransactions} &nbsp; #{msgs.fa_cogs}" styleClass="btn_normal_icon #{wfOutbox.runningFlag ? 'selected-tab' : ''}">
									<f:ajax render="notifyMessagesId instancesId currentProcessesId" />
								</h:commandButton>
								<h:commandButton action="#{wfOutbox.getDoneCompletedInstances}" value="#{msgs.label_previousTransactions} &nbsp; #{msgs.fa_chevron_circle_left}" styleClass="btn_normal_icon #{wfOutbox.runningFlag ? '' : 'selected-tab'}">
									<f:ajax render="notifyMessagesId instancesId currentProcessesId" />
								</h:commandButton>
							</div>
						</h:panelGroup>
					</td>
				</tr>

				<tr>
					<td align="center" width="100%">
						<div class="tabs-inner">
							<p:dataTable reflow="true" tableStyle="table-layout: auto" paginator="true" id="instancesId" var="instance" value="#{wfOutbox.instances}" rows="#{wfOutbox.pageSize}" rowHover="true">
								<p:column>
									<f:facet name="header">
										<h:outputText value="#{msgs.label_processId}" />
									</f:facet>
									<h:outputText id="instanceId" value="#{instance.instanceId}" />
								</p:column>
								<p:column>
									<f:facet name="header">
										<h:outputText value="#{msgs.label_processName}" />
									</f:facet>
									<h:outputText value="#{instance.processName}" />
								</p:column>
								<p:column>
									<f:facet name="header">
										<h:outputText value="#{msgs.label_requestDate}" />
									</f:facet>
									<h:outputText value="#{instance.hijriRequestDateString}" />
								</p:column>
								<p:column rendered="#{msgs.dir == 'rtl'}">
									<f:facet name="header">
										<h:outputText value="#{msgs.label_taskSummary}" />
									</f:facet>
									<h:outputText value="#{instance.arabicDetailsSummary}" />
								</p:column>
								<p:column rendered="#{msgs.dir == 'ltr'}">
									<f:facet name="header">
										<h:outputText value="#{msgs.label_taskSummary}" />
									</f:facet>
									<h:outputText value="#{instance.englishDetailsSummary}" />
								</p:column>
								<p:column>
									<f:facet name="header">
										<h:outputText value="#{msgs.label_workFlowProgress}" />
									</f:facet>
									<p:commandButton value="&#xf03a;" styleClass="btn btn-trans-icon" onclick="getWorkflow('#{request.contextPath}', '#{instance.instanceId}'); return false;" />
								</p:column>
							</p:dataTable>
						</div>
					</td>
				</tr>
			</table>
		</ui:decorate>
	</h:form>
</h:body>
</html>