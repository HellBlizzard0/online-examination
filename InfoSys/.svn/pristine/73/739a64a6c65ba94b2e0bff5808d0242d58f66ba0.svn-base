<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:p="http://primefaces.org/ui" xmlns:util="http://java.sun.com/jsf/composite/util" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:f="http://java.sun.com/jsf/core">
<h:head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

	<h:outputStylesheet library="css" name="styles.css" />
	<h:outputStylesheet library="css" name="grid.css" />
	<h:outputStylesheet library="css" name="bootstrap.css" />

	<h:outputScript name="utilities.js" library="javascript" target="head" />
	<script type="text/javascript">
		var mode;
		function getEmployee(contextPath) {
			mode = 2;
			openEmpsMiniSearch(contextPath, 2);
			return false;
		}

		function getDepartment(contextPath, regionId) {
			mode = 1;
			openDepartmentsMiniSearch(contextPath, 3, regionId, null);
			return false;
		}

		function getRegionDepartment(contextPath,m){
	    	mode = 3;
			openDepartmentsMiniSearch(contextPath,m, null, '#{labCheckSearch.departmentType}');
			return false;
		}

		function getWorkflow(contextPath, instanceId){
            openWorkflowRepresentation(contextPath, 1, instanceId);
	      }
		function releaseMask() {
			unMaskScreen();
		}

		function HandlePopupResult(ret) {
			unMaskScreen();
			if (ret != null) {
				if (mode == 1) {
					document.getElementById('labCheckSearchFormId:selectedDepartmentIdId').value = ret[0];
					document.getElementById('labCheckSearchFormId:selectedDepartmentNameId').value = ret[1];
					document.getElementById('labCheckSearchFormId:departmentNameId').innerHTML = ret[1];
				} else if (mode == 2) {
					document.getElementById('labCheckSearchFormId:employeeSearchIdId').value=ret[0];
	         	    document.getElementById('labCheckSearchFormId:employeeSearchNameId').innerHTML=ret[1];
					return true;
				} else if (mode == 3){
					document.getElementById('labCheckSearchFormId:selectedRegionId').value = ret[0];
	   	         	document.getElementById('labCheckSearchFormId:selectedRegionNameId').value = ret[1];
	   	         	document.getElementById('labCheckSearchFormId:regionNameId').innerHTML = ret[1];
	   	            document.getElementById('labCheckSearchFormId:selectedDepartmentIdId').value = null;
					document.getElementById('labCheckSearchFormId:selectedDepartmentNameId').value = '';
					document.getElementById('labCheckSearchFormId:departmentNameId').innerHTML = '';
	   	            document.getElementById('labCheckSearchFormId:updateRegionIdButtonId').click();
				}
			}
			return false;
		}
		
		function checkLab(data)
		{
		    var isSave = document.getElementById('labCheckSearchFormId:saveSampleHiddenId').value;
			if(data.status == 'success' &amp;&amp; isSave=='true' ) {
			   	PF('dialog').hide();
			   }
			   return false;
		}

		window.onkeypress = function(e) {
			  var keyCode = window.event.keyCode || e.keyCode || e.which;
		      if (keyCode == '13') {
		    	  document.getElementById('labCheckSearchFormId:searchBtnId').click();
		    	  return false;
		      }
		};
	</script>
</h:head>
<h:body styleClass="screenBg">
	<h:form id="labCheckSearchFormId" dir="#{msgs.dir}">
		<ui:decorate template="/Main/Template.xhtml">
			<table border="0" cellpadding="0" cellspacing="0" width="100%">
				<tr>
					<td class="screenTitle">
						<h:outputText value="#{msgs.title_labCheckSearch}" rendered="#{labCheckSearch.mode==2}" />
						<h:outputText value="#{msgs.title_labCheckComplete}" rendered="#{labCheckSearch.mode==1}" />
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td colspan="2">
						<table class="sectionTitle" border="0" cellpadding="0" cellspacing="0">
							<tr>
								<td>
									<h:outputText value="#{msgs.label_searchData}" />
								</td>
							</tr>
						</table>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td>
						<h:panelGroup id="searchContainerId">
							<table class="sectionContent" border="0" cellpadding="0" cellspacing="0">
								<tr>
									<th width="15%">#{msgs.label_orderNo}</th>
									<td width="20%">
										<h:inputText id="orderNoSearchId" styleClass="form-control inputnumber" value="#{labCheckSearch.labCheckEmployeeDataSearch.orderNumber}" maxlength="20" />
									</td>


									<th width="15%">#{msgs.label_orderDate}</th>
									<td width="20%">
										<util:advancedHijriDate id="orderDateId" value="#{labCheckSearch.labCheckEmployeeDataSearch.orderDate}" />
									</td>

								</tr>

								<tr>
									<th width="15%">#{msgs.label_checkReason}</th>
									<td width="20%">
										<h:selectOneMenu value="#{labCheckSearch.labCheckEmployeeDataSearch.checkReason}" styleClass="form-control">
											<f:selectItem itemLabel="" itemValue="" />
											<f:selectItems value="#{labCheckSearch.labCheckReasonsEnumList}" var="checkReason" itemLabel="#{checkReason.arabicDescription}" itemValue="#{checkReason.code}" />
										</h:selectOneMenu>
									</td>


									<th width="15%">#{msgs.label_checkResult}</th>
									<td width="20%">
										<h:selectOneMenu value="#{labCheckSearch.labCheckEmployeeDataSearch.checkStatus}" styleClass="form-control">
											<f:selectItem itemLabel="" itemValue="" />
											<f:selectItem itemLabel="#{msgs.label_noSample}" itemValue="#{labCheckSearch.noSampleCheckResult}" />
											<f:selectItem itemLabel="#{msgs.label_sampleTaked}" itemValue="#{labCheckSearch.sampleTakedResult}" />
											<f:selectItem itemLabel="#{msgs.label_checkPrivation}" itemValue="#{labCheckSearch.checkPrivationCheckResult}" />
											<f:selectItem itemLabel="#{msgs.label_negative}" itemValue="#{labCheckSearch.negativeCheckResult}" />
											<f:selectItem itemLabel="#{msgs.label_positiveUnderApprove}" itemValue="#{labCheckSearch.positiveUnderApproveCheckResult}" />
											<f:selectItem itemLabel="#{msgs.label_positive}" itemValue="#{labCheckSearch.positiveCheckResult}" />
											<f:selectItem itemLabel="#{msgs.label_sendingToForce}" itemValue="#{labCheckSearch.sendingToForceCheckResult}" />
											<f:selectItem itemLabel="#{msgs.label_retest}" itemValue="#{labCheckSearch.retestCheckResult}" />
											<f:selectItem itemLabel="#{msgs.label_cheatingInSample}" itemValue="#{labCheckSearch.cheatingInCheckResult}" />
										</h:selectOneMenu>
									</td>

								</tr>

								<tr>
									<th width="15%">#{msgs.label_employee}</th>
									<td width="20%">
										<h:commandButton value="&#xf002;" styleClass="btn btn-trans-icon" id="searchEmployeeBtnId" onclick="return getEmployee('#{request.contextPath}');" />
										<h:inputHidden id="employeeSearchIdId" value="#{labCheckSearch.labCheckEmployeeDataSearch.employeeId}" />
										<h:outputText id="employeeSearchNameId" value="#{labCheckSearch.labCheckEmployeeDataSearch.employeeFullName}" />
									</td>

									<th width="15%">
										<h:outputText value="#{msgs.label_region}"></h:outputText>
									</th>
									<td width="20%">

										<h:commandButton rendered="#{!labCheckSearch.userAtRegion}" value="&#xf002;" styleClass="btn btn-trans-icon" onclick="return getRegionDepartment('#{request.contextPath}',2);" title="#{msgs.label_addDepartment}" />
										<h:commandButton id="updateRegionIdButtonId" style="display : none ;">
											<f:ajax execute="labCheckSearchFormId:selectedRegionId labCheckSearchFormId:selectedRegionNameId" render="labCheckSearchFormId:selectedRegionId labCheckSearchFormId:selectedRegionNameId labCheckSearchFormId:departmentBtnId"></f:ajax>
										</h:commandButton>
										<h:inputHidden id="selectedRegionId" value="#{labCheckSearch.labCheckEmployeeDataSearch.employeeRegionId}" />
										<h:inputHidden id="selectedRegionNameId" value="#{labCheckSearch.labCheckEmployeeDataSearch.employeeRegionName}" />
										<h:outputText id="regionNameId" value="#{labCheckSearch.labCheckEmployeeDataSearch.employeeRegionName}" />
									</td>
								</tr>

								<tr>
									<th width="15%">#{msgs.label_surveillanceInstanceStatus}</th>
									<td width="20%">
										<h:selectOneMenu value="#{labCheckSearch.labCheckEmployeeDataSearch.labCheckStatus}" styleClass="form-control">
											<f:selectItem itemLabel="" itemValue="" />
											<f:selectItem itemLabel="#{msgs.label_infoStatusRegistered}" itemValue="#{labCheckSearch.registeredLabCheckStatus}" />
											<f:selectItem itemLabel="#{msgs.label_underApproval}" itemValue="#{labCheckSearch.underApprovedLabCheckStatus}" />
											<f:selectItem itemLabel="#{msgs.label_approved}" itemValue="#{labCheckSearch.approvedLabCheckStatus}" />
										</h:selectOneMenu>
									</td>

									<th width="15%">#{msgs.label_unitAndDep}</th>
									<td width="20%">
										<h:commandButton id="departmentBtnId" value="&#xf002;" styleClass="btn btn-trans-icon" onclick="return getDepartment('#{request.contextPath}', '#{labCheckSearch.labCheckEmployeeDataSearch.employeeRegionId}');" />
										<h:inputHidden id="selectedDepartmentIdId" value="#{labCheckSearch.labCheckEmployeeDataSearch.employeeDepartmentId}" />
										<h:inputHidden id="selectedDepartmentNameId" value="#{labCheckSearch.labCheckEmployeeDataSearch.employeeDepartmentName}" />
										<h:outputText id="departmentNameId" value="#{labCheckSearch.labCheckEmployeeDataSearch.employeeDepartmentName}" />
									</td>
								</tr>

							</table>
						</h:panelGroup>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td width="100%">
						<table class="actionsSection" border="0" cellpadding="0" cellspacing="0">
							<tr>
								<td>
									<h:commandButton styleClass="btn btn-default" id="resetBtnId" value="&#xf021; #{msgs.label_reset}" action="#{labCheckSearch.resetSearch()}">
										<f:ajax render="labCheckSearchFormId:searchContainerId" />
									</h:commandButton>

									<h:commandButton styleClass="btn btn-default" id="searchBtnId" value="&#xf002; #{msgs.label_search}" action="#{labCheckSearch.search()}">
										<f:ajax render="labCheckSearchFormId:labCheckSearchResultPaneId" execute="labCheckSearchFormId:searchContainerId" />
									</h:commandButton>

									<h:commandButton styleClass="btn btn-default" value="&#xf02f; #{msgs.label_print}" rendered="#{!labCheckSearch.userAtRegion}" title="#{msgs.label_print}" action="#{labCheckSearch.printReport()}" />
								</td>
							</tr>
						</table>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td>
						<table class="sectionTitle" border="0" cellpadding="0" cellspacing="0">
							<tr>
								<td>
									<h:outputText value="#{msgs.title_searchResults}" />
								</td>
							</tr>
						</table>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td align="center" width="100%">
						<h:panelGroup id="labCheckSearchResultPaneId">
							<p:dataTable reflow="true" tableStyle="table-layout: auto" paginator="true" id="labCheckListDataTableId" rows="10" rowIndexVar="index" var="row" value="#{labCheckSearch.labCheckEmployeeDataList}" rowHover="true">
								<p:column styleClass='centerText'>
									<f:facet name="header">#</f:facet>
	                                #{index + 1}
	                            </p:column>
								<p:column styleClass='centerText'>
									<f:facet name="header"> #{msgs.label_socialNumber} </f:facet>
									<h:outputText value="#{row.employeeSocialId}" />
								</p:column>
								<p:column styleClass='centerText'>
									<f:facet name="header"> #{msgs.label_name} </f:facet>
									<h:outputText value="#{row.employeeFullName}" />
								</p:column>
								<p:column styleClass='centerText'>
									<f:facet name="header"> #{msgs.label_rank} </f:facet>
									<h:outputText value="#{row.employeeRank}" />
								</p:column>
								<p:column styleClass='centerText'>
									<f:facet name="header"> #{msgs.label_unitAndDep} </f:facet>
									<h:outputText value="#{row.employeeDepartmentName}" />
								</p:column>
								<p:column styleClass='centerText' rendered="#{!labCheckSearch.userAtRegion}">
									<f:facet name="header"> #{msgs.label_region} </f:facet>
									<h:outputText value="#{row.employeeRegionName}" />
								</p:column>
								<p:column styleClass='centerText'>
									<f:facet name="header"> #{msgs.label_orderNo} </f:facet>
									<h:outputText value="#{row.orderNumber}" />
								</p:column>
								<p:column styleClass='centerText'>
									<f:facet name="header"> #{msgs.label_orderDate} </f:facet>
									<h:outputText value="#{row.orderDateString}" />
								</p:column>
								<p:column styleClass='centerText'>
									<f:facet name="header"> #{msgs.label_orderStatus} </f:facet>
									<h:outputText value="#{msgs.label_underApproval}" rendered="#{row.labCheckStatus==labCheckSearch.underApprovedLabCheckStatus}" />
									<h:outputText value="#{msgs.label_approved}" rendered="#{row.labCheckStatus==labCheckSearch.approvedLabCheckStatus}" />
									<h:outputText value="#{msgs.label_infoStatusRegistered}" rendered="#{row.labCheckStatus==labCheckSearch.registeredLabCheckStatus}" />
								</p:column>
								<p:column styleClass='centerText'>
									<f:facet name="header"> #{msgs.label_checkReason} </f:facet>
									<h:selectOneMenu disabled="true" value="#{row.checkReason}" styleClass="form-control">
										<f:selectItems value="#{labCheckSearch.labCheckReasonsEnumList}" var="checkReason" itemLabel="#{checkReason.arabicDescription}" itemValue="#{checkReason.code}" />
									</h:selectOneMenu>
								</p:column>
								<p:column styleClass='centerText'>
									<f:facet name="header">#{msgs.label_checkResult} </f:facet>
									<h:outputText value="#{msgs.label_noSample}" rendered="#{row.checkStatus==labCheckSearch.noSampleCheckResult}" />
									<h:outputText value="#{msgs.label_checkPrivation}" rendered="#{row.checkStatus==labCheckSearch.checkPrivationCheckResult}" />
									<h:outputText value="#{msgs.label_negative}" rendered="#{row.checkStatus==labCheckSearch.negativeCheckResult}" />
									<h:outputText value="#{msgs.label_positiveUnderApprove}" rendered="#{row.checkStatus==labCheckSearch.positiveUnderApproveCheckResult}" />
									<h:outputText value="#{msgs.label_positive}" rendered="#{row.checkStatus==labCheckSearch.positiveCheckResult}" />
									<h:outputText value="#{msgs.label_sendingToForce}" rendered="#{row.checkStatus==labCheckSearch.sendingToForceCheckResult}" />
									<h:outputText value="#{msgs.label_sampleTaked}" rendered="#{row.checkStatus==labCheckSearch.sampleTakedResult}" />
									<h:outputText value="#{msgs.label_retest}" rendered="#{row.checkStatus==labCheckSearch.retestCheckResult}" />
									<h:outputText value="#{msgs.label_cheatingInSample}" rendered="#{row.checkStatus==labCheckSearch.cheatingInCheckResult}" />
								</p:column>
								<p:column styleClass='centerText'>
									<f:facet name="header"> #{msgs.label_retestNumber} </f:facet>
									<h:outputText value="#{row.retestNumber}" />
								</p:column>
								<p:column styleClass='centerText' rendered="#{labCheckSearch.mode==1}">
									<f:facet name="header"> #{msgs.label_completeCheck} </f:facet>
									<p:menuButton value="#{msgs.label_taskAction}" styleClass="btn btn_normal padding-lef" rendered="#{row.labCheckStatus != labCheckSearch.labCheckUnderApproval and ((row.checkStatus==labCheckSearch.sampleTakedResult) or (row.checkStatus==labCheckSearch.noSampleCheckResult) or (row.checkStatus==labCheckSearch.positiveUnderApproveCheckResult) or (row.checkStatus==labCheckSearch.sendingToForceCheckResult))}">
										<p:menuitem>
											<p:commandLink ajax="false" value="#{msgs.label_labCheckReport}" action="#{labCheckSearch.printLabCheckReport(row)}" styleClass="btn btn-success" rendered="#{row.checkStatus==labCheckSearch.sampleTakedResult}" />
										</p:menuitem>
										<p:menuitem>
											<p:commandLink value="#{msgs.label_checkPrivation}" action="#{labCheckSearch.checkPervintion(row)}" styleClass="btn btn-success" update="labCheckSearchFormId:labCheckSearchResultPaneId" rendered="#{row.checkStatus==labCheckSearch.noSampleCheckResult}">
												<p:confirm message="#{msgs.q_continue}" />
											</p:commandLink>
										</p:menuitem>
										<p:menuitem>
											<p:commandLink value="#{msgs.label_sampleTaking}" action="#{labCheckSearch.sampleTacking(row)}" styleClass="btn btn-success" update="labCheckSearchFormId:sampleTakingDialogId" process="@this" oncomplete="PF('dialog').show();" rendered="#{row.checkStatus==labCheckSearch.noSampleCheckResult}">
												<p:confirm message="#{msgs.q_continue}" />
											</p:commandLink>
										</p:menuitem>
										<p:menuitem>
											<p:commandLink value="&#xf1d8; #{msgs.label_sendToForce}" action="#{labCheckSearch.sendingToForce(row,1)}" ajax="false" styleClass="btn btn-success" rendered="#{row.checkStatus==labCheckSearch.positiveUnderApproveCheckResult}">
												<p:confirm message="#{msgs.q_continue}" />
											</p:commandLink>
										</p:menuitem>
										<p:menuitem>
											<p:commandLink value="#{msgs.label_resultSubmit}" action="#{labCheckSearch.sendingToForce(row,2)}" ajax="false" styleClass="btn btn-success" rendered="#{row.checkStatus==labCheckSearch.sendingToForceCheckResult}">
												<p:confirm message="#{msgs.q_continue}" />
											</p:commandLink>
										</p:menuitem>
									</p:menuButton>
								</p:column>
								<p:column styleClass='centerText'>
									<f:facet name="header"> #{msgs.label_view} </f:facet>
									<h:commandButton value="&#xf05a;" styleClass="btn btn-trans-icon" target="_blank" onclick="this.form.target='_blank'" action="#{labCheckSearch.viewLabCheckOrder(row)}" rendered="#{row.checkReason != labCheckSearch.missionFromDirectorateReason}" />
								</p:column>

								<p:column styleClass='centerText'>
									<f:facet name="header"> #{msgs.label_edit} </f:facet>
									<h:commandButton value="&#xf14b;" rendered="#{( (labCheckSearch.editprivilege and row.labCheckStatus == labCheckSearch.approvedLabCheckStatus and row.checkStatus != labCheckSearch.retestCheckResult) or (row.labCheckStatus==labCheckSearch.registeredLabCheckStatus and row.checkStatus != labCheckSearch.retestCheckResult and row.checkReason != labCheckSearch.missionFromDirectorateReason) ) and row.editableFlag}" styleClass="btn btn-trans-icon" target="_blank" onclick="this.form.target='_blank'" action="#{labCheckSearch.editLabCheckDetails(row)}" />
								</p:column>

								<p:column styleClass='centerText' rendered="#{labCheckSearch.mode==2}">
									<f:facet name="header"> #{msgs.label_description} </f:facet>
									<h:commandButton value="&#xf05a;" styleClass="btn btn-trans-icon" target="_blank" onclick="this.form.target='_blank'" action="#{labCheckSearch.viewLabCheckDetails(row)}" />
								</p:column>
								<p:column>
									<f:facet name="header">
										<h:outputText value="#{msgs.label_workFlowProgress}" />
									</f:facet>
									<p:commandButton value="&#xf03a;" rendered="#{row.instanceId != null}" styleClass="btn btn-trans-icon" onclick="getWorkflow('#{request.contextPath}', '#{row.instanceId}'); return false;" />
								</p:column>
							</p:dataTable>
						</h:panelGroup>

						<h:panelGroup id="sampleTakingDialogId">
							<p:dialog widgetVar="dialog" modal="true" width="700px" height="300px" header="#{msgs.label_sampleRegesration}" dir="#{msgs.dir}" id="sampleDetailsDialogId">
								<h:panelGroup id="samplePanelId">
									<table>
										<tr>
											<td>
												<table class="sectionContent" border="0" cellpadding="0" cellspacing="0">
													<tr>
														<th width="15%">
															<h:outputText value="#{msgs.label_sampleNumber}" />
															<h:outputText value="*" style="color:red;" />
														</th>
														<td width="25%">
															<h:inputText maxlength="15" styleClass="form-control" onkeypress="return checkDigitSlash(event)" value="#{labCheckSearch.selectedLabCheckEmployeeData.sampleNumber}" size="30" />
														</td>


														<th width="15%">
															<h:outputText value="#{msgs.label_sampleDate}" />
															<h:outputText value="*" style="color:red;" />
														</th>
														<td width="25%">
															<util:advancedHijriDate id="sampleDateId" value="#{labCheckSearch.selectedLabCheckEmployeeData.sampleDate}" />
														</td>

													</tr>
												</table>
											</td>
										</tr>

										<tr>
											<td width="100%" height="5" />
										</tr>
										<tr>
											<td>
												<table class="actionsSection">
													<tr>
														<td>
															<h:commandButton styleClass="btn btn-success" value="&#xf0c7; #{msgs.label_save}" action="#{labCheckSearch.saveSampleTacking()}">
																<f:ajax execute="labCheckSearchFormId:sampleTakingDialogId" render="labCheckSearchFormId:samplePanelId labCheckSearchFormId:saveSampleHiddenId labCheckSearchFormId:labCheckSearchResultPaneId" onevent="checkLab" />
															</h:commandButton>
															<h:inputHidden value="#{labCheckSearch.save}" id="saveSampleHiddenId" />
														</td>
													</tr>
												</table>
											</td>
										</tr>
									</table>
								</h:panelGroup>
							</p:dialog>
						</h:panelGroup>

						<p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
							<p:commandButton value="#{msgs.label_no}" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
							<p:commandButton value="#{msgs.label_yes}" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
						</p:confirmDialog>
					</td>
				</tr>
			</table>
		</ui:decorate>
	</h:form>
</h:body>
</html>