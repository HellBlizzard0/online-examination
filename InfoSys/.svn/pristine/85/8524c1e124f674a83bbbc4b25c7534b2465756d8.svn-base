<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "httprime://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:f="http://java.sun.com/jsf/core" xmlns:code="http://java.sun.com/jsf/composite/code" xmlns:p="http://primefaces.org/ui">

<h:head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

	<h:outputStylesheet library="css" name="styles.css" rendered="#{msgs.dir=='rtl'}" />
	<h:outputStylesheet library="css" name="English-style.css" rendered="#{msgs.dir=='ltr'}" />
	<h:outputStylesheet library="css" name="disabled.css" />
	<h:outputStylesheet library="css" name="grid.css" />
	<h:outputStylesheet library="css" name="calendar.css" />
	<h:outputScript name="utilities.js" library="javascript" target="head" />
	<script type="text/javascript">
		var buttonM;
		function getEmployee(contextPath, buttonMode, actualDepId, delegatorId){
			buttonM = buttonMode;
			if(buttonMode == 1){
				openEmpsMiniSearch(contextPath, 1);
			}else if (buttonMode == 2){
				openEmpsMiniSearch(contextPath, 5, actualDepId, delegatorId);
			}
			return false;
		}

		function releaseMask(){
    		unMaskScreen();
       	}
       	
		function HandlePopupResult(ret) { 
    		unMaskScreen();
    		if(ret!=null){
        		if(buttonM == 1){
        			document.getElementById('delegationFormId:delegatorId').value=ret[0];
       	        	document.getElementById('delegationFormId:updateDelegatorId').click();
            	}else if (buttonM == 2){
            		document.getElementById('delegationFormId:delegateeId').value=ret[0];
       	        	document.getElementById('delegationFormId:updateDelegateeId').click();
                }
   	         	return true;
	   		}
	   		return false;
    	}
	</script>
</h:head>
<h:body styleClass="screenBg">
	<h:form id="delegationFormId" dir="#{msgs.dir}">
		<ui:decorate template="/Main/Template.xhtml">
			<table style="margin-bottom: 20px; margin-top: 20px;" border="0" cellpadding="0" cellspacing="0" width="100%">
				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td class="screenTitle">
						<h:outputText value="#{delegations.screenTitle}" />
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<!-- current employee -->

				<tr>
					<td width="100%">
						<table class="sectionTitle" border="0" cellpadding="0" cellspacing="0">
							<tr>
								<td>#{msgs.label_mainData}</td>
							</tr>
						</table>
					</td>
				</tr>

				<tr>
					<td width="100%">
						<h:panelGroup id="delegatorPanelId">
							<table class="sectionContent" border="0" cellpadding="0" cellspacing="0">
								<tr>
									<td>
										<h:commandButton onclick="return getEmployee('#{request.contextPath}',1);" value="#{msgs.label_employeeChoosing}" styleClass="btn btn-success" rendered="#{delegations.pageMode == 3}" />
										<h:inputHidden id="delegatorId" value="#{delegations.delegatorId}" />
										<h:commandButton id="updateDelegatorId" style="display:none;" action="#{delegations.addDelegatorDetails(delegations.delegatorId)}">
											<f:ajax execute="delegationFormId:delegatorId" render="delegationFormId:delegatorPanelId delegationFormId:delegListId delegationFormId:partialDelegListId delegationFormId:delegateePanelId delegationFormId:actionSectionId">
											</f:ajax>
										</h:commandButton>
									</td>
								</tr>

								<tr>
									<th width="15%">#{msgs.label_militaryNumber}</th>
									<td width="35%">
										<h:outputText value="#{delegations.delegatorEmployee.militaryNo}" />
									</td>

									<th width="15%">#{msgs.label_identity}</th>
									<td width="35%">
										<h:outputText value="#{delegations.delegatorEmployee.socialID} " />
									</td>
								</tr>

								<tr>
									<th width="15%">#{msgs.label_name}</th>
									<td width="35%">
										<h:outputText value="#{delegations.delegatorEmployee.fullName}" />
									</td>
								</tr>

								<tr>
									<th width="15%">#{msgs.label_rank}</th>
									<td width="35%">
										<h:outputText value="#{delegations.delegatorEmployee.rank}" />
									</td>

									<th width="15%">#{msgs.label_job}</th>
									<td width="35%">
										<h:outputText value="#{delegations.delegatorEmployee.actualTitleDescription} " />
									</td>
								</tr>

								<tr>
									<th width="15%">#{msgs.label_actualDepartment}</th>
									<td width="35%">
										<h:outputText value="#{delegations.delegatorEmployee.actualDepartmentName}" />
									</td>
								</tr>

								<tr>
									<th width="15%">#{msgs.label_manager}</th>
									<td width="35%">
										<h:outputText value="#{delegations.delegatorEmpManagerName}" />
									</td>
								</tr>
							</table>
						</h:panelGroup>
					</td>
				</tr>

				<!-- delegate to employee -->
				<h:panelGroup rendered="#{delegations.pageMode != 2}">
					<tr>
						<td width="100%">
							<table class="sectionTitle" border="0" cellpadding="0" cellspacing="0">
								<tr>
									<td>#{msgs.label_delegationMangement}</td>
								</tr>
							</table>
						</td>
					</tr>

					<tr>
						<td width="100%">
							<h:panelGroup id="delegateePanelId">
								<table class="sectionContent" border="0" cellpadding="0" cellspacing="0">
									<tr>
										<td>
											<h:commandButton id="selectDelegateeButtonId" onclick="return getEmployee('#{request.contextPath}',2,'#{delegations.depsList}','#{delegations.delegatorEmployee.empId}');" value="#{msgs.label_employeeChoosing}" styleClass="btn btn-default" disabled="#{empty delegations.delegatorEmployee.empId}"/>
											<h:inputHidden id="delegateeId" value="#{delegations.delegateeId}" />
											<h:commandButton id="updateDelegateeId" style="display:none;" action="#{delegations.addDelegateeDetails()}">
												<f:ajax execute="delegationFormId:delegateeId" render="delegationFormId:delegateePanelId delegationFormId:actionSectionId">
												</f:ajax>
											</h:commandButton>
										</td>
									</tr>

									<tr>
										<th width="15%">#{msgs.label_militaryNumber}</th>
										<td width="35%">
											<h:outputText value="#{delegations.delegateeEmployee.militaryNo}" />
										</td>

										<th width="15%">#{msgs.label_identity}</th>
										<td width="35%">
											<h:outputText value="#{delegations.delegateeEmployee.socialID} " />
										</td>
									</tr>

									<tr>
										<th width="15%">#{msgs.label_name}</th>
										<td width="35%">
											<h:outputText value="#{delegations.delegateeEmployee.fullName}" />
										</td>
									</tr>

									<tr>
										<th width="15%">#{msgs.label_rank}</th>
										<td width="35%">
											<h:outputText value="#{delegations.delegateeEmployee.rank}" />
										</td>

										<th width="15%">#{msgs.label_job}</th>
										<td width="35%">
											<h:outputText value="#{delegations.delegateeEmployee.actualTitleDescription} " />
										</td>
									</tr>

									<tr>
										<th width="15%">#{msgs.label_actualDepartment}</th>
										<td width="35%">
											<h:outputText value="#{delegations.delegateeEmployee.actualDepartmentName}" />
										</td>
									</tr>

									<tr>
										<th width="15%">#{msgs.label_manager}</th>
										<td width="35%">
											<h:outputText value="#{delegations.delegateeEmpManagerName}" />
										</td>
									</tr>
									<h:panelGroup rendered="#{delegations.pageMode != 2}">
										<tr>
											<th width="15%">#{msgs.label_processesType}</th>
											<td width="35%">
												<h:selectOneMenu id="processIdValue" value="#{delegations.selectedProcessId}">
													<f:selectItems value="#{delegations.processList}" var="p" itemLabel="#{p.processName}" itemValue="#{p.processId}" />
												</h:selectOneMenu>
											</td>
										</tr>
									</h:panelGroup>
								</table>
							</h:panelGroup>
						</td>
					</tr>
				</h:panelGroup>

				<tr>
					<td width="100%" height="15" />
				</tr>

				<!-- delegation actions -->

				<tr>
					<td>
						<h:panelGroup id="actionSectionId" rendered="#{delegations.pageMode != 2}">
							<table class="actionsSection" border="0" cellpadding="0" cellspacing="0">
								<tr>
									<td width="100%">
										<h:commandButton class="btn btn-default" value="#{msgs.label_saveTotalDelegation}" action="#{delegations.saveTotalDelegation()}" onclick="return confirm('#{msgs.q_save}');" disabled="#{empty delegations.delegateeEmployee.empId}">
											<f:ajax render="delegationFormId:delegListId"></f:ajax>
										</h:commandButton>
										<h:commandButton class="btn btn-default" value="#{msgs.label_savePartialDelegation}" action="#{delegations.savePartialDelegation()}" onclick="return confirm('#{msgs.q_save}');" disabled="#{empty delegations.delegateeEmployee.empId}">
											<f:ajax render="delegationFormId:partialDelegListId" execute="delegationFormId:processIdValue"></f:ajax>
										</h:commandButton>
									</td>
								</tr>
							</table>
						</h:panelGroup>
					</td>
				</tr>

				<tr>
					<td width="100%" height="15" />
				</tr>

				<!-- view total delegation -->

				<tr>
					<td width="100%">
						<table class="sectionTitle" border="0" cellpadding="0" cellspacing="0">
							<tr>
								<td>#{msgs.label_totalDelegation}</td>
							</tr>
						</table>
					</td>
				</tr>

				<tr>
					<td width="100%" height="15" />
				</tr>

				<tr>
					<td align="center" width="100%">
						<p:dataTable id="delegListId" rows="#{delegations.rowsCount}" rowIndexVar="index" value="#{delegations.totalDelegationList}" var="row" tableStyle="table-layout:auto" reflow="true" liveResize="true" paginatorPosition="bottom" paginator="true" style="width:100%" rowHover="true">
							<p:column headerText="#">
                                #{index + 1}
                             </p:column>
							<p:column headerText="#{msgs.label_delegatorId}">
								<h:outputText value="#{row.empId}" />
							</p:column>
							<p:column headerText="#{msgs.label_delegatorName}">
								<h:outputText value="#{row.empName}" />
							</p:column>
							<p:column headerText="#{msgs.label_delegateeId}">
								<h:outputText value="#{row.delegateId}" />
							</p:column>
							<p:column headerText="#{msgs.label_delegateeName}">
								<h:outputText value="#{row.delegateName}" />
							</p:column>
							<p:column rendered="#{delegations.pageMode != 2}" headerText="#{msgs.label_delete}">
								<h:commandButton value="&#xf00d;" styleClass="btn btn-trans-icon" action="#{delegations.deleteTotalDelegation(row)}" onclick="return confirm('#{msgs.q_delete}');" title="#{msgs.label_delete}">
									<f:ajax render="delegListId">
									</f:ajax>
								</h:commandButton>
							</p:column>
						</p:dataTable>
					</td>
				</tr>

				<tr>
					<td width="100%" height="15" />
				</tr>

				<!-- Partial Delegation -->

				<tr>
					<td width="100%">
						<table class="sectionTitle" border="0" cellpadding="0" cellspacing="0">
							<tr>
								<td>#{msgs.label_partialDelegation}</td>
							</tr>
						</table>
					</td>
				</tr>

				<tr>
					<td align="center" width="100%">
						<p:dataTable id="partialDelegListId" rows="#{delegations.rowsCount}" rowIndexVar="index" value="#{delegations.partialDelegationList}" var="row" tableStyle="table-layout:auto" reflow="true" liveResize="true" paginatorPosition="bottom" paginator="true" style="width:100%" rowHover="true">
							<p:column headerText="#">
                                #{index + 1}
                             </p:column>
							<p:column headerText="#{msgs.label_processId}">
								<h:outputText value="#{row.processId}" />
							</p:column>
							<p:column headerText="#{msgs.label_processName}">
								<h:outputText value="#{row.processName}" />
							</p:column>
							<p:column headerText="#{msgs.label_delegatorId}">
								<h:outputText value="#{row.empId}" />
							</p:column>
							<p:column headerText="#{msgs.label_delegatorName}">
								<h:outputText value="#{row.empName}" />
							</p:column>
							<p:column headerText="#{msgs.label_delegateeId}">
								<h:outputText value="#{row.delegateId}" />
							</p:column>
							<p:column headerText="#{msgs.label_delegateeName}">
								<h:outputText value="#{row.delegateName}" />
							</p:column>
							<p:column rendered="#{delegations.pageMode != 2}" headerText="#{msgs.label_delete}">
								<h:commandButton value="&#xf00d;" styleClass="btn btn-trans-icon" action="#{delegations.deletePartialDelegation(row)}" onclick="return confirm('#{msgs.q_delete}');" title="#{msgs.label_delete}">
									<f:ajax render="partialDelegListId">
									</f:ajax>
								</h:commandButton>
							</p:column>
						</p:dataTable>
					</td>
				</tr>
				<tr>
					<td width="100%" height="30" />
				</tr>
			</table>
		</ui:decorate>
	</h:form>
</h:body>
</html>