<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:p="http://primefaces.org/ui" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:f="http://java.sun.com/jsf/core" xmlns:util="http://java.sun.com/jsf/composite/util" xmlns:code="http://java.sun.com/jsf/composite/code">
<h:head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

	<h:outputStylesheet library="css" name="styles.css" />
	<h:outputStylesheet library="css" name="bootstrap.css" />
	<h:outputScript name="utilities.js" library="javascript" target="head" />
	<script type="text/javascript">
	var m;
	var index;
	var multi = false;
	function getValue(contextPath , mode ,ind, multiple, empGroup){
		m = mode;
		index = ind;
		multi = multiple;
		if (mode==1) {
			openDepartmentsMiniSearch(contextPath, 1, null, null);
		} else {
			if(multiple){
				openEmpsMiniSearchMultipleSelection(contextPath, 1, empGroup);
			}else{
				openEmpsMiniSearch(contextPath, 1);
			}
		}
		return false;
	}

	function HandlePopupResult(ret) {
	   	unMaskScreen(); 
		if(ret!=null){ 
			if(m == 1){
	         	document.getElementById('formId:detailTableId:'+index+':selectedDepartmentIdId').value=ret[0];
	         	document.getElementById('formId:detailTableId:'+index+':selectedDepartmentHiddenNameId').value=ret[1];
	         	document.getElementById('formId:detailTableId:'+index+':selectedDepartmentNameId').innerHTML=ret[1];
			}else if(m == 2){
				if(multi){
					document.getElementById('formId:detailTableId:'+index+':selectedEmpGroupIdId').value=ret[0];
					document.getElementById('formId:detailTableId:'+index+':updateSelectedEmployeeId').click();
				}
				else {
					document.getElementById('formId:detailTableId:'+index+':selectedEmployeeIdId').value=ret[0];
		         	document.getElementById('formId:detailTableId:'+index+':selectedEmployeeHiddenNameId').value=ret[1];
		         	document.getElementById('formId:detailTableId:'+index+':selectedEmployeeNameId').innerHTML=ret[1];
				}
			}
	        return true;
		}
		return false;
	}

	function releaseMask(){
		unMaskScreen();
   	}

	
    </script>
</h:head>
<h:body styleClass="screenBg">
	<h:form id="formId" dir="#{msgs.dir}">
		<ui:decorate template="/Main/Template.xhtml">

			<table border="0" cellpadding="0" cellspacing="0" width="100%">

				<tr>
					<td width="100%" height="0" />
				</tr>

				<tr>
					<td class="screenTitle">
						<h:outputText value="#{msgs.title_WfPositions}" />
					</td>
				</tr>


				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td colspan="2">
						<table class="sectionTitle" border="0" cellpadding="0" cellspacing="0">
							<tr>
								<td>
									<h:outputText value="#{msgs.label_searchData}" />
								</td>
							</tr>
						</table>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td>
						<h:panelGroup id="searchContainerId">
							<table class="sectionContent" border="0" cellpadding="0" cellspacing="0">
								<tr>
									<th width="10%">
										<h:outputText value="#{msgs.label_posDesc}" />
									</th>
									<td width="20%">
										<h:inputText styleClass="form-control" value="#{wfPositions.posDesc}" />
									</td>

									<td width="70%"></td>

								</tr>
							</table>
						</h:panelGroup>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td width="100%">
						<table class="actionsSection" border="0" cellpadding="0" cellspacing="0">
							<tr>
								<td width="100%">
									<h:commandButton class="btn btn-success" value="&#xf021; #{msgs.label_reset}" title="#{msgs.label_reset}" action="#{wfPositions.resetSearch()}">
										<f:ajax render="formId:searchContainerId" />
									</h:commandButton>
									<h:commandButton class="btn btn-success" value="&#xf002; #{msgs.label_search}" title="#{msgs.label_search}" action="#{wfPositions.search()}">
										<f:ajax render="formId:searchContainerId formId:detailId" execute="formId:searchContainerId" />
									</h:commandButton>
								</td>
							</tr>
						</table>
					</td>
				</tr>


				<tr>
					<td>
						<table class="sectionTitle" border="0" cellpadding="0" cellspacing="0">
							<tr>
								<td>
									<h:outputText value="#{msgs.title_searchResults}" />
								</td>
							</tr>
						</table>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>


				<tr>
					<td align="center" width="100%">
						<h:panelGroup id="detailId">
							<p:dataTable reflow="true" id="detailTableId" tableStyle="table-layout: auto" paginator="true" rows="10" rowIndexVar="index" var="row" value="#{wfPositions.wfPositionList}" rowHover="true">
								<p:column styleClass='centerText'>
									<f:facet name="header">
										<h:outputText value="#" />
									</f:facet>
									<h:outputText value="#{index + 1}" />
								</p:column>

								<p:column styleClass='centerText'>
									<f:facet name="header">
										<h:outputText value="#{msgs.label_posDesc}" />
									</f:facet>
									<h:outputText value="#{row.positionDesc}" />
								</p:column>

								<p:column styleClass='centerText'>
									<f:facet name="header">
										<h:outputText value="#{msgs.label_value}" />
									</f:facet>
									<h:panelGroup rendered="#{wfPositions.unitPosDiscriminator == row.discriminator}">
										<h:commandButton value="&#xf002;" styleClass="btn btn-trans-icon" onclick="return getValue('#{request.contextPath}',1,#{index});" />
										<h:inputHidden id="selectedDepartmentIdId" value="#{row.unitId}" />
										<h:inputHidden id="selectedDepartmentHiddenNameId" value="#{row.unitName}" />
										<h:outputText id="selectedDepartmentNameId" value="#{row.unitName}" />
									</h:panelGroup>
									<h:panelGroup rendered="#{wfPositions.empPosDiscriminator == row.discriminator}">
										<h:commandButton value="&#xf002;" styleClass="btn btn-trans-icon" onclick="return getValue('#{request.contextPath}',2,#{index},false);" />
										<h:inputHidden id="selectedEmployeeIdId" value="#{row.empId}" />
										<h:inputHidden id="selectedEmployeeHiddenNameId" value="#{row.empName}" />
										<h:outputText id="selectedEmployeeNameId" value="#{row.empName}" />
									</h:panelGroup>
									<h:panelGroup rendered="#{wfPositions.empsGroupsDiscriminator == row.discriminator}">
										<h:commandButton value="&#xf002;" styleClass="btn btn-trans-icon" onclick="return getValue('#{request.contextPath}',2,#{index},true,'#{row.empsGroup}');" />
										<h:inputHidden id="selectedEmpGroupIdId" value="#{row.empsGroup}" />
										<h:commandButton id="updateSelectedEmployeeId" action="#{wfPositions.updateEmpGroup(row)}" style="display:none;" />
										<h:outputText value="#{row.empName}" />
									</h:panelGroup>
								</p:column>

								<p:column styleClass='centerText'>
									<f:facet name="header">
										<h:outputText value="#{msgs.label_depManager}" />
									</f:facet>
									<h:outputText value="#{row.posDepManagerName}" />
								</p:column>

								<p:column styleClass='centerText'>
									<f:facet name="header">
										<h:outputText value="#{msgs.label_email}" />
									</f:facet>
									<h:outputText value="#{row.posDepManagerEmail}" rendered="#{not empty row.unitId}" />
									<h:outputText value="#{row.posEmployeeEmail}" rendered="#{not empty row.empId}" />
								</p:column>

								<p:column styleClass='centerText'>
									<f:facet name="header">
										<h:outputText value="#{msgs.label_save}" />
									</f:facet>
									<h:commandButton value="&#xf0c7;" styleClass="btn btn-trans-icon" action="#{wfPositions.savePosition(row)}">
										<f:ajax render="formId:detailId" execute="formId:detailId" />
									</h:commandButton>
								</p:column>

							</p:dataTable>
						</h:panelGroup>
					</td>
				</tr>

			</table>
		</ui:decorate>
	</h:form>
</h:body>
</html>