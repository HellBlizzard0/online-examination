<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:p="http://primefaces.org/ui" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:f="http://java.sun.com/jsf/core"
      xmlns:util="http://java.sun.com/jsf/composite/util">
<h:head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

	<h:outputStylesheet library="css" name="styles.css" />
	<h:outputStylesheet library="css" name="grid.css" />
	<h:outputScript name="utilities.js" library="javascript" target="head" />
	<script type="text/javascript">          
          var index;
          var mode;
          function getEmp(i, contextPath){
        	 index = i;
        	 mode=1;
        	 openEmpsMiniSearch(contextPath, 1);
          }

          function getAssignee(contextPath){
              mode=2;
              openEmpsMiniSearch(contextPath, 1);
	      }

          function getWorkflow(contextPath, instanceId){
              openWorkflowRepresentation(contextPath, 1, instanceId);
	      }
          
          function HandlePopupResult(ret){
        	  if(ret != null){
            	  if (mode==1){
	                  document.getElementById('wfInboxForm:searchEmpValue').value = ret[0];
	                  document.getElementById('wfInboxForm:selectedIndex').value = index;
	                  document.getElementById('wfInboxForm:searchEmpButton').click();
            	  }
            	  if (mode==2) {
			          document.getElementById('wfInboxForm:searchAssigneeIDId').value = ret[0];
			          document.getElementById('wfInboxForm:searchAssigneeNameId').innerHTML = ret[1];
			          document.getElementById('wfInboxForm:searchAssigneeBtnId').click();
               }
         	 }
          }

	      function releaseMask(){
	          unMaskScreen();
	     }

	     function uploadFile(){
	   		 fileArchivingParam = document.getElementById('wfInboxForm:fileArchivingParamId').value;
	   		 if(fileArchivingParam != ""){
	   		 	openUploadFile('#{wfInbox.boolServerUploadPath}', fileArchivingParam);
	   		 }
	   		 return false;
         }

	     window.onkeypress = function(e) {
   		  var keyCode = window.event.keyCode || e.keyCode || e.which;
   	      if (keyCode == '13') {
   	    	  return false;
   	      }
   	  };
         </script>
</h:head>
<h:body styleClass="screenBg" onload="uploadFile();">
	<f:event type="preRenderComponent" listener="#{wfInbox.init}" />
	<h:form id="wfInboxForm" dir="#{msgs.dir}">
		<ui:decorate template="/Main/Template.xhtml">

			<table border="0" cellpadding="0" cellspacing="0" width="100%">


				<tr>
					<td class="screenTitle">
						<h:outputText value="#{wfInbox.screenTitle}" />
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td>
						<table class="sectionContent" border="0" cellpadding="0" cellspacing="0">
							<h:panelGroup rendered="#{wfInbox.admin}">
								<tr>
									<th width="15%">
										<h:outputText value="#{msgs.label_selectEmp}" />
									</th>
									<td width="35%" colspan="3">
										<h:outputText id="searchAssigneeNameId" value="#{wfInbox.searchByAssigneeName}" />
										<h:inputHidden id="searchAssigneeIDId" value="#{wfInbox.searchByAssigneeId}" />
										<h:commandButton title="#{msgs.label_selectEmp}" onclick="getAssignee('#{request.contextPath}'); return false;" value="&#xf002;" styleClass="btn btn-trans-icon" />
										<h:commandButton id="searchAssigneeBtnId" action="#{wfInbox.searchByAssigneeId}" style="display: none;">
											<f:ajax render="notifyMessagesId tasksId" execute="searchAssigneeIDId" />
										</h:commandButton>
									</td>
								</tr>
							</h:panelGroup>
							<tr>
								<th width="15%">
									<h:outputText value="#{msgs.label_searchBy}" />
								</th>
								<td width="40%">
									<h:selectOneMenu styleClass="form-control w-select-10" value="#{wfInbox.selectedProcessGroupId}">
										<f:selectItem itemLabel="#{msgs.label_searchByModule}" itemValue="0" />
										<f:selectItems value="#{wfInbox.processesGroups}" var="pG" itemLabel="#{pG.processGroupName}" itemValue="#{pG.processGroupId}" />

										<f:ajax event="change" listener="#{wfInbox.searchProcesses}" execute="@this" render="notifyMessagesId processesId tasksId" />
									</h:selectOneMenu>
									<h:selectOneMenu styleClass="form-control w-select-60" id="processesId" value="#{wfInbox.selectedProcessId}">
										<f:selectItem itemLabel="#{msgs.label_searchByProcess}" itemValue="0" />
										<f:selectItems value="#{wfInbox.processes}" var="p" itemLabel="#{p.processName}" itemValue="#{p.processId}" />

										<f:ajax event="change" listener="#{wfInbox.searchByProcess}" execute="@this" render="notifyMessagesId tasksId" />
									</h:selectOneMenu>
								</td>
								<td width="5%"></td>
								<td width="40%" colspan="0">
									<h:selectOneRadio value="#{wfInbox.selectedTaskRole}">
										<f:selectItem itemLabel="#{msgs.label_all}" itemValue="-1" />
										<f:selectItem itemLabel="#{msgs.label_actionsOnly}" itemValue="1" />
										<f:selectItem itemLabel="#{msgs.label_notifications}" itemValue="2" />
										<f:ajax event="change" listener="#{wfInbox.searchProcesses}" execute="@this" render="notifyMessagesId tasksId" />
									</h:selectOneRadio>
								</td>
							</tr>
							<tr>
								<th width="15%">
									<h:outputText value="#{msgs.label_searchByTaskOwner}" />
								</th>
								<td width="40%">
									<h:inputText styleClass="inputWithIcon" id="taskOwnerNameId" value="#{wfInbox.searchByTaskOwnerName}" />
									<h:commandButton action="#{wfInbox.searchByTaskOwner}" title="#{msgs.label_search}" value="&#xf002;" styleClass="btn btn-trans-icon">
										<f:ajax render="notifyMessagesId tasksId" execute="taskOwnerNameId" />
									</h:commandButton>
								</td>
								
								<td width="5%">
									<h:commandButton action="#{wfInbox.sortASC}" title="#{msgs.label_sortAsc}" value="&#xf0d8;" styleClass="btn btn-trans-icon">
										<f:ajax render="notifyMessagesId tasksId" />
									</h:commandButton>
									<h:commandButton action="#{wfInbox.sortDESC}" title="#{msgs.label_sortDesc}" value="&#xf0d7;" styleClass="btn btn-trans-icon">
										<f:ajax render="notifyMessagesId tasksId" />
									</h:commandButton>
								</td>
								<td width="40%"></td>
							</tr>

							<tr>
								<th width="15%">
									<h:outputText value="#{msgs.label_searchByTaskDetails}" />
								</th>
								<td width="40%">
									<h:inputText styleClass="inputWithIcon" id="taskDetailsId" value="#{wfInbox.searchByTaskDetails}">
									</h:inputText>
									<h:commandButton action="#{wfInbox.searchByTaskDetails}" title="#{msgs.label_search}" value="&#xf002;" styleClass="btn btn-trans-icon">
										<f:ajax execute="taskDetailsId" render="notifyMessagesId tasksId" />
									</h:commandButton>
								</td>
								
							</tr>

							<tr>
								<th width="15%">#{msgs.label_taskDate}</th>
								<td width="40%">
									<util:advancedHijriDate id="fromDateId" value="#{wfInbox.fromDate}" />
									#{msgs.label_to}
									<util:advancedHijriDate id="toDateId" value="#{wfInbox.toDate}" />
									<h:commandButton action="#{wfInbox.searchByTaskDetails}" title="#{msgs.label_search}" value="&#xf002;" styleClass="btn btn-trans-icon">
										<f:ajax execute="fromDateId toDateId" render="notifyMessagesId tasksId" />
									</h:commandButton>
								</td>
								
							</tr>

						</table>
					</td>
				</tr>

				<tr>
					<td width="100%" height="15" />
				</tr>

				<tr>
					<td width="100%">
						<h:panelGroup id="currentDoneProcessesId">
							<div class="tab-border">
								<h:commandButton action="#{wfInbox.getRunningTasks}" value="#{msgs.label_currentTransactions} &nbsp; #{msgs.fa_cogs}" styleClass="btn_normal_icon #{wfInbox.runningFlag ? 'selected-tab' : ''}">
									<f:ajax render="notifyMessagesId tasksId currentDoneProcessesId" />
								</h:commandButton>
								<h:commandButton action="#{wfInbox.getDoneCompletedTasks}" value="#{msgs.label_previousTransactions} &nbsp; #{msgs.fa_chevron_circle_left}" styleClass="btn_normal_icon #{wfInbox.runningFlag ? '' : 'selected-tab'}">
									<f:ajax render="notifyMessagesId tasksId currentDoneProcessesId" />
								</h:commandButton>
							</div>
						</h:panelGroup>
					</td>
				</tr>

				<tr>
					<td align="center" width="100%" class="tab-body">
						<p:dataTable tableStyle="table-layout:auto" styleClass="tab-inner-border" reflow="true" liveResize="true" paginator="true" id="tasksId" rowIndexVar="index" var="task" value="#{wfInbox.tasks}" rows="#{wfInbox.pageSize}" rowHover="true">
							<p:column sortBy="#{task.taskId}">
								<f:facet name="header">
									<h:outputText value="#{msgs.label_taskId}" />
								</f:facet>
								<h:outputText value="#{task.taskId}" />
							</p:column>
							<p:column sortBy="#{task.processName}">
								<f:facet name="header">
									<h:outputText value="#{msgs.label_processName}" />
								</f:facet>
								<h:outputText rendered="#{wfInbox.admin}" value="#{task.processName}" />
								<h:outputLink style="color: red !important; font-size: 16px !important; text-decoration: underline !important;" rendered="#{task.processId == 15 and !wfInbox.admin}" value="#{task.taskUrl}">#{task.processName}</h:outputLink>
								<h:outputLink style="color: blue !important; text-decoration: underline !important;" rendered="#{task.processId != 15 and !wfInbox.admin}" value="#{task.taskUrl}">#{task.processName}</h:outputLink>
							</p:column>
							<p:column sortBy="#{task.taskOwnerName}">
								<f:facet name="header">
									<h:outputText value="#{msgs.label_processRequester}" />
								</f:facet>
								<h:outputText value="#{task.taskOwnerName}" />
							</p:column>
							<p:column sortBy="#{task.arabicDetailsSummary}" rendered="#{msgs.dir == 'rtl'}">
								<f:facet name="header">
									<h:outputText value="#{msgs.label_taskSummary}" />
								</f:facet>
								<h:outputText value="#{task.arabicDetailsSummary}" />
							</p:column>
							<p:column sortBy="#{task.englishDetailsSummary}" rendered="#{msgs.dir == 'ltr'}">
								<f:facet name="header">
									<h:outputText value="#{msgs.label_taskSummary}" />
								</f:facet>
								<h:outputText value="#{task.englishDetailsSummary}" />
							</p:column>
							<p:column sortBy="#{task.assignDate}">
								<f:facet name="header">
									<h:outputText value="#{msgs.label_taskDate}" />
								</f:facet>
								<h:outputText value="#{task.hijriAssignDateString}" />
							</p:column>
							<p:column sortBy="#{task.delegatingName}">
								<f:facet name="header">
									<h:outputText value="#{msgs.label_delegatingName}" />
								</f:facet>
								<h:outputText value="#{task.delegatingName}" />
							</p:column>
							<p:column rendered="#{!wfInbox.viewDelegation}" sortBy="#{task.action}">
								<f:facet name="header">
									<h:outputText value="#{msgs.label_taskAction}" />
								</f:facet>
								<h:outputText value="#{task.action}" />
							</p:column>
							<p:column rendered="#{!wfInbox.viewDelegation}" sortBy="#{task.actionDate}">
								<f:facet name="header">
									<h:outputText value="#{msgs.label_taskActionDate}" />
								</f:facet>
								<h:outputText value="#{task.hijriActionDateString}" />
							</p:column>
							<p:column rendered="#{wfInbox.viewDelegation and !wfInbox.admin}">
								<f:facet name="header">
									<h:outputText value="#{msgs.label_delegation}" />
								</f:facet>
								<h:commandButton value="" title="#{msgs.label_selectEmp}" image="/resources/images/lov.png" onclick="getEmp(#{index},'#{request.contextPath}'); return false;" />
							</p:column>
							<p:column>
								<f:facet name="header">
									<h:outputText value="#{msgs.label_workFlowProgress}" />
								</f:facet>
								<p:commandButton value="&#xf03a;" styleClass="btn btn-trans-icon" onclick="getWorkflow('#{request.contextPath}', '#{task.instanceId}'); return false;" />
							</p:column>
						</p:dataTable>

					</td>
				</tr>

			</table>
		</ui:decorate>

		<h:inputHidden id="fileArchivingParamId" value="#{wfInbox.fileArchivingParam}" />
		<h:inputHidden id="searchEmpValue" value="#{wfInbox.searchEmpId}" />
		<h:inputHidden id="selectedIndex" value="#{wfInbox.selectedGridIndex}" />
		<h:commandButton id="searchEmpButton" style="display: none;" action="#{wfInbox.delegateTaskEmployee}">
			<f:ajax render="wfInboxForm:tasksId notifyMessagesId" execute="searchEmpValue selectedIndex" />
		</h:commandButton>
	</h:form>
</h:body>
</html>