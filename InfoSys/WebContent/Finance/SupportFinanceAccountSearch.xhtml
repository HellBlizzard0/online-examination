<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:p="http://primefaces.org/ui" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:f="http://java.sun.com/jsf/core" xmlns:util="http://java.sun.com/jsf/composite/util" xmlns:code="http://java.sun.com/jsf/composite/code">
<h:head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

	<h:outputStylesheet library="css" name="styles.css" />
	<h:outputStylesheet library="css" name="bootstrap.css" />
	<h:outputScript name="utilities.js" library="javascript" target="head" />
	<script type="text/javascript">
		function confirmAndValidate(q_confirm, errorMsg1, errorMsg2){
			/* <![CDATA[ */
			if(confirm(q_confirm)){
				support = document.getElementById('formId:totalSupportAmountId').value;
				rewardSupport = document.getElementById('formId:monthlyRewardSupportAmountId').value;
				regionsSupport = document.getElementById('formId:regionsSupportSupportAmountId').value;
				support = support.replace(/,/g, '');
				rewardSupport = rewardSupport.replace(/,/g, '');
				regionsSupport = regionsSupport.replace(/,/g, '');
	
				if(parseFloat(support) != support || parseFloat(regionsSupport) != regionsSupport ||  parseFloat(rewardSupport) != rewardSupport){
					showErrorMessage(errorMsg1);
					return false;
				}else if(!(support > 0) || (!(regionsSupport > 0) && !(rewardSupport > 0))){
					showErrorMessage(errorMsg2);
	     			return false;
			     }
				if(parseFloat(support) != parseFloat(rewardSupport) + parseFloat(regionsSupport)){
					showErrorMessage('#{msgs.error_supportBalanceNotDivided}');
					return false;
				}
				return true;
			}
			return false;
			/* ]]> */
		}

		window.onkeypress = function(e) {
			  var keyCode = window.event.keyCode || e.keyCode || e.which;
		      if (keyCode == '13') {
		    	  document.getElementById('formId:searchButtonId').click();
		    	  return false;
		      }
		};
    </script>
</h:head>
<h:body styleClass="screenBg">
	<h:form id="formId" dir="#{msgs.dir}">
		<ui:decorate template="/Main/Template.xhtml">

			<table border="0" cellpadding="0" cellspacing="0" width="100%">

				<tr>
					<td width="100%" height="0" />
				</tr>

				<tr>
					<td class="screenTitle">
						#{msgs.title_supportFinanceSearch}
						<h:outputText value="#{supportSearch.errorMessage}" />
					</td>
				</tr>


				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td colspan="2">
						<table class="sectionTitle" border="0" cellpadding="0" cellspacing="0">
							<tr>
								<td>
									<h:outputText value="#{msgs.label_searchData}" />
								</td>
							</tr>
						</table>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td>
						<h:panelGroup id="searchContainerId">
							<table class="sectionContent" border="0" cellpadding="0" cellspacing="0">


								<tr>
									<th width="15%">#{msgs.label_financialYear}</th>
									<td colspan="6">
										<h:outputText value="#{supportSearch.yearApproval.finYear}  #{supportSearch.finHijriYearsString}" />
									</td>
								</tr>
								<tr>
									<th width="15%">#{msgs.label_fromDate}</th>
									<td width="20%">
										<util:advancedHijriDate value="#{supportSearch.fromDate}" />
									</td>
									
									<th width="15%">#{msgs.label_toDate}</th>
									<td width="20%">
										<util:advancedHijriDate value="#{supportSearch.toDate}" />
									</td>

								</tr>

							</table>
						</h:panelGroup>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td width="100%">
						<table class="actionsSection" border="0" cellpadding="0" cellspacing="0">
							<tr>
								<td width="100%">
									<h:commandButton class="btn btn-success" value="&#xf021; #{msgs.label_reset}" title="#{msgs.label_reset}" action="#{supportSearch.resetSearch()}">
										<f:ajax render="formId:searchContainerId formId:collapsiblePanelId formId:supportDetailId" />
									</h:commandButton>
									<h:commandButton id="searchButtonId" class="btn btn-success" value="&#xf002; #{msgs.label_search}" title="#{msgs.label_search}" action="#{supportSearch.search()}">
										<f:ajax render="formId:searchContainerId formId:collapsiblePanelId formId:supportDetailId" execute="formId:searchContainerId" />
									</h:commandButton>
								</td>
							</tr>
						</table>
					</td>
				</tr>


				<tr>
					<td>
						<table class="sectionTitle" border="0" cellpadding="0" cellspacing="0">
							<tr>
								<td>
									<h:outputText value="#{msgs.label_searchData}" />
								</td>
							</tr>
						</table>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td>
						<p:fieldset toggleable="true" id="collapsiblePanelId" legend="#{msgs.label_edit}" collapsed="#{(not supportSearch.suppExpendFlag) and (empty supportSearch.selectedFinYearAccountSupport.id)}">
							<table width="100%">
								<tr>
									<td>
										<table class="sectionContent" border="0" cellpadding="0" cellspacing="0">
											<tr>
												<th width="15%">#{msgs.label_totalSupportAmount}</th>
												<td width="20%">
													<h:inputText styleClass="inputWithIcon" id="totalSupportAmountId" value="#{supportSearch.supportAmount}" onkeypress="return checkFloat(event)" onblur="return isDigitFloat(this)" maxlength="32">
														<f:converter converterId="com.code.ui.converters.CSNumberConverter" />
														<f:ajax event="blur" execute="@this" render="@this" />
													</h:inputText>
													#{msgs.label_riyal}
												</td>
												<td width="65%"></td>
											</tr>
											<tr>
												<th width="15%">#{msgs.label_monthlyRewardAccount}</th>
												<td width="20%">
													<h:inputText styleClass="inputWithIcon" id="monthlyRewardSupportAmountId" value="#{supportSearch.selectedFinYearAccountSupport.rewardSupportBalance}" onkeypress="return checkFloat(event)" onblur="return isDigitFloat(this)" maxlength="32">
														<f:converter converterId="com.code.ui.converters.CSNumberConverter" />
														<f:ajax event="blur" execute="@this" render="@this" />
													</h:inputText>
													#{msgs.label_riyal}
												</td>
												<td width="65%"></td>

											</tr>
											<tr>
												<th width="15%">#{msgs.label_regionsSupportAccount}</th>
												<td width="20%">
													<h:inputText styleClass="inputWithIcon" id="regionsSupportSupportAmountId" value="#{supportSearch.selectedFinYearAccountSupport.regionsSupportBalance}" onkeypress="return checkFloat(event)" onblur="return isDigitFloat(this)" maxlength="32">
														<f:converter converterId="com.code.ui.converters.CSNumberConverter" />
														<f:ajax event="blur" execute="@this" render="@this" />
													</h:inputText>
													#{msgs.label_riyal}
												</td>
												<td width="65%"></td>
											</tr>
										</table>
									</td>
								</tr>
								<tr>
									<td width="100%" height="15" />
								</tr>
								<tr>
									<td>
										<table class="actionsSection" border="0" cellpadding="0" cellspacing="0">
											<tr>
												<td width="100%">
													<h:commandButton rendered="#{ not empty supportSearch.selectedFinYearAccountSupport.id}" id="saveBtnId" styleClass="btn btn-success" action="#{supportSearch.saveSupport()}" value="&#xf0c7; #{msgs.label_save}" onclick="return confirmAndValidate('#{msgs.q_save}', '#{msgs.error_supportNumbersOnly}', '#{msgs.error_supportMoreThanZero}');">
														<f:ajax render="formId:collapsiblePanelId formId:supportDetailId" execute="formId:collapsiblePanelId" />
													</h:commandButton>
												</td>
											</tr>
										</table>
									</td>
								</tr>
							</table>
						</p:fieldset>
					</td>
				</tr>

				<tr>
					<td align="center" width="100%">
						<h:panelGroup id="supportDetailId">
							<p:dataTable reflow="true" tableStyle="table-layout: auto" paginator="true" rows="10" rowIndexVar="index" var="row" value="#{supportSearch.yearAccountSupport}" rowHover="true">
								<p:column styleClass='centerText'>
									<f:facet name="header">#</f:facet>
	                                #{index + 1}
	                            </p:column>
								<p:column styleClass='centerText'>
									<f:facet name="header">#{msgs.label_supportDate} </f:facet>
									<h:outputText value="#{row.supportDateString}" />
								</p:column>
								<p:column styleClass='centerText'>
									<f:facet name="header"> #{msgs.label_totalSupportAmount} </f:facet>
									<h:outputText value="#{row.regionsSupportBalance + row.rewardSupportBalance}">
										<f:converter converterId="com.code.ui.converters.CSNumberConverter" />
									</h:outputText>
								</p:column>

								<p:column styleClass='centerText'>
									<f:facet name="header">#{msgs.label_regionsSupportAccount} </f:facet>
									<h:outputText value="#{row.regionsSupportBalance}">
										<f:converter converterId="com.code.ui.converters.CSNumberConverter" />
									</h:outputText>
								</p:column>

								<p:column styleClass='centerText'>
									<f:facet name="header"> #{msgs.label_monthlyRewardAccount} </f:facet>
									<h:outputText value="#{row.rewardSupportBalance}">
										<f:converter converterId="com.code.ui.converters.CSNumberConverter" />
									</h:outputText>
								</p:column>

								<p:column styleClass='centerText'>
									<f:facet name="header"> #{msgs.label_edit} </f:facet>
									<h:commandButton value="&#xf14b;" styleClass="btn btn-trans-icon" action="#{supportSearch.editSupport(row,index)}">
										<f:ajax render="formId:collapsiblePanelId" />
									</h:commandButton>
								</p:column>
								<p:column styleClass='centerText'>
									<f:facet name="header"> #{msgs.label_delete} </f:facet>
									<h:commandButton id="deleteDetailBtnId" value="&#xf00d;" styleClass="btn btn-trans-icon" action="#{supportSearch.deleteSupport(row)}" onclick="return confirm('#{msgs.q_delete}');">
										<f:ajax render="formId:supportDetailId formId:collapsiblePanelId" />
									</h:commandButton>
								</p:column>
							</p:dataTable>
						</h:panelGroup>
					</td>
				</tr>

			</table>
		</ui:decorate>
	</h:form>
</h:body>
</html>