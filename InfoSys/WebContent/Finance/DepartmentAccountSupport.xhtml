<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:p="http://primefaces.org/ui" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:f="http://java.sun.com/jsf/core" xmlns:util="http://java.sun.com/jsf/composite/util" xmlns:code="http://java.sun.com/jsf/composite/code">
<h:head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

	<h:outputStylesheet library="css" name="styles.css" />
	<h:outputStylesheet library="css" name="grid.css" />
	<h:outputStylesheet library="css" name="bootstrap.css" />

	<h:outputScript name="utilities.js" library="javascript" target="head" />
	<script type="text/javascript">
		function getDepartment(contextPath) {
			openDepartmentsMiniSearch(contextPath, 5, null, null);
			return false;
		}
		function releaseMask() {
			unMaskScreen();
		}
		function HandlePopupResult(ret) {
			unMaskScreen();
			if (ret != null) {
				document.getElementById('departmentAccountSupportFormId:departmentSearchIdId').value = ret[0];
				document.getElementById('departmentAccountSupportFormId:departmentSearchNameId').value = ret[1];
				document.getElementById('departmentAccountSupportFormId:departmentSearchNameViewId').innerHTML = ret[1];
				return true;
			}
			return false;
		}
		function validateDepSupport(errorMsg1, errorMsg2, errorMsg3, errorMsg4) {
			/* <![CDATA[ */
			var departmentId = document.getElementById('departmentAccountSupportFormId:departmentSearchIdId').value;
			if (!(parseInt(departmentId) > 0) && parseInt(departmentId) != departmentId) {
				showErrorMessage(errorMsg1);
				return false;
			}

			var supportAmount = parseFloat(document.getElementById('departmentAccountSupportFormId:supportAmountEditId').value + ".0");
			if (parseFloat(supportAmount) != supportAmount) {
				showErrorMessage(errorMsg2);
				return false;
			} else if (!(supportAmount > 0)) {
				showErrorMessage(errorMsg3);
				return false;
			}

			var oldSupportAmount = document.getElementById('departmentAccountSupportFormId:oldSupportAmountId').value;
			var totalSupportAmount = document.getElementById('departmentAccountSupportFormId:depsSupportDetailListDataTableId:totalSupportAmountId').innerHTML;
			var balance = document.getElementById('departmentAccountSupportFormId:initialBalanceId').value;
			if (parseFloat(totalSupportAmount.replace(/,/g, '')) + supportAmount - parseFloat(oldSupportAmount.replace(/,/g, '')) > parseFloat(balance.replace(/,/g, ''))) {
				showErrorMessage(errorMsg4);
				return false;
			}
			/* ]]> */
			return true;
		}
	</script>
</h:head>
<h:body styleClass="screenBg">
	<h:form id="departmentAccountSupportFormId" dir="#{msgs.dir}">
		<ui:decorate template="/Main/Template.xhtml">
			<table border="0" cellpadding="0" cellspacing="0" width="100%">
				<tr>
					<td class="screenTitle">#{msgs.title_finDepSupportRequest}</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<h:panelGroup rendered="#{not empty departmentAccountSupport.errorMessage}">
					<tr>
						<td colspan="2">
							<table class="sectionTitle" border="0" cellpadding="0" cellspacing="0">
								<tr>
									<td>
										<h:outputText style="text-align:center; color: red; font-weight: 600;" value="#{departmentAccountSupport.errorMessage}" />
									</td>
								</tr>
							</table>
						</td>
					</tr>

					<tr>
						<td width="100%" height="5" />
					</tr>
				</h:panelGroup>

				<tr>
					<td colspan="2">
						<table class="sectionTitle" border="0" cellpadding="0" cellspacing="0">
							<tr>
								<td>
									<h:outputText value="#{msgs.label_requestData}" />
								</td>
							</tr>
						</table>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td>
						<table class="sectionContent" border="0" cellpadding="0" cellspacing="0">
							<tr>
								<th width="15%">#{msgs.label_requestNumber}</th>
								<td width="20%">
									<h:inputText disabled="true" styleClass="form-control" id="requestNoId" value="#{departmentAccountSupport.depSupport.requestNumber}" />
								</td>

								
								<th width="15%">#{msgs.label_requestDate}</th>
								<td width="20%">
									<h:inputText disabled="true" styleClass="form-control" id="requestDateId" value="#{departmentAccountSupport.depSupport.requestDateString}" />
								</td>

							</tr>

							<tr>
								<th width="15%">#{msgs.label_financialYear}</th>
								<td width="20%">
									<h:inputText disabled="true" styleClass="form-control" id="financialYearId" value="#{departmentAccountSupport.depSupport.finYear}" />
									<h:inputText disabled="true" styleClass="form-control" id="financialHijriYearsId" value="#{departmentAccountSupport.finHijriYearsString}" />
								</td>
								<td width="65%" colspan="6"></td>
							</tr>

							<tr>
								<th width="15%">#{msgs.label_subAccount}</th>
								<td width="20%">
									<h:inputText disabled="true" styleClass="form-control" id="accountNameId" value="#{msgs.label_regionsSupportAccount}" />
								</td>
								<td width="65%" colspan="6"></td>
							</tr>

							<tr>
								<th width="15%">#{msgs.label_currentBalance}</th>
								<td width="20%">
									<h:inputText disabled="true" styleClass="form-control" id="initialBalanceId" value="#{departmentAccountSupport.depSupport.balance}">
										<f:converter converterId="com.code.ui.converters.CSNumberConverter" />
									</h:inputText>
								</td>
								<td width="10%">#{msgs.label_riyal}</td>
								<td width="55%" colspan="4"></td>
							</tr>

							<tr>
								<th width="15%">#{msgs.label_reasonsRemarks}</th>
								<td width="20%">
									<h:inputTextarea disabled="#{departmentAccountSupport.pageMode != 2}" styleClass="form-control" id="remarksId" value="#{departmentAccountSupport.depSupport.remarks}" />
								</td>
								<td width="65%" colspan="6"></td>
							</tr>
						</table>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td colspan="2">
						<table class="sectionTitle" border="0" cellpadding="0" cellspacing="0">
							<tr>
								<td>
									<h:outputText value="#{msgs.label_supportAmountsDetailsForDepartment}" />
								</td>
							</tr>
						</table>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td>
						<p:fieldset rendered="#{departmentAccountSupport.pageMode == 2}" toggleable="true" id="depSupportDetailsSavePanelId" legend="#{msgs.label_insertEdit}" collapsed="#{not departmentAccountSupport.actionCollapseFlag}">
							<table width="100%">
								<tr>
									<td>
										<table class="sectionContent" border="0" cellpadding="0" cellspacing="0" width="100%">
											<tr>
												<th width="15%">#{msgs.label_departmentName}</th>
												<td width="20%">
													<h:commandButton value="&#xf002;" styleClass="btn btn-trans-icon" id="searchDepartmentBtnId" onclick="return getDepartment('#{request.contextPath}');" />
													<h:inputHidden id="departmentSearchIdId" value="#{departmentAccountSupport.depSupportDetail.departmentId}" />
													<h:inputHidden id="departmentSearchNameId" value="#{departmentAccountSupport.depSupportDetail.departmentName}" />
													<h:outputText id="departmentSearchNameViewId" value="#{departmentAccountSupport.depSupportDetail.departmentName}" />
												</td>
												
												<th width="15%">#{msgs.label_supportAmount}</th>
												<td width="20%">
													<h:inputText id="supportAmountEditId" value="#{departmentAccountSupport.depSupportDetail.supportAmount}" onkeypress="return checkFloat(event)" onblur="return isDigitFloat(this)" maxlength="32">
														<f:converter converterId="com.code.ui.converters.CSNumberConverter" />
														<f:ajax event="blur" render="@this" execute="@this" />
													</h:inputText>
													<h:inputHidden id="oldSupportAmountId" value="#{departmentAccountSupport.oldSupportAmount}" />
												</td>
											</tr>
										</table>
									</td>
								</tr>

								<tr>
									<td width="100%" height="5" />
								</tr>

								<tr>
									<td>
										<table class="actionsSection" border="0" cellpadding="0" cellspacing="0" width="100%">
											<tr>
												<td width="100%">
													<h:commandButton id="cancelBtnId" styleClass="btn btn-default" value="&#xf00d; #{msgs.label_cancel}" action="#{departmentAccountSupport.cancelDepSupportDetail()}">
														<f:ajax render="departmentAccountSupportFormId:depSupportDetailsSavePanelId departmentAccountSupportFormId:notifyMessagesId" />
													</h:commandButton>
													<h:commandButton id="addBtnId" styleClass="btn btn-success" action="#{departmentAccountSupport.addDepSupportDetail()}" value="&#xf14b; #{msgs.label_add}" onclick="return validateDepSupport('#{msgs.error_departmentMandatory}', '#{msgs.error_supportNumbersOnly}', '#{msgs.error_supportMoreThanZero}', '#{msgs.error_balanceIsNotEnough}');">
														<f:ajax render="departmentAccountSupportFormId:depSupportDetailsSavePanelId departmentAccountSupportFormId:depsSupportDetailsViewPanelId departmentAccountSupportFormId:notifyMessagesId" execute="departmentAccountSupportFormId:depSupportDetailsSavePanelId" />
													</h:commandButton>
												</td>
											</tr>
										</table>
									</td>
								</tr>
							</table>
						</p:fieldset>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td align="center" width="100%">
						<h:panelGroup id="depsSupportDetailsViewPanelId">
							<p:dataTable reflow="true" tableStyle="table-layout: auto" paginator="true" id="depsSupportDetailListDataTableId" rows="#{departmentAccountSupport.rowsCount}" rowIndexVar="index" var="row" value="#{departmentAccountSupport.depsSupportDetailList}" rowHover="true">
								<p:column styleClass='centerText'>
									<f:facet name="header">#</f:facet>
	                                #{index + 1}
	                            </p:column>
								<p:column styleClass='centerText'>
									<f:facet name="header"> #{msgs.label_departmentName} </f:facet>
									<h:outputText id="departmentNameViewId" value="#{row.departmentName}" />
								</p:column>
								<p:column styleClass='centerText'>
									<f:facet name="header"> #{msgs.label_totalSpent} </f:facet>
									<h:outputText id="totalSpentViewId" value="#{row.totalSpent}">
										<f:converter converterId="com.code.ui.converters.CSNumberConverter" />
									</h:outputText>
								</p:column>
								<p:column styleClass='centerText'>
									<f:facet name="header"> #{msgs.label_currentBalance} </f:facet>
									<h:outputText id="balanceViewId" value="#{row.balance}">
										<f:converter converterId="com.code.ui.converters.CSNumberConverter" />
									</h:outputText>
									<f:facet name="footer"> #{msgs.label_total} </f:facet>
								</p:column>
								<p:column styleClass='centerText'>
									<f:facet name="header"> #{msgs.label_supportAmount} </f:facet>
									<h:outputText id="supportAmountId" value="#{row.supportAmount}">
										<f:converter converterId="com.code.ui.converters.CSNumberConverter" />
									</h:outputText>
									<f:facet name="footer">
										<h:outputText id="totalSupportAmountId" value="#{departmentAccountSupport.totalSupportAmount}">
											<f:converter converterId="com.code.ui.converters.CSNumberConverter" />
										</h:outputText>
									</f:facet>
								</p:column>
								<p:column styleClass='centerText'>
									<f:facet name="header"> #{msgs.label_depSupportDetails} </f:facet>
									<h:commandButton id="depSupportBtnId" value="&#xf05a;" styleClass="btn btn-trans-icon" action="#{departmentAccountSupport.showDepSupport(row.departmentId)}">
										<f:ajax render="departmentAccountSupportFormId:notifyMessagesId departmentAccountSupportFormId:depSupportDetailsViewPanelId" />
									</h:commandButton>
								</p:column>
								<p:column styleClass='centerText' rendered="#{departmentAccountSupport.pageMode == 2}">
									<f:facet name="header"> #{msgs.label_edit} </f:facet>
									<h:commandButton id="editDetailBtnId" value="&#xf14b;" styleClass="btn btn-trans-icon" action="#{departmentAccountSupport.editDepSupportDetail(row)}">
										<f:ajax render="departmentAccountSupportFormId:notifyMessagesId departmentAccountSupportFormId:depSupportDetailsSavePanelId" />
									</h:commandButton>
								</p:column>
								<p:column styleClass='centerText' rendered="#{departmentAccountSupport.pageMode == 2}">
									<f:facet name="header"> #{msgs.label_delete} </f:facet>
									<h:commandButton id="deleteDetailBtnId" value="&#xf00d;" styleClass="btn btn-trans-icon" action="#{departmentAccountSupport.deleteDepSupportDetail(row)}" onclick="return confirm('#{msgs.q_delete}');">
										<f:ajax render="departmentAccountSupportFormId:notifyMessagesId departmentAccountSupportFormId:depsSupportDetailsViewPanelId" execute="departmentAccountSupportFormId:depsSupportDetailsViewPanelId" />
									</h:commandButton>
								</p:column>
							</p:dataTable>
						</h:panelGroup>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td align="center" width="100%">
						<h:panelGroup id="depSupportDetailsViewPanelId">
							<h:panelGroup rendered="#{not empty departmentAccountSupport.selectedDepartmentId}">
								<table width="100%">
									<tr>
										<td colspan="2">
											<table class="sectionTitle" border="0" cellpadding="0" cellspacing="0">
												<tr>
													<td>
														<h:outputText value="#{msgs.label_depSupportDetails}" />
													</td>
												</tr>
											</table>
										</td>
									</tr>

									<tr>
										<td width="100%" height="5" />
									</tr>

									<tr>
										<td>
											<p:dataTable reflow="true" tableStyle="table-layout: auto" paginator="true" id="depSupportDetailListDataTableId" rows="#{departmentAccountSupport.rowsCount}" rowIndexVar="index" var="row" value="#{departmentAccountSupport.depSupportDetailList}" rowHover="true">
												<p:column styleClass='centerText'>
													<f:facet name="header">#</f:facet>
					                                #{index + 1}
					                            </p:column>
												<p:column styleClass='centerText'>
													<f:facet name="header"> #{msgs.label_departmentName} </f:facet>
													<h:outputText id="departmentNameViewId" value="#{row.departmentName}" />
												</p:column>
												<p:column styleClass='centerText'>
													<f:facet name="header"> #{msgs.label_requestDate} </f:facet>
													<h:outputText id="requestDateViewId" value="#{row.requestDateString}" />
												</p:column>
												<p:column styleClass='centerText'>
													<f:facet name="header"> #{msgs.label_supportAmount} </f:facet>
													<h:outputText id="supportAmountId" value="#{row.supportAmount}">
														<f:converter converterId="com.code.ui.converters.CSNumberConverter" />
													</h:outputText>
												</p:column>
											</p:dataTable>
										</td>
									</tr>
								</table>
							</h:panelGroup>
						</h:panelGroup>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td>
						<h:panelGroup id="commentPanelId" rendered="#{departmentAccountSupport.pageMode == 1 and departmentAccountSupport.currentTask != null and departmentAccountSupport.role != 'Notification' and departmentAccountSupport.role != 'History' }">
							<table class="sectionContent" width="100%" border="0" cellpadding="0" cellspacing="0">
								<tr>
									<th width="15%">#{msgs.label_comment}</th>
									<td width="35%">
										<h:inputTextarea styleClass="form-control" id="depSupportApprovalRemarksId" value="#{departmentAccountSupport.currentTask.notes}" />
									</td>
									<td width="50%"></td>
								</tr>
							</table>
						</h:panelGroup>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td width="100%">
						<code:prevTasks rendered="#{not empty departmentAccountSupport.currentTask}" value="#{departmentAccountSupport.prevTasks}" />
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td>
						<table class="actionsSection" border="0" cellpadding="0" cellspacing="0">
							<tr>
								<td>
									<h:commandButton id="printBtnId" styleClass="btn btn-success" action="#{departmentAccountSupport.print()}" value="&#xf02f; #{msgs.label_print}" rendered="#{not empty departmentAccountSupport.depSupport.id}" />

									<h:commandButton rendered="#{departmentAccountSupport.registered and departmentAccountSupport.pageMode == 2}" id="sendBtnId" styleClass="btn btn-success" action="#{departmentAccountSupport.saveDepSupport()}" value="&#xf1d8; #{msgs.label_send}" onclick="return confirm('#{msgs.q_confirm}');" />

									<h:commandButton id="approveBtnId" styleClass="btn btn-success" action="#{departmentAccountSupport.approveDepSupport()}" value="&#xf00c; #{msgs.label_approve}" rendered="#{departmentAccountSupport.pageMode == 1 and departmentAccountSupport.currentTask != null and departmentAccountSupport.role != 'Notification' and departmentAccountSupport.role != 'History'}" onclick="return confirm('#{msgs.q_approve}');">
									</h:commandButton>

									<h:commandButton id="rejectBtnId" styleClass="btn btn-danger" action="#{departmentAccountSupport.rejectDepSupport()}" value="#{msgs.label_rejectForModification}" rendered="#{departmentAccountSupport.pageMode == 1 and departmentAccountSupport.currentTask != null and departmentAccountSupport.role != 'Notification' and departmentAccountSupport.role != 'History'}" onclick="return confirm('#{msgs.q_reject}');">
									</h:commandButton>

									<h:commandButton id="doNotifyBtnId" styleClass="btn btn-success" action="#{departmentAccountSupport.doNotify()}" value="#{msgs.label_notified}" rendered="#{departmentAccountSupport.pageMode == 1 and departmentAccountSupport.role == 'Notification'}">
									</h:commandButton>
								</td>
							</tr>
						</table>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>
			</table>
		</ui:decorate>
	</h:form>
</h:body>

</html>