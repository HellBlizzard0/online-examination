<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:of="http://omnifaces.org/functions" xmlns:o="http://omnifaces.org/ui" xmlns:h="http://java.sun.com/jsf/html" xmlns:util="http://java.sun.com/jsf/composite/util" xmlns:p="http://primefaces.org/ui" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:f="http://java.sun.com/jsf/core" xmlns:code="http://java.sun.com/jsf/composite/code">
<h:head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<h:outputStylesheet library="css" name="styles.css" />
	<h:outputStylesheet library="css" name="grid.css" />
	<h:outputStylesheet library="css" name="bootstrap.css" />

	<h:outputScript name="utilities.js" library="javascript" target="head" />

	<script type="text/javascript">
	function getMonthlyRewardDetails(contextPath,regionId,month,hijriYear) {
		openMonthlyRewardPaymentDetails(contextPath, 1, regionId,month,hijriYear);
		return false;
	}

	function releaseMask() {
		unMaskScreen();
	}
	
	</script>

</h:head>
<h:body styleClass="screenBg">
	<h:form id="monthlyRewardFormId" dir="#{msgs.dir}">
		<ui:decorate template="/Main/Template.xhtml">
			<table border="0" cellpadding="0" cellspacing="0" width="100%">


				<tr>
					<td class="screenTitle">
						<h:outputText rendered="#{  empty monthlyReward.finMonthlyReward.wFInstanceId}" value="#{msgs.title_monthlyRewardRequest}" />
						<h:outputText rendered="#{ not empty monthlyReward.finMonthlyReward.wFInstanceId}" value="#{msgs.title_monthlyRewardApprove}" />
					</td>
				</tr>

				<h:panelGroup rendered="#{empty monthlyReward.finYearApproval.id or (not empty monthlyReward.finYearApproval.id and monthlyReward.errorMonthExistFlag)}">
					<tr>
						<td colspan="2">
							<table class="sectionTitle" border="0" cellpadding="0" cellspacing="0">
								<tr>
									<td>
										<h:panelGroup id="errorYearPanelId">
											<h:outputText style="text-align:center;color: red; font-weight: 600;" rendered="#{empty monthlyReward.finYearApproval.id}" value="#{msgs.error_finYearApprovalNotRegistered}" />
											<h:outputText style="text-align:center;color: red; font-weight: 600;" rendered="#{not empty monthlyReward.finYearApproval.id and monthlyReward.errorMonthExistFlag}" value="#{msgs.error_monthIsExist}" />
										</h:panelGroup>
									</td>
								</tr>
							</table>
						</td>
					</tr>
				</h:panelGroup>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td colspan="2">
						<table class="sectionTitle" border="0" cellpadding="0" cellspacing="0">
							<tr>
								<td>
									<h:outputText value="#{msgs.label_financeDetail}" />
								</td>
							</tr>
						</table>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td>
						<h:panelGroup id="monthlyRewardContainerId">
							<table class="sectionContent" border="0" cellpadding="0" cellspacing="0">

								<tr>
									<th width="15%">
										<h:outputText value="#{msgs.label_requestNumber}" />
									</th>
									<td width="35%">
										<h:outputText value="#{monthlyReward.finMonthlyReward.requestNumber}" />
									</td>
									<th width="15%">
										<h:outputText value="#{msgs.label_requestDate}" />
									</th>
									<td width="35%">
										<h:outputText value="#{monthlyReward.finMonthlyReward.requestDateString}" />
									</td>
								</tr>
								<tr>

									<th>
										<h:outputText value="#{msgs.label_month}" />
										<h:outputText rendered="#{ empty monthlyReward.finMonthlyReward.wFInstanceId}" value="*" style="color:red;" />
									</th>
									<td>
										<table width="100%">
											<tr>
												<td>
													<h:selectOneMenu styleClass="form-control" value="#{monthlyReward.finMonthlyReward.monthNumber}" disabled="#{ not empty monthlyReward.finMonthlyReward.wFInstanceId}">
														<f:selectItem itemLabel="#{msgs.label_moharm}" itemValue="1" />
														<f:selectItem itemLabel="#{msgs.label_safr}" itemValue="2" />
														<f:selectItem itemLabel="#{msgs.label_rabieAwl}" itemValue="3" />
														<f:selectItem itemLabel="#{msgs.label_rabieTani}" itemValue="4" />
														<f:selectItem itemLabel="#{msgs.label_gamadAwl}" itemValue="5" />
														<f:selectItem itemLabel="#{msgs.label_gamadTani}" itemValue="6" />
														<f:selectItem itemLabel="#{msgs.label_ragb}" itemValue="7" />
														<f:selectItem itemLabel="#{msgs.label_shaban}" itemValue="8" />
														<f:selectItem itemLabel="#{msgs.label_ramdan}" itemValue="9" />
														<f:selectItem itemLabel="#{msgs.label_shwal}" itemValue="10" />
														<f:selectItem itemLabel="#{msgs.label_zwAlqada}" itemValue="11" />
														<f:selectItem itemLabel="#{msgs.label_zwAlhaga}" itemValue="12" />
														<f:ajax event="change" execute="@this" render="@form" listener="#{monthlyReward.getMonthDetails()}" />
													</h:selectOneMenu>
												</td>
												
												<th>
													<h:outputText value="#{msgs.label_forYear}" />
												</th>
												<td>
													<h:outputText value="#{monthlyReward.finMonthlyReward.hijriYear}" rendered="#{ not empty monthlyReward.finMonthlyReward.wFInstanceId}" />
													<h:selectOneMenu styleClass="form-control" value="#{monthlyReward.finMonthlyReward.hijriYear}" rendered="#{ empty monthlyReward.finMonthlyReward.wFInstanceId}">
														<f:selectItems value="#{monthlyReward.hijriYears}" var="y" itemLabel="#{y.intValue()}" itemValue="#{y.intValue()}" />
														<f:ajax event="change" render="@form" execute="@this" listener="#{monthlyReward.getMonthDetails()}" />
													</h:selectOneMenu>
												</td>
												
											</tr>
										</table>
									</td>

									<th>
										<h:outputText value="#{msgs.label_financialYear}" />
									</th>
									<td>
										<h:outputText value="#{monthlyReward.finYearApproval.finYear} " />
									</td>
								</tr>

								<tr>
									<th>
										<h:outputText value="#{msgs.label_subAccount}" />
									</th>
									<td colspan="3">
										<h:outputText value="#{msgs.label_monthlyRewardAccount}" />
									</td>
								</tr>

								<tr>
									<th>
										<h:outputText value="#{msgs.label_subAccountAmount}" />
									</th>
									<td>
										<h:outputText value="#{monthlyReward.finMonthlyReward.totalAmount}">
											<f:converter converterId="com.code.ui.converters.CSNumberConverter" />
										</h:outputText>
									</td>
									<th>
										<h:outputText value="#{msgs.label_currentBalance}" />
									</th>
									<td>
										<h:outputText value="#{monthlyReward.finMonthlyReward.accountBalance}">
											<f:converter converterId="com.code.ui.converters.CSNumberConverter" />
										</h:outputText>
									</td>
								</tr>

							</table>
						</h:panelGroup>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td>
						<h:panelGroup id="rewardDetailsPaneId">
							<table width="100%">
								<tr>
									<td colspan="2">
										<table class="sectionTitle" border="0" cellpadding="0" cellspacing="0">
											<tr>
												<td>
													<h:outputText value="#{msgs.label_rewardsDetails}" />
												</td>
											</tr>
										</table>
									</td>
								</tr>

								<tr>
									<td>
										<table width="100%">
											<tr>
												<td>
													<p:dataTable sortBy="#{row.selected}" paginatorAlwaysVisible="false" tableStyle="table-layout:auto" reflow="true" liveResize="true" id="rewardsRegionsDetailId" paginator="true" style="width:100%" rowIndexVar="index" rows="11" var="row" value="#{monthlyReward.finMonthlyRewDepDetailList}" widgetVar="table" rowHover="true">
														<p:column styleClass='centerText'>
															<f:facet name="header">
																#
															</f:facet>
					                                    	#{index + 1}
				                                   		</p:column>

														<p:column styleClass='centerText'>
															<f:facet name="header">
																<h:outputText value="#{msgs.label_unitSource}" />
															</f:facet>
															<h:outputText value="#{row.departmentName}" />
														</p:column>
														<p:column styleClass='centerText'>
															<f:facet name="header">
																<h:outputText value="#{msgs.label_totalSpent}" />
															</f:facet>
															<h:outputText value="#{row.totalSpent}">
																<f:converter converterId="com.code.ui.converters.CSNumberConverter" />
															</h:outputText>
														</p:column>
														<p:column styleClass='centerText'>
															<f:facet name="header">
																<h:outputText value="#{msgs.label_assignments}" />
															</f:facet>
															<h:outputText value="#{row.resourceNumber}" />
														</p:column>
														<p:column styleClass='centerText'>
															<f:facet name="header"> #{msgs.label_description} </f:facet>
															<h:commandButton value="&#xf05a;" styleClass="btn btn-trans-icon" onclick="return getMonthlyRewardDetails('#{request.contextPath}',#{row.departmentId},#{monthlyReward.finMonthlyReward.monthNumber},#{monthlyReward.finMonthlyReward.hijriYear});" />
														</p:column>
														<p:summaryRow>
															<p:column colspan="2" style="text-align:left !important">
																<h:outputText value="#{msgs.label_total}" />
															</p:column>
															<p:column>
																<h:outputText value="#{monthlyReward.finMonthlyReward.totalSpent}">
																	<f:converter converterId="com.code.ui.converters.CSNumberConverter" />
																</h:outputText>
															</p:column>
															<p:column>
																<h:outputText value="#{monthlyReward.finMonthlyReward.totalAgentsNumbers}" />
															</p:column>
															<p:column>
																<h:outputText value="" />
															</p:column>
														</p:summaryRow>
													</p:dataTable>
												</td>
											</tr>
										</table>
									</td>
								</tr>
							</table>
						</h:panelGroup>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<h:panelGroup rendered="#{ (not empty monthlyReward.currentTask)}">
					<tr>
						<td colspan="2">
							<table class="sectionTitle" border="0" cellpadding="0" cellspacing="0">
								<tr>
									<td>
										<h:outputText value="#{msgs.label_decisions}" />
									</td>
								</tr>
							</table>
						</td>
					</tr>

					<tr>
						<td colspan="2">
							<table class="sectionContent" border="0" cellpadding="0" cellspacing="0">
								<tr>
									<th>
										<h:outputText value="#{msgs.label_comment}" />
									</th>
									<td>
										<h:inputTextarea value="#{monthlyReward.currentTask.notes}" rows="5" cols="80" disabled="#{monthlyReward.role==monthlyReward.historyRole}" />
									</td>
								</tr>
							</table>
						</td>
					</tr>
				</h:panelGroup>

				<tr>
					<td width="100%">
						<code:prevTasks rendered="#{ not empty monthlyReward.finMonthlyReward.wFInstanceId}" value="#{monthlyReward.prevTasks}" />
					</td>
				</tr>


				<tr>
					<td>
						<h:panelGroup id="actionSectionPanelId">
							<table class="actionsSection" border="0" cellpadding="0" cellspacing="0">

								<tr>
									<td width="100%">
										<h:commandButton id="printBtnId" styleClass="btn btn-success" action="#{monthlyReward.print()}" value="&#xf02f; #{msgs.label_print}" rendered="#{not empty monthlyReward.finMonthlyReward.id}" />

										<h:commandButton rendered="#{(empty monthlyReward.finMonthlyReward.wFInstanceId) and (not empty monthlyReward.finYearApproval.id)}" class="btn btn-success" value="&#xf1d8; #{msgs.label_send}" action="#{monthlyReward.send()}" onclick="return confirm('#{msgs.q_confirm}');" />

										<h:commandButton rendered="#{monthlyReward.role==monthlyReward.generalIntelligenceManagerRole}" class="btn btn-danger" value="&#xf00d; #{msgs.label_reject}" action="#{monthlyReward.doApproveRejectDM(2)}" onclick="return confirm('#{msgs.q_reject}');" />
										<h:commandButton rendered="#{monthlyReward.role==monthlyReward.generalIntelligenceManagerRole}" class="btn btn-success" value="&#xf00c; #{msgs.label_approve}" action="#{monthlyReward.doApproveRejectDM(1)}" onclick="return confirm('#{msgs.q_approve}');" />

										<h:commandButton rendered="#{monthlyReward.role==monthlyReward.generalDirectorRole}" class="btn btn-danger" value="&#xf00d; #{msgs.label_reject}" action="#{monthlyReward.doApproveRejectSM(2)}" onclick="return confirm('#{msgs.q_reject}');" />
										<h:commandButton rendered="#{monthlyReward.role==monthlyReward.generalDirectorRole}" class="btn btn-success" value="&#xf00c; #{msgs.label_approve}" action="#{monthlyReward.doApproveRejectSM(1)}" onclick="return confirm('#{msgs.q_approve}');" />

										<h:commandButton rendered="#{monthlyReward.role==monthlyReward.generalManagerRole}" class="btn btn-danger" value="&#xf00d; #{msgs.label_reject}" action="#{monthlyReward.doApproveRejectGM(2)}" onclick="return confirm('#{msgs.q_reject}');" />
										<h:commandButton rendered="#{monthlyReward.role==monthlyReward.generalManagerRole}" class="btn btn-success" value="&#xf00c; #{msgs.label_approve}" action="#{monthlyReward.doApproveRejectGM(1)}" onclick="return confirm('#{msgs.q_approve}');" />

										<h:commandButton rendered="#{monthlyReward.role==monthlyReward.notificationRole}" class="btn btn-success" value="#{msgs.label_notified}" action="#{monthlyReward.doNotified()}" />
										<h:commandButton rendered="#{monthlyReward.role==monthlyReward.notificationRole}" class="btn btn-success" value="&#xf02f; #{msgs.label_printIBAN}" title="#{msgs.label_printIBAN}" action="#{monthlyReward.printReport(monthlyReward.IBANPaymentMethod)}" />
										<h:commandButton rendered="#{monthlyReward.role==monthlyReward.notificationRole}" class="btn btn-success" value="&#xf02f; #{msgs.label_printCheque}" title="#{msgs.label_printCheque}" action="#{monthlyReward.printReport(monthlyReward.chequePaymentMethod)}" />

									</td>
								</tr>
							</table>

						</h:panelGroup>
					</td>
				</tr>

			</table>
		</ui:decorate>
	</h:form>
</h:body>
</html>