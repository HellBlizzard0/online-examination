<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:p="http://primefaces.org/ui" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:f="http://java.sun.com/jsf/core" xmlns:util="http://java.sun.com/jsf/composite/util">
<h:head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

	<h:outputStylesheet library="css" name="styles.css" />
	<h:outputStylesheet library="css" name="grid.css" />
	<h:outputStylesheet library="css" name="bootstrap.css" />

	<h:outputScript name="utilities.js" library="javascript" target="head" />
	<script type="text/javascript">
		function calculateTotalAndInitialBalances(errorMsg1, errorMsg2){
			support = document.getElementById('supportFinanceAccountsFormId:totalSupportAmountId').value;
			support = support.replace(/,/g, '');
			if(support == "" || support == null){
				support = 0;
			}else if(parseFloat(support) != support){
				showErrorMessage(errorMsg1);
     			support = 0;
	     	}else if(!(parseFloat(support) > 0)){
	     		showErrorMessage(errorMsg2);
     			support = 0;
		    }
			balance = document.getElementById('supportFinanceAccountsFormId:currentBalanceId').value;
			balance = balance.replace(/,/g, '');
			currentYearBalance = document.getElementById('supportFinanceAccountsFormId:currentYearBalanceId').value;
			currentYearBalance = currentYearBalance.replace(/,/g, '');
			lastYearBalance = document.getElementById('supportFinanceAccountsFormId:lastYearBalanceId').value;
			lastYearBalance = lastYearBalance.replace(/,/g, '');
	     	document.getElementById('supportFinanceAccountsFormId:totalBalanceId').value = parseFloat(balance) + parseFloat(support);
			document.getElementById('supportFinanceAccountsFormId:initialBalanceId').value = parseFloat(currentYearBalance) + parseFloat(lastYearBalance) + parseFloat('#{supportFinanceAccounts.finYearAccountSum}') + parseFloat(support);
			document.getElementById('supportFinanceAccountsFormId:totalHiddenBalanceId').value = parseFloat(balance) + parseFloat(support);
			document.getElementById('supportFinanceAccountsFormId:initialHiddenBalanceId').value = parseFloat(currentYearBalance) + parseFloat(lastYearBalance) + parseFloat('#{supportFinanceAccounts.finYearAccountSum}') + parseFloat(support);
	     	
	     	return true;
	    }
	    
		function calculateTotal(mode, errorMsg1, errorMsg2){
			/* <![CDATA[ */
			var totalSupport = document.getElementById('supportFinanceAccountsFormId:totalSupportAmountId').value;
			totalSupport = totalSupport.replace(/,/g, '');
			var regionSupport = document.getElementById('supportFinanceAccountsFormId:regionsSupportSupportAmountId').value;
			regionSupport = regionSupport.replace(/,/g, '');
			var monthlyRewardSupport = document.getElementById('supportFinanceAccountsFormId:monthlyRewardSupportAmountId').value;
			monthlyRewardSupport = monthlyRewardSupport.replace(/,/g, '');
     		
	     	if(mode == 1){
		     	var support = monthlyRewardSupport;
	     		if(support == "" || support == null){
	     			support = 0;
				}else if(parseFloat(support) != support){
					showErrorMessage(errorMsg1);
	     			support = 0;
		     	}else if(!(parseFloat(support) >= 0)){
		     		showErrorMessage(errorMsg2);
	     			support = 0;
			    }
	     		if(parseFloat(totalSupport) < parseFloat(support)) {
	     			showErrorMessage('#{msgs.error_supportLessThanMonthlyReward}');
	     			document.getElementById('supportFinanceAccountsFormId:monthlyRewardSupportAmountId').value = parseFloat(totalSupport) -  parseFloat(regionSupport);
			    } else {
			    	document.getElementById('supportFinanceAccountsFormId:regionsSupportSupportAmountId').value = parseFloat(totalSupport) -  parseFloat(support);
				}
	     		total = document.getElementById('supportFinanceAccountsFormId:monthlyRewardCurrentBalanceId').value;
	     		total = total.replace(/,/g, '');
	     		document.getElementById('supportFinanceAccountsFormId:monthlyRewardTotalId').value = parseFloat(total) + parseFloat(support);
	     		document.getElementById('supportFinanceAccountsFormId:monthlyHiddenRewardTotalId').value = parseFloat(total) + parseFloat(support);
	     	}else if(mode == 2){
	     		var support = regionSupport;
	     		if(support == "" || support == null){
	     			support = 0;
				}else if(parseFloat(support) != support){
					showErrorMessage(errorMsg1);
	     			support = 0;
		     	}else if(!(parseFloat(support) >= 0)){
		     		showErrorMessage(errorMsg2);
	     			support = 0;
			    }
	     		if(parseFloat(totalSupport) < parseFloat(support)) {
	     			showErrorMessage('#{msgs.error_supportLessThanRegion}');
	     			document.getElementById('supportFinanceAccountsFormId:regionsSupportSupportAmountId').value = parseFloat(totalSupport) -  parseFloat(monthlyRewardSupport);
			    } else {
			    	document.getElementById('supportFinanceAccountsFormId:monthlyRewardSupportAmountId').value = parseFloat(totalSupport) -  parseFloat(support);
				}
	     		total = document.getElementById('supportFinanceAccountsFormId:regionsSupportCurrentBalanceId').value;
	     		total = total.replace(/,/g, '');
		     	document.getElementById('supportFinanceAccountsFormId:regionsSupportTotalId').value = parseFloat(total) + parseFloat(support);
		     	document.getElementById('supportFinanceAccountsFormId:regionsHiddenSupportTotalId').value = parseFloat(total) + parseFloat(support);
	        }
	     	return true;
		}
		
		function confirmAndValidate(q_confirm, errorMsg1, errorMsg2){
			/* <![CDATA[ */
			if(confirm(q_confirm)){
				support = document.getElementById('supportFinanceAccountsFormId:totalSupportAmountId').value;
				support = support.replace(/,/g, '');
				rewardSupport = document.getElementById('supportFinanceAccountsFormId:monthlyRewardSupportAmountId').value;
				rewardSupport = rewardSupport.replace(/,/g, '');
				regionsSupport = document.getElementById('supportFinanceAccountsFormId:regionsSupportSupportAmountId').value;
				regionsSupport = regionsSupport.replace(/,/g, '');
	
				if(parseFloat(support) != support || parseFloat(regionsSupport) != regionsSupport ||  parseFloat(rewardSupport) != rewardSupport){
					showErrorMessage(errorMsg1);
					return false;
				}else if(!(support > 0) || (!(regionsSupport > 0) && !(rewardSupport > 0))){
					showErrorMessage(errorMsg2);
	     			return false;
			     }
				if(parseFloat(support) != parseFloat(rewardSupport) + parseFloat(regionsSupport)){
					showErrorMessage('#{msgs.error_supportBalanceNotDivided}');
					return false;
				}
				return true;
			}
			return false;
			/* ]]> */
		}
	</script>
</h:head>
<h:body styleClass="screenBg">
	<h:form id="supportFinanceAccountsFormId" dir="#{msgs.dir}">
		<ui:decorate template="/Main/Template.xhtml">
			<table border="0" cellpadding="0" cellspacing="0" width="100%">
				<tr>
					<td class="screenTitle">#{msgs.title_supportFinanceAccounts}</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td colspan="2">
						<table class="sectionTitle" border="0" cellpadding="0" cellspacing="0">
							<tr>
								<td>
									<h:outputText style="text-align:center; color: red; font-weight: 600;" value="#{supportFinanceAccounts.errorMessage}" />
								</td>
							</tr>
						</table>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>


				<tr>
					<td colspan="2">
						<table class="sectionTitle" border="0" cellpadding="0" cellspacing="0">
							<tr>
								<td>
									<h:outputText value="#{msgs.label_financialYear}" />
								</td>
							</tr>
						</table>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td>
						<table class="sectionContent" border="0" cellpadding="0" cellspacing="0">
							<tr>
								<th width="15%">#{msgs.label_supportDate}</th>
								<td width="20%">
									<h:inputText disabled="true" styleClass="form-control" id="supportDateId" value="#{supportFinanceAccounts.yearAccountSupport.supportDateString}" />
								</td>
								<td width="65%"></td>
							</tr>

							<tr>
								<th width="15%">#{msgs.label_financialYear}</th>
								<td width="20%">
									<h:inputText disabled="true" styleClass="form-control" id="financialYearId" value="#{supportFinanceAccounts.yearApproval.finYear}" />
								</td>
								<td width="65%"></td>
							</tr>

							<tr>
								<th width="15%">#{msgs.label_currentYearBalance}</th>
								<td width="20%">
									<h:inputText disabled="true" styleClass="form-control" id="currentYearBalanceId" value="#{supportFinanceAccounts.yearApproval.currentYearBalance}">
										<f:converter converterId="com.code.ui.converters.CSNumberConverter" />
									</h:inputText>
								</td>
								<td width="10%">#{msgs.label_riyal}</td>
							</tr>

							<tr>
								<th width="15%">#{msgs.label_currentBalance}</th>
								<td width="20%">
									<h:inputText disabled="true" styleClass="form-control" id="currentBalanceId" value="#{supportFinanceAccounts.currentBalance}">
										<f:converter converterId="com.code.ui.converters.CSNumberConverter" />
									</h:inputText>
									<h:inputHidden id="lastYearBalanceId" value="#{supportFinanceAccounts.lastYearBalance}" />
								</td>
								<td width="10%">#{msgs.label_riyal}</td>
							</tr>

							<tr>
								<th width="15%">#{msgs.label_totalSupportAmount}</th>
								<td width="20%">
									<h:inputText styleClass="form-control" id="totalSupportAmountId" value="#{supportFinanceAccounts.supportAmount}" onkeyup="calculateTotalAndInitialBalances('#{msgs.error_supportNumbersOnly}', '#{msgs.error_supportMoreThanZero}');" onkeypress="return checkFloat(event)" onblur="return isDigitFloat(this)" maxlength="32">
										<f:converter converterId="com.code.ui.converters.CSNumberConverter" />
										<f:ajax event="blur" render="@this supportFinanceAccountsFormId:totalBalanceId supportFinanceAccountsFormId:initialBalanceId" execute="@this supportFinanceAccountsFormId:totalHiddenBalanceId supportFinanceAccountsFormId:initialHiddenBalanceId" />
									</h:inputText>
								</td>
								<td width="10%">#{msgs.label_riyal}</td>
							</tr>

							<tr>
								<th width="15%">#{msgs.label_totalBalance}</th>
								<td width="20%">
									<h:inputText disabled="true" styleClass="form-control" id="totalBalanceId" value="#{supportFinanceAccounts.totalBalance}">
										<f:converter converterId="com.code.ui.converters.CSNumberConverter" />
									</h:inputText>
									<h:inputHidden id="totalHiddenBalanceId" value="#{supportFinanceAccounts.totalBalance}" />
								</td>
								<td width="10%">#{msgs.label_riyal}</td>
							</tr>

							<tr>
								<th width="15%">#{msgs.label_initialBalance}</th>
								<td width="20%">
									<h:inputText disabled="true" styleClass="form-control" id="initialBalanceId" value="#{supportFinanceAccounts.initialBalance}">
										<f:converter converterId="com.code.ui.converters.CSNumberConverter" />
									</h:inputText>
									<h:inputHidden id="initialHiddenBalanceId" value="#{supportFinanceAccounts.initialBalance}" />
								</td>
								<td width="10%">#{msgs.label_riyal}</td>
							</tr>
						</table>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td colspan="2">
						<table class="sectionTitle" border="0" cellpadding="0" cellspacing="0">
							<tr>
								<td>
									<h:outputText value="#{msgs.label_directorateAccounts}" />
								</td>
							</tr>
						</table>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td>
						<p:fieldset toggleable="true" id="monthlyRewardPanelId" legend="#{msgs.label_monthlyRewardAccount}" collapsed="true">

							<table class="sectionContent" border="0" cellpadding="0" cellspacing="0">
								<tr>
									<th width="15%">#{msgs.label_currentBalance}</th>
									<td width="25%">
										<h:inputText disabled="true" styleClass="form-control" id="monthlyRewardCurrentBalanceId" value="#{supportFinanceAccounts.monthlyRewardCurrentBalance}">
											<f:converter converterId="com.code.ui.converters.CSNumberConverter" />
										</h:inputText>
									</td>
									<td width="10%">#{msgs.label_riyal}</td>
									<td width="50%"></td>
								</tr>

								<tr>
									<th width="15%">#{msgs.label_supportAmount}</th>
									<td width="25%">
										<h:inputText styleClass="form-control" id="monthlyRewardSupportAmountId" value="#{supportFinanceAccounts.yearAccountSupport.rewardSupportBalance}" onkeyup="return calculateTotal(1, '#{msgs.error_supportNumbersOnly}', '#{msgs.error_supportNotLessThanZero}');" onkeypress="return checkFloat(event)" onblur="return isDigitFloat(this)" maxlength="32">
											<f:converter converterId="com.code.ui.converters.CSNumberConverter" />
											<f:ajax event="blur" render="@this supportFinanceAccountsFormId:monthlyRewardTotalId" execute="@this supportFinanceAccountsFormId:monthlyHiddenRewardTotalId" />
										</h:inputText>
									</td>
									<td width="10%">#{msgs.label_riyal}</td>

								</tr>

								<tr>
									<th width="15%">#{msgs.label_balance}</th>
									<td width="25%">
										<h:inputText disabled="true" styleClass="form-control" id="monthlyRewardTotalId" value="#{supportFinanceAccounts.monthlyRewardTotal}">
											<f:converter converterId="com.code.ui.converters.CSNumberConverter" />
										</h:inputText>
										<h:inputHidden id="monthlyHiddenRewardTotalId" value="#{supportFinanceAccounts.monthlyRewardTotal}" />
									</td>
									<td width="10%">#{msgs.label_riyal}</td>
								</tr>
							</table>
						</p:fieldset>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td>
						<p:fieldset toggleable="true" id="regionsSupportPanelId" legend="#{msgs.label_regionsSupportAccount}" collapsed="true">
							<table class="sectionContent" border="0" cellpadding="0" cellspacing="0">
								<tr>
									<th width="15%">#{msgs.label_currentBalance}</th>
									<td width="25%">
										<h:inputText disabled="true" styleClass="form-control" id="regionsSupportCurrentBalanceId" value="#{supportFinanceAccounts.regionsSupportCurrentBalance}">
											<f:converter converterId="com.code.ui.converters.CSNumberConverter" />
										</h:inputText>
									</td>
									<td width="10%">#{msgs.label_riyal}</td>
									<td width="50%"></td>
								</tr>

								<tr>
									<th width="15%">#{msgs.label_supportAmount}</th>
									<td width="25%">
										<h:inputText styleClass="form-control" id="regionsSupportSupportAmountId" value="#{supportFinanceAccounts.yearAccountSupport.regionsSupportBalance}" onkeyup="return calculateTotal(2, '#{msgs.error_supportNumbersOnly}', '#{msgs.error_supportNotLessThanZero}');" onkeypress="return checkFloat(event)" onblur="return isDigitFloat(this)" maxlength="32">
											<f:converter converterId="com.code.ui.converters.CSNumberConverter" />
											<f:ajax event="blur" render="@this supportFinanceAccountsFormId:regionsSupportTotalId" execute="@this supportFinanceAccountsFormId:regionsHiddenSupportTotalId" />
										</h:inputText>
									</td>
									<td width="10%">#{msgs.label_riyal}</td>
								</tr>

								<tr>
									<th width="15%">#{msgs.label_balance}</th>
									<td width="25%">
										<h:inputText disabled="true" styleClass="form-control" id="regionsSupportTotalId" value="#{supportFinanceAccounts.regionsSupportTotal}">
											<f:converter converterId="com.code.ui.converters.CSNumberConverter" />
										</h:inputText>
										<h:inputHidden id="regionsHiddenSupportTotalId" value="#{supportFinanceAccounts.regionsSupportTotal}" />
									</td>
									<td width="10%">#{msgs.label_riyal}</td>
								</tr>
							</table>
						</p:fieldset>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td>
						<table class="actionsSection" border="0" cellpadding="0" cellspacing="0">
							<tr>
								<td>
									<h:commandButton rendered="#{supportFinanceAccounts.registered}" id="saveBtnId" styleClass="btn btn-success" action="#{supportFinanceAccounts.save()}" value="&#xf0c7; #{msgs.label_save}" onclick="return confirmAndValidate('#{msgs.q_save}', '#{msgs.error_supportNumbersOnly}', '#{msgs.error_supportMoreThanZero}');" />
								</td>
							</tr>
						</table>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>
			</table>
		</ui:decorate>
	</h:form>
</h:body>
</html>