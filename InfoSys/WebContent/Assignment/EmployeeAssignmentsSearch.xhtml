<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:p="http://primefaces.org/ui" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:f="http://java.sun.com/jsf/core" xmlns:util="http://java.sun.com/jsf/composite/util">
<h:head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

	<h:outputStylesheet library="css" name="styles.css" />
	<h:outputStylesheet library="css" name="grid.css" />
	<h:outputStylesheet library="css" name="bootstrap.css" />

	<h:outputScript name="utilities.js" library="javascript" target="head" />
	<script type="text/javascript">
		var m;
	
		function getDepartment(contextPath,mode){
	    	m = 1;
			openDepartmentsMiniSearch(contextPath,mode, null, '#{employeeAssignmentSearch.departmentType}');
			return false;
		}
		
		function getEmployee(contextPath,mode){
			m = 2;
			openEmpsMiniSearch(contextPath,mode);
			return false;
		}

		function getOfficer(contextPath,mode,depsList){
			m = 3;
			openEmpsMiniSearch(contextPath, mode, depsList);
			return false;
		}
		
		function getSector(contextPath) {
			m = 4;
			var regionId = document.getElementById('assignSearchFormId:selectedRegionId').value
			openDepartmentsMiniSearch(contextPath, 5, regionId, null);
			return false;
		}
		
		function getUnit(contextPath,sectorId) {
    		m = 5;
    		openDepartmentsMiniSearch(contextPath,6,sectorId, null);
    		return false;
    	}
		
		function releaseMask(){
			unMaskScreen();
	   	}
	   	
		function HandlePopupResult(ret) { 
			unMaskScreen();
			if(ret!=null){
	    		if( m== 1){
	    			document.getElementById('assignSearchFormId:selectedRegionId').value = ret[0];
	   	         	document.getElementById('assignSearchFormId:selectedRegionNameId').value = ret[1];
	   	         	document.getElementById('assignSearchFormId:regionNameId').innerHTML = ret[1];
	   	         	document.getElementById('assignSearchFormId:selectedSectorId').value = null;
					document.getElementById('assignSearchFormId:selectedSectorNameId').value = '';
					document.getElementById('assignSearchFormId:sectorNameId').innerHTML = '';
					document.getElementById('assignSearchFormId:selectedUnitId').value = null;
	    		  	document.getElementById('assignSearchFormId:selectedUnitNameId').value = '';
	            	document.getElementById('assignSearchFormId:unitNameId').innerHTML = '';
	   	         	document.getElementById('assignSearchFormId:selectedOfficerId').value = null;
      				document.getElementById('assignSearchFormId:selectedOfficerNameId').value = '';
              		document.getElementById('assignSearchFormId:officerNameId').innerHTML = '';
              		
              		document.getElementById('assignSearchFormId:updateSectorAndDepsListButtonId').click();
	       		}else if (m == 2){
	           		document.getElementById('assignSearchFormId:selectedEmployeeId').value=ret[0];
	           		document.getElementById('assignSearchFormId:selectedEmployeeNameId').value=ret[1];
	           		document.getElementById('assignSearchFormId:employeeNameId').innerHTML=ret[1];
	           		document.getElementById('assignSearchFormId:selectedEmployeeSocialId').value=ret[2];
	      		}else if (m == 3){
	      			document.getElementById('assignSearchFormId:selectedOfficerId').value=ret[0];
	           		document.getElementById('assignSearchFormId:selectedOfficerNameId').value=ret[1];
	           		document.getElementById('assignSearchFormId:officerNameId').innerHTML=ret[1];
	      		} else if (m == 4) {
					document.getElementById('assignSearchFormId:selectedSectorId').value = ret[0];
					document.getElementById('assignSearchFormId:selectedSectorNameId').value = ret[1];
					document.getElementById('assignSearchFormId:sectorNameId').innerHTML = ret[1];
					document.getElementById('assignSearchFormId:selectedUnitId').value = null;
	    		  	document.getElementById('assignSearchFormId:selectedUnitNameId').value = '';
	            	document.getElementById('assignSearchFormId:unitNameId').innerHTML = '';
	            	document.getElementById('assignSearchFormId:selectedOfficerId').value = null;
      				document.getElementById('assignSearchFormId:selectedOfficerNameId').value = '';
              		document.getElementById('assignSearchFormId:officerNameId').innerHTML = '';
	            	document.getElementById('assignSearchFormId:updateUnitButtonId').click();
				} else if (m==5)
    	  		{
    	  			document.getElementById('assignSearchFormId:selectedUnitId').value = ret[0];
            		document.getElementById('assignSearchFormId:selectedUnitNameId').value = ret[1];
                    document.getElementById('assignSearchFormId:unitNameId').innerHTML = ret[1];
                	document.getElementById('assignSearchFormId:selectedOfficerId').value = null;
      				document.getElementById('assignSearchFormId:selectedOfficerNameId').value = '';
              		document.getElementById('assignSearchFormId:officerNameId').innerHTML = '';
                    document.getElementById('assignSearchFormId:updateUnitBtnId').click();
    	  		}
	         	return true;
	   		}
	   		return false;
		}
		
		window.onkeypress = function(e) {
			  var keyCode = window.event.keyCode || e.keyCode || e.which;
		      if (keyCode == '13') {
		    	  document.getElementById('assignSearchFormId:searchBtnId').click();
		    	  return false;
		      }
		};
	</script>
</h:head>
<h:body styleClass="screenBg">
	<h:form id="assignSearchFormId" dir="#{msgs.dir}">
		<ui:decorate template="/Main/Template.xhtml">
			<table border="0" cellpadding="0" cellspacing="0" width="100%">

				<tr>
					<td class="screenTitle">#{msgs.title_employeeAssignmentSearch}</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td colspan="2">
						<table class="sectionTitle" border="0" cellpadding="0" cellspacing="0">
							<tr>
								<td>
									<h:outputText value="#{msgs.label_searchData}" />
								</td>
							</tr>
						</table>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td>
						<h:panelGroup id="searchContainerId">
							<table class="sectionContent" border="0" cellpadding="0" cellspacing="0">
								<tr>
									<th width="15%">#{msgs.label_agentCode}</th>
									<td width="20%">
										<h:inputText maxlength="12" styleClass="form-control inputnumber" value="#{employeeAssignmentSearch.assignmentDetailDataSearch.agentCode}" />
									</td>

									<th width="15%">#{msgs.label_agentStatus}</th>
									<td width="20%">
										<h:selectOneMenu class="form-control" value="#{employeeAssignmentSearch.active}">
											<f:selectItem noSelectionOption="true" itemValue="-1" itemLabel="#{msgs.label_all}" />
											<f:selectItem itemValue="0" itemLabel="#{msgs.label_agentNonHeld}" />
											<f:selectItem itemValue="1" itemLabel="#{msgs.label_agentHeld}" />
											<f:selectItem itemValue="2" itemLabel="#{msgs.label_notStarted}" />
										</h:selectOneMenu>
									</td>
								</tr>

								<tr>
									<th width="15%">
										#{msgs.label_name}
										<h:commandButton value="&#xf002;" styleClass="btn btn-trans-icon" onclick="return getEmployee('#{request.contextPath}',4);" title="#{msgs.label_addEmployee}" />
									</th>
									<td width="20%" colspan="5">
										<h:inputHidden id="selectedEmployeeId" value="#{employeeAssignmentSearch.assignmentDetailDataSearch.employeeId}" />
										<h:inputHidden id="selectedEmployeeNameId" value="#{employeeAssignmentSearch.assignmentDetailDataSearch.fullName}" />
										<h:inputHidden id="selectedEmployeeSocialId" value="#{employeeAssignmentSearch.assignmentDetailDataSearch.identity}" />
										<h:outputText id="employeeNameId" value="#{employeeAssignmentSearch.assignmentDetailDataSearch.fullName}" />
									</td>
								</tr>

								<tr>
									<th width="15%">
										#{msgs.label_region}
										<h:commandButton rendered="#{not employeeAssignmentSearch.regionFlag}" value="&#xf002;" styleClass="btn btn-trans-icon" onclick="return getDepartment('#{request.contextPath}',2);" title="#{msgs.label_addDepartment}" />
										<h:commandButton id="updateSectorAndDepsListButtonId" style="display : none ;" action="#{employeeAssignmentSearch.updateDepsList(employeeAssignmentSearch.assignmentDetailDataSearch.regionId , null , null)}">
											<f:ajax execute="assignSearchFormId:selectedRegionId assignSearchFormId:selectedSectorId" render="assignSearchFormId:assignmentOfficerButtonId assignSearchFormId:sectorPanelId assignSearchFormId:unitBtnPanelId"></f:ajax>
										</h:commandButton>
									</th>
									<td width="20%">
										<h:inputHidden id="selectedRegionId" value="#{employeeAssignmentSearch.assignmentDetailDataSearch.regionId}" />
										<h:inputHidden id="selectedRegionNameId" value="#{employeeAssignmentSearch.assignmentDetailDataSearch.regionName}" />
										<h:outputText id="regionNameId" value="#{employeeAssignmentSearch.assignmentDetailDataSearch.regionName}" />
									</td>

									<th width="15%">
										<h:panelGroup id="sectorPanelId">
											<h:outputText rendered="#{employeeAssignmentSearch.assignmentDetailDataSearch.regionId != employeeAssignmentSearch.headQuarterId}" value="#{msgs.label_sector}" />
											<h:commandButton id="sectorButtonId" disabled="#{empty employeeAssignmentSearch.assignmentDetailDataSearch.regionId}" rendered="#{employeeAssignmentSearch.assignmentDetailDataSearch.regionId != employeeAssignmentSearch.headQuarterId}" value="&#xf002;" styleClass="btn btn-trans-icon" onclick="return getSector('#{request.contextPath}');" title="#{msgs.title_addNewSector}" />
											<h:commandButton id="updateUnitButtonId" style="display : none ;" action="#{employeeAssignmentSearch.updateDepsList(employeeAssignmentSearch.assignmentDetailDataSearch.regionId , employeeAssignmentSearch.assignmentDetailDataSearch.sectorId , null)}">
												<f:ajax execute="assignSearchFormId:selectedSectorId assignSearchFormId:unitBtnId assignSearchFormId:assignmentOfficerButtonId assignSearchFormId:unitPanelId" render="assignSearchFormId:unitBtnId assignSearchFormId:assignmentOfficerButtonId assignSearchFormId:unitPanelId"></f:ajax>
											</h:commandButton>
										</h:panelGroup>
									</th>
									<td width="20%">
										<h:inputHidden id="selectedSectorId" value="#{employeeAssignmentSearch.assignmentDetailDataSearch.sectorId}" />
										<h:inputHidden id="selectedSectorNameId" value="#{employeeAssignmentSearch.assignmentDetailDataSearch.sectorName}" />
										<h:outputText id="sectorNameId" value="#{employeeAssignmentSearch.assignmentDetailDataSearch.sectorName}" />
									</td>
								</tr>

								<tr>
									<th width="15%">
										<h:panelGroup id="unitBtnPanelId">
											<h:outputText value="#{msgs.label_unit}" rendered="#{employeeAssignmentSearch.assignmentDetailDataSearch.regionId != employeeAssignmentSearch.headQuarterId}" />
											<h:commandButton id="unitBtnId" disabled="#{empty employeeAssignmentSearch.assignmentDetailDataSearch.sectorId}" rendered="#{employeeAssignmentSearch.assignmentDetailDataSearch.regionId != employeeAssignmentSearch.headQuarterId}" value="&#xf002;" styleClass="btn btn-trans-icon" onclick="return getUnit('#{request.contextPath}','#{employeeAssignmentSearch.assignmentDetailDataSearch.sectorId}');" title="#{msgs.label_addUnit}" />
											<h:commandButton id="updateUnitBtnId" style="display : none ;" action="#{employeeAssignmentSearch.updateDepsList(null , null , employeeAssignmentSearch.assignmentDetailDataSearch.unitId)}">
												<f:ajax execute="@form" render="assignSearchFormId:assignmentOfficerButtonId"></f:ajax>
											</h:commandButton>
										</h:panelGroup>
									</th>
									<td width="20%">
										<h:panelGroup id="unitPanelId">
											<h:inputHidden id="selectedUnitId" value="#{employeeAssignmentSearch.assignmentDetailDataSearch.unitId}" />
											<h:inputHidden id="selectedUnitNameId" value="#{employeeAssignmentSearch.assignmentDetailDataSearch.unitName}" />
											<h:outputText id="unitNameId" value="#{employeeAssignmentSearch.assignmentDetailDataSearch.unitName}" />
										</h:panelGroup>
									</td>

									<th width="15%">
										#{msgs.label_assignmentOfficer}
										<h:commandButton id="assignmentOfficerButtonId" disabled="#{employeeAssignmentSearch.depsList == null or (empty employeeAssignmentSearch.assignmentDetailDataSearch.sectorId and employeeAssignmentSearch.assignmentDetailDataSearch.regionId != employeeAssignmentSearch.headQuarterId)}" rendered="#{not employeeAssignmentSearch.regionFlag or employeeAssignmentSearch.editprivilege}" value="&#xf002;" styleClass="btn btn-trans-icon"
											onclick="return getOfficer('#{request.contextPath}',3,'#{employeeAssignmentSearch.depsList}');" title="#{msgs.label_addEmployee}" />
									</th>
									<td width="20%">
										<h:inputHidden id="selectedOfficerId" value="#{employeeAssignmentSearch.assignmentDetailDataSearch.officerId}" />
										<h:inputHidden id="selectedOfficerNameId" value="#{employeeAssignmentSearch.assignmentDetailDataSearch.officerName}" />
										<h:outputText id="officerNameId" value="#{employeeAssignmentSearch.assignmentDetailDataSearch.officerName}" />
									</td>

								</tr>

								<tr>
									<th width="15%">#{msgs.label_assignmentDateInterval}</th>
									<td width="20%">
										<util:advancedHijriDate value="#{employeeAssignmentSearch.assignmentDetailDataSearch.startDate}" />
									</td>

									<th width="15%">#{msgs.label_to}</th>
									<td width="20%">
										<util:advancedHijriDate value="#{employeeAssignmentSearch.assignmentDetailDataSearch.approvedEndDate}" />
									</td>

								</tr>
							</table>
						</h:panelGroup>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td width="100%">
						<table class="actionsSection" border="0" cellpadding="0" cellspacing="0">
							<tr>
								<td>
									<h:commandButton styleClass="btn btn-default" id="resetBtnId" value="&#xf021; #{msgs.label_reset}" action="#{employeeAssignmentSearch.resetSearchFields()}">
										<f:ajax render="assignSearchFormId:searchContainerId" />
									</h:commandButton>

									<h:commandButton styleClass="btn btn-default" id="searchBtnId" value="&#xf002; #{msgs.label_search}" action="#{employeeAssignmentSearch.searchEmployeeAssignmentDetails()}">
										<f:ajax render="assignSearchFormId:employeeAssignPaneId" execute="assignSearchFormId:searchContainerId" />
									</h:commandButton>
								</td>
							</tr>
						</table>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td>
						<table class="sectionTitle" border="0" cellpadding="0" cellspacing="0">
							<tr>
								<td>
									<h:outputText value="#{msgs.title_searchResults}" />
								</td>
							</tr>
						</table>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td align="center" width="100%">
						<h:panelGroup id="employeeAssignPaneId">
							<p:dataTable reflow="true" tableStyle="table-layout: auto" paginator="true" id="survOrderListDataTableId" rows="#{employeeAssignmentSearch.rowsCount}" rowIndexVar="index" var="row" value="#{employeeAssignmentSearch.assignmentDetailDataList}" rowHover="true">
								<p:column styleClass='centerText'>
									<f:facet name="header">#</f:facet>
	                                #{index + 1}
	                            </p:column>

								<p:column styleClass='centerText'>
									<f:facet name="header"> #{msgs.label_agentCode} </f:facet>
									<h:outputText id="socialIdViewId" value="#{row.agentCode}" />
								</p:column>

								<p:column styleClass='centerText'>
									<f:facet name="header"> #{msgs.label_identity} </f:facet>
									<h:outputText id="fullNameViewId" value="#{row.identity}" />
								</p:column>

								<p:column styleClass='centerText'>
									<f:facet name="header"> #{msgs.label_name} </f:facet>
									<h:outputText id="rankViewId" value="#{row.fullName}" />
								</p:column>

								<p:column styleClass='centerText'>
									<f:facet name="header"> #{msgs.label_rank} </f:facet>
									<h:outputText id="orderNumberViewId" value="#{row.rank}" />
								</p:column>

								<p:column styleClass='centerText'>
									<f:facet name="header"> #{msgs.label_assignmentDateInterval} </f:facet>
									<h:outputText id="orderDateViewId" value="#{row.startDateString}" />
								</p:column>

								<p:column styleClass='centerText'>
									<f:facet name="header"> #{msgs.label_to} </f:facet>
									<h:outputText id="startDateViewId" value="#{row.approvedEndDateString}" />
								</p:column>

								<p:column styleClass='centerText'>
									<f:facet name="header"> #{msgs.label_assignmentOfficer} </f:facet>
									<h:outputText value="#{row.officerName}" />
								</p:column>

								<p:column styleClass='centerText'>
									<f:facet name="header"> #{msgs.title_information} </f:facet>
									<h:commandButton value="&#xf05a;" styleClass="btn btn-trans-icon" action="#{employeeAssignmentSearch.getEmployeeInfos(row)}">
										<f:ajax render="assignSearchFormId:dlgInfoPanelId" onevent="function(e){if(e.status == 'success') PF('dlgInfo').show();}" />
									</h:commandButton>
								</p:column>

								<p:column styleClass='centerText'>
									<f:facet name="header"> #{msgs.label_viewEdit} </f:facet>
									<h:commandButton rendered="#{row.officerId == employeeAssignmentSearch.loginEmpData.empId and row.heldFlag == employeeAssignmentSearch.enumNotHeld}" onclick="openEmployeeAssignmentView('#{request.contextPath}',#{row.id}); return false;" value="&#xf06e;" styleClass="btn btn-trans-icon" action="#{employeeAssignmentView.refreshSubmit()}">
										<f:ajax></f:ajax>
									</h:commandButton>
									<h:commandButton rendered="#{row.officerId == employeeAssignmentSearch.loginEmpData.empId or employeeAssignmentSearch.editprivilege}" value="&#xf14b;" styleClass="btn btn-trans-icon" title="#{msgs.label_viewEdit}" action="#{employeeAssignmentSearch.viewAssignmentDetail(row)}" />
								</p:column>

								<p:column styleClass='centerText'>
									<f:facet name="header"> #{msgs.label_agentStatus} </f:facet>
									<h:outputText rendered="#{row.heldFlag == employeeAssignmentSearch.enumHeldStarted}" value="#{msgs.label_agentHeld}" />
									<h:outputText rendered="#{row.heldFlag == employeeAssignmentSearch.enumNotHeld}" style="color:red;" value="#{msgs.label_agentNonHeld}" />
									<h:outputText rendered="#{row.heldFlag == employeeAssignmentSearch.enumHeldNotStarted}" value="#{msgs.label_notStarted}" />
								</p:column>

								<p:column styleClass='centerText'>
									<f:facet name="header"> 
										#{msgs.label_taskAction}
									</f:facet>
									<h:commandButton styleClass="btn btn-success" value="#{msgs.label_assignmentEvaluation}" rendered="#{row.officerId == employeeAssignmentSearch.loginEmpData.empId and row.heldFlag == employeeAssignmentSearch.enumHeldStarted}" action="#{employeeAssignmentSearch.evaluateAgent(row)}" />
									<h:commandButton styleClass="btn btn-success" value="#{msgs.label_assignmentReAssign}" rendered="#{row.heldFlag == employeeAssignmentSearch.enumNotHeld}" action="#{employeeAssignmentSearch.reAssign(row)}" />
								</p:column>
							</p:dataTable>
						</h:panelGroup>
					</td>
				</tr>
			</table>

			<h:panelGroup id="dlgInfoPanelId">
				<p:dialog header="#{msgs.title_information}" id="dlgInfoId" widgetVar="dlgInfo" modal="true" height="200">
					<table width="100%">
						<tr>
							<td>
								<p:dataTable tableStyle="table-layout:auto" reflow="true" liveResize="true" paginatorPosition="bottom" paginator="true" style="width:100%" rowIndexVar="index" rows="10" var="employeeInfoRow" value="#{employeeAssignmentSearch.employeeInfosList}" rowHover="true">
									<p:column styleClass='centerText'>
										<f:facet name="header">
											#
										</f:facet>
                                    	#{index + 1}
                                  		</p:column>

									<p:column styleClass='centerText'>
										<f:facet name="header">
											#{msgs.label_infoNumber}
										</f:facet>
										<h:outputText value="#{employeeInfoRow.infoNumber}" />
									</p:column>

									<p:column styleClass='centerText'>
										<f:facet name="header">
											#{msgs.label_infoReceiveDate}
										</f:facet>
										<h:outputText value="#{employeeInfoRow.registerationDateString}" />
									</p:column>

									<p:column styleClass='centerText'>
										<f:facet name="header"> 
											#{msgs.label_infoNature}
										</f:facet>
										<h:inputTextarea disabled="true" value="#{employeeInfoRow.infoDetails}" />
									</p:column>

									<p:column styleClass='centerText'>
										<f:facet name="header"> 
											#{msgs.label_subject}
										</f:facet>
										<h:outputText value="#{employeeInfoRow.subjectDescription}" />
									</p:column>
								</p:dataTable>
							</td>
						</tr>
						<tr>
							<td colspan="5" height="10px"></td>
						</tr>
						<tr style="text-align: center">
							<td colspan="2">
								<h:commandButton styleClass="btn btn-danger" value="&#xf00d; #{msgs.label_close}" onclick="PF('dlgInfo').hide(); return false;">
								</h:commandButton>
							</td>
						</tr>
					</table>
				</p:dialog>
			</h:panelGroup>
		</ui:decorate>
	</h:form>
</h:body>
</html>