<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:p="http://primefaces.org/ui" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:f="http://java.sun.com/jsf/core" xmlns:util="http://java.sun.com/jsf/composite/util" xmlns:code="http://java.sun.com/jsf/composite/code">
<h:head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<h:outputStylesheet library="css" name="styles.css" />
	<h:outputStylesheet library="css" name="grid.css" />
	<h:outputStylesheet library="css" name="bootstrap.css" />
	<h:outputStylesheet library="css" name="buttonStyle.css" />
	<h:outputScript name="utilities.js" library="javascript" target="head" />
	<script type="text/javascript">
		window.onkeypress = function(e) {
			var keyCode = window.event.keyCode || e.keyCode || e.which;
			if (keyCode == '13') {
				document.getElementById('formId:searchInfoBtnID').click();
				return false;
			}
		};

		function selectConversation(callerId) {
			var idTokens = callerId.split(':');
			var conversationId = document.getElementById('formId:conversationListDataTableId:' + idTokens[2] + ':conversationId').value;
			returnVal = new Array();
			returnVal[0] = conversationId;
			window.returnValue = returnVal;

			window.opener.HandlePopupResult(returnVal);
			window.close();
			return true;
		}

		function getFollowUp(contextPath) {
			strDialogOptions = 'scrollbars=yes,resizable=yes,center=yes,dialogWidth=700px,dialogHeight=500px,help=no';
			maskScreen();
			window.open(contextPath + '/MiniSearch/FollowUpMiniSearch.jsf?isActive=' + null, 'FollowUpMiniSearch', strDialogOptions);
			return false;
		}

		function HandlePopupResult(ret) {
			unMaskScreen();
			debugger;
			if (ret != null) {
				document.getElementById('formId:selectedFollowUpIdId').value = ret[0];
				document.getElementById('formId:followUpCodeId').value = ret[1];
				return true;
			}
			return false;
		}

		function releaseMask() {
			unMaskScreen();
		}
		window.onunload = unloadPage;
		function unloadPage() {
			window.opener.releaseMask();

		}
	</script>
</h:head>
<h:body styleClass="screenBg" onunload="unloadPage();">
	<h:form id="formId" dir="#{msgs.dir}">
		<ui:decorate template="/Main/TemplateMiniSearch.xhtml">
			<table border="0" cellpadding="0" cellspacing="0" width="100%" class="bgcolor-pup">
				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td class="screenTitle">
						<h:outputText value="#{msgs.title_searchConversations}" />
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td width="100%">
						<h:panelGroup id="conversationSearchPanelId">
							<table class="sectionContent" border="0" cellpadding="0" cellspacing="0">
								<tr>
									<th width="15%">#{msgs.label_followUpCode}</th>
									<td width="20%">
										<h:inputText style="width:90%" disabled="true" id="followUpCodeId" value="#{conversationMiniSearch.followUpCode}" />
										<h:inputHidden id="selectedFollowUpIdId" value="#{conversationMiniSearch.followUpId}" />
									</td>
									<th width="15%"></th>
									<td width="20%"></td>
								</tr>
								<tr>
									<th width="15%">
										<h:outputText value="#{msgs.label_conversationType}" />
									</th>
									<td width="20%">
										<h:selectOneMenu value="#{conversationMiniSearch.selectedConversationType}" styleClass="form-control">
											<f:selectItem noSelectionOption="true" itemLabel="#{msgs.label_all}" itemValue="-1" />
											<f:selectItem itemLabel="#{msgs.label_direct}" itemValue="0" />
											<f:selectItem itemLabel="#{msgs.label_injection}" itemValue="1" />
										</h:selectOneMenu>
									</td>
									<th width="15%">
										<h:outputText value="#{msgs.label_conversationResult}" />
									</th>
									<td width="20%">
										<h:selectOneMenu id="conversationResultId" value="#{conversationMiniSearch.selectedConversationResult}" styleClass="form-control">
											<f:selectItem itemLabel="#{msgs.label_all}" itemValue="-1" />
											<f:selectItem itemLabel="#{msgs.label_negative}" itemValue="0" />
											<f:selectItem itemLabel="#{msgs.label_positive}" itemValue="1" />
										</h:selectOneMenu>
									</td>
								</tr>
								<tr>
									<th width="15%">
										<h:outputText value="#{msgs.label_conversationFromDate}" />
									</th>
									<td width="20%">
										<util:advancedHijriDate value="#{conversationMiniSearch.fromDate}" />
									</td>
									<th width="15%">
										<h:outputText value="#{msgs.label_conversationToDate}" />
									</th>
									<td width="20%">
										<util:advancedHijriDate value="#{conversationMiniSearch.toDate}" />
									</td>
								</tr>
								<tr>
									<th width="15%">
										<h:outputText value="#{msgs.label_conversationLocation}" />
									</th>
									<td width="20%" rowspan="2">
										<code:coordinates latitude="#{conversationMiniSearch.coordinateLatitude}" longitude="#{conversationMiniSearch.coordinateLongitude}" />
									</td>

									<th width="15%">
										<h:outputText value="#{msgs.label_conversationContactNumber}" />
										<h:outputText value="*" style="color:red;" />
									</th>
									<td width="20%">
										<h:inputText styleClass="form-control" maxlength="10" onblur="return isPhoneNumber(this)" onkeypress="return checkPhoneNumber(event);" value="#{conversationMiniSearch.selectedConversationPartyContactNum}" style="width: 75%;margin-left: 5px;" />
									</td>
								</tr>
							</table>
						</h:panelGroup>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td>
						<h:panelGroup>
							<table class="actionsSection" border="0" cellpadding="0" cellspacing="0">
								<tr>
									<td>
										<h:commandButton id="searchInfoBtnID" styleClass="btn btn-default" action="#{conversationMiniSearch.searchConversations()}" value="&#xf002; #{msgs.label_search}">
											<f:ajax render="formId:conversationsListId" execute="formId:conversationSearchPanelId" />
										</h:commandButton>
									</td>
								</tr>
							</table>
						</h:panelGroup>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

				<tr>
					<td width="100%">
						<h:panelGroup id="conversationsListId">
							<p:dataTable sortMode="multiple" reflow="true" tableStyle="table-layout: auto" paginator="true" id="conversationListDataTableId" rows="#{conversationMiniSearch.rowsCount}" rowIndexVar="index" var="row" value="#{conversationMiniSearch.conversationDataList}" rowHover="true">
								<p:column style="text-align: center;">
									<f:facet name="header"> # </f:facet>
                                #{index + 1}
                                <h:inputHidden id="conversationId" value="#{row.id}" />
								</p:column>
								<p:column styleClass='centerText'>
									<f:facet name="header"> #{msgs.label_dateAndTime} </f:facet>
									<h:outputText value="#{row.conversationDateString} #{row.conversationTime}" />
								</p:column>
								<p:column styleClass='centerText'>
									<f:facet name="header"> #{msgs.label_phoneAndName} </f:facet>
									<h:outputText value="#{row.partiesAndNames}" />
								</p:column>
								<p:column styleClass='centerText'>
									<f:facet name="header"> #{msgs.label_conversationLocation} </f:facet>
									<h:outputText value="#{row.conversationLocation}" />
								</p:column>
								<p:column styleClass='centerText'>
									<f:facet name="header"> #{msgs.label_directOrInjection} </f:facet>
									<h:outputText rendered="#{row.conversationType == 0}" value="#{msgs.title_direct}" />
									<h:outputText rendered="#{row.conversationType == 1}" value="#{msgs.title_inject}" />
								</p:column>
								<p:column>
									<f:facet name="header"> #{msgs.label_select} </f:facet>
									<h:commandButton onclick="selectConversation(this.id);" title="#{msgs.label_select}" image="/resources/images/select.png" />
								</p:column>
							</p:dataTable>
						</h:panelGroup>
					</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>

			</table>
		</ui:decorate>
	</h:form>
</h:body>
</html>