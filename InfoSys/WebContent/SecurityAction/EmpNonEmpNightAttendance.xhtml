<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:p="http://primefaces.org/ui" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:f="http://java.sun.com/jsf/core" xmlns:util="http://java.sun.com/jsf/composite/util">
<h:head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<h:outputStylesheet library="css" name="styles.css" />
	<h:outputStylesheet library="css" name="grid.css" />
	<h:outputStylesheet library="css" name="bootstrap.css" />

	<h:outputScript name="utilities.js" library="javascript" target="head" />
	<script type="text/javascript">
		var m;
		var index;
		var inOut;

		function getNonEmployee(contextPath, mode) {
			m = mode;
			openNonEmpsMiniSearch(contextPath);
			return false;
		}

		function updateIndex(callerId) {
			var idTokens = callerId.split(':');
			index = idTokens[2];
		}

		function getCarPermits(contextPath, empNonEmpFlag, empNonEmpId, mode) {
			m = mode;
			openCarPermitsMiniSearch(contextPath, empNonEmpFlag, empNonEmpId);
			return false;
		}

		function releaseMask() {
			unMaskScreen();
		}

		function HandlePopupResult(ret) {
			unMaskScreen();
			if (ret != null) {
				if (m == 1) {
					document.getElementById('formId:selectedNonEmpHiddenId').value = ret[0];
					document.getElementById('formId:entryHiddenBtnId').click();
					return true;
				} else if (m == 2) {
					document.getElementById('formId:selectedNonEmpHiddenId').value = ret[0];
					document.getElementById('formId:exitHiddenBtnId').click();
					return true;
				} else if (m == 3) {
					document.getElementById('formId:attendanceDetailsListId:'
							+ index + ':' + 'empNonEmpCarHiddenId').value = ret[0];

					document.getElementById('formId:attendanceDetailsListId:'
							+ index + ':' + 'domainCarModelHiddenId').value = ret[1];

					document.getElementById('formId:attendanceDetailsListId:'
							+ index + ':' + 'carModelHiddenId').value = ret[2];
					document.getElementById('formId:attendanceDetailsListId:'
							+ index + ':' + 'carModelId').innerHTML = ret[2];

					document.getElementById('formId:attendanceDetailsListId:'
							+ index + ':' + 'plateNumberId').innerHTML = ret[3];
					document.getElementById('formId:attendanceDetailsListId:'
							+ index + ':' + 'plateNumberHiddenId').value = ret[3];

					document.getElementById('formId:attendanceDetailsListId:'
							+ index + ':' + 'permitNoId').innerHTML = ret[4];
					document.getElementById('formId:attendanceDetailsListId:'
							+ index + ':' + 'permitNoHiddenId').value = ret[4];

					document.getElementById('formId:updateCarAttObj').click();

				}
			}
			return false;
		}

		function confirmDialog(data) {
			var showMsg = document.getElementById('formId:showMsgHiddenId').value;
			if (data.status == 'success') {
				if (showMsg == '1') {
					PF('confrimEntryCd').show();
				} else if (showMsg == '2') {
					getNonEmployee('#{request.contextPath}', 1)
				}
				document.getElementById('formId:entryId').focus();
			}
			return true;
		}

		function confirmDialogExit(data) {
			var showMsg = document.getElementById('formId:showMsgHiddenId').value;
			if (data.status == 'success') {
				if (showMsg == '1') {
					PF('confrimExitCd').show();
				} else if (showMsg == '2') {
					getNonEmployee('#{request.contextPath}', 2)
				}
				document.getElementById('formId:exitId').focus();
			}
			return true;
		}

		function enter(event) {
			if (event.which == 13 || event.keyCode == 13) {
				if (inOut) {
					if (inOut === 1) {
						document.getElementById('formId:entryBtnId').click();
					} else if (inOut === 2) {
						document.getElementById('formId:exitBtnId').click();
					} else {
						event.preventDefault();
						return false;
					}
				}
			}
			return true;
		};
	</script>
</h:head>
<h:body styleClass="screenBg">
	<h:form id="formId" dir="#{msgs.dir}" onkeypress="return enter(event)">
		<ui:decorate template="/Main/Template.xhtml">
			<table border="0" cellpadding="0" cellspacing="0" width="100%">
				<tr>
					<td class="screenTitle">#{msgs.title_empNonEmpNightAttendance}</td>
				</tr>

				<tr>
					<td width="100%" height="5" />
				</tr>
				
				<tr>
					<td>
						<table class="sectionContent" border="0" cellpadding="0" cellspacing="0">
							<tr>
								<th width="15%">#{msgs.label_region}</th>
								<td width="35%">
									<h:outputText value="#{employeeNonEmployeeNightAttendance.loginEmpRegionName}" />
								</td>

							</tr>
							<tr>
								<td colspan="5" width="100%">
									<table width="100%">
										<tr>
											<th width="45%" class="green-a">#{msgs.label_newEntryRegister}</th>

											<th width="45%" class="red-a">#{msgs.label_newExitRegister}</th>
										</tr>
									</table>
								</td>
							</tr>
							<tr>
								<th width="10%">
									#{msgs.label_socialId}
									<h:outputText value="*" style="color:red;" />
								</th>
								<td width="35%">
									<h:inputText id="entryId" styleClass="form-control inputnumber" value="#{employeeNonEmployeeNightAttendance.entrySocialId}" maxlength="10" onkeypress="return checkDigit(event)" onmousedown="inOut = 1" />
									<h:commandButton id="entryBtnId" styleClass="btn btn-default" style="background-color: green!important;" value="#{msgs.label_newEntryRegister}" action="#{employeeNonEmployeeNightAttendance.validateSocialId(1)}">
										<f:ajax render="formId:entryId formId:entryConfirmId formId:showMsgHiddenId formId:attendanceDetailsListId" execute="formId:entryId" onevent="confirmDialog" />
									</h:commandButton>
									<h:inputHidden value="#{employeeNonEmployeeNightAttendance.showMsg}" id="showMsgHiddenId" />
									<h:inputHidden value="#{employeeNonEmployeeNightAttendance.selectedNonEmployeeId}" id="selectedNonEmpHiddenId" />
									<h:commandButton id="entryHiddenBtnId" style="display:none;" action="#{employeeNonEmployeeNightAttendance.entryRegister()}">
										<f:ajax execute="formId:selectedNonEmpHiddenId" render="formId:entryId formId:attendanceDetailsListId" />
									</h:commandButton>
									<p:confirmDialog id="entryConfirmId" closable="false" message="#{employeeNonEmployeeNightAttendance.errorMsg}" severity="alert" widgetVar="confrimEntryCd">
										<h:commandButton styleClass="btn btn-default" value="#{msgs.label_yes}" action="#{employeeNonEmployeeNightAttendance.entryRegister()}" onclick="PF('confrimEntryCd').hide();  document.getElementById('formId:entryId').focus();">
											<f:ajax render="formId:entryId formId:attendanceDetailsListId formId:showMsgHiddenId" />
										</h:commandButton>
										<h:commandButton styleClass="btn btn-default" value="#{msgs.label_no}" action="#{employeeNonEmployeeNightAttendance.reset()}" onclick="PF('confrimEntryCd').hide(); document.getElementById('formId:entryId').focus();">
											<f:ajax execute="@this" render="formId:entryId formId:showMsgHiddenId" />
										</h:commandButton>
									</p:confirmDialog>
								</td>
								<td width="10%" />
								<th width="10%">
									#{msgs.label_socialId}
									<h:outputText value="*" style="color:red;" />
								</th>
								<td width="35%">
									<h:inputText id="exitId" styleClass="form-control inputnumber" value="#{employeeNonEmployeeNightAttendance.exitSocialId}" maxlength="10" onkeypress="return checkDigit(event)" onmousedown="inOut = 2" />
									<h:commandButton id="exitBtnId" styleClass="btn btn-default" style="background-color: red!important;" value="#{msgs.label_newExitRegister}" action="#{employeeNonEmployeeNightAttendance.validateSocialId(2)}">
										<f:ajax render="formId:exitId formId:exitConfirmId formId:showMsgHiddenId formId:attendanceDetailsListId" execute="formId:exitId" onevent="confirmDialogExit" />
									</h:commandButton>
									<h:commandButton id="exitHiddenBtnId" style="display:none;" action="#{employeeNonEmployeeNightAttendance.exitRegister()}">
										<f:ajax execute="formId:selectedNonEmpHiddenId" render="formId:exitId formId:attendanceDetailsListId" />
									</h:commandButton>
									<p:confirmDialog id="exitConfirmId" closable="false" message="#{employeeNonEmployeeNightAttendance.errorMsg}" severity="alert" widgetVar="confrimExitCd">
										<h:commandButton styleClass="btn btn-default" value="#{msgs.label_yes}" action="#{employeeNonEmployeeNightAttendance.exitRegister()}" onclick="PF('confrimExitCd').hide(); document.getElementById('formId:exitId').focus();">
											<f:ajax render="formId:exitId formId:attendanceDetailsListId formId:showMsgHiddenId" />
										</h:commandButton>
										<h:commandButton styleClass="btn btn-default" value="#{msgs.label_no}" action="#{employeeNonEmployeeNightAttendance.reset()}" onclick="PF('confrimExitCd').hide();  document.getElementById('formId:exitId').focus();">
											<f:ajax execute="@this" render="formId:exitId formId:showMsgHiddenId" />
										</h:commandButton>
									</p:confirmDialog>
								</td>
							</tr>

							<tr>
								<td colspan="5" width="75%">
									<h:commandButton id="updateCarAttObj" style="display : none ;" action="#{employeeNonEmployeeNightAttendance.updateAttendanceCar()}">
										<f:ajax execute="formId:attendanceDetailsListId" render="formId:attendanceDetailsListId" />
									</h:commandButton>
									<p:dataTable id="attendanceDetailsListId" paginator="true" style="width:100%" tableStyle="table-layout:auto" reflow="true" rows="10" liveResize="true" paginatorPosition="bottom" rowIndexVar="attendanceDtlsindex" var="attendanceDtl" value="#{employeeNonEmployeeNightAttendance.employeeNonEmployeeAttendanceDetailsList}" widgetVar="attendanceDetailsTable" rowHover="true">
										<p:columnGroup type="header">
											<p:row>
												<p:column colspan="8" headerText="#{msgs.label_personsDetails}" />
												<p:column colspan="4" headerText="#{msgs.label_carsDetails}" />
											</p:row>
											<p:row>
												<p:column headerText="#" />
												<p:column headerText="#{msgs.label_name}" />
												<p:column headerText="#{msgs.label_identity}" />
												<p:column headerText="#{msgs.label_entryTime}" />
												<p:column headerText="#{msgs.label_entryDate}" />
												<p:column headerText="#{msgs.label_exitTime}" />
												<p:column headerText="#{msgs.label_exitDate}" />
												<p:column headerText="#{msgs.label_visitorCardNumber}" />
												<p:column headerText="#{msgs.label_carModelDescription}" />
												<p:column headerText="#{msgs.label_plateNumber}" />
												<p:column headerText="#{msgs.label_permitNo}" />
												<p:column headerText="#{msgs.label_cars}" />
											</p:row>
										</p:columnGroup>
										<p:column styleClass='centerText'>
			                                    	#{attendanceDtlsindex + 1}
		                                   		</p:column>
										<p:column styleClass='centerText'>
											<h:commandLink action="#{employeeNonEmployeeNightAttendance.selectCar(attendanceDtl)}" value="#{attendanceDtl.fullName}">
												<f:ajax render="formId:employeeDetailPanelId" onevent="function(e){if(e.status == 'success') PF('dlg').show();}" />
											</h:commandLink>
										</p:column>
										<p:column styleClass='centerText'>
											<h:outputText value="#{attendanceDtl.socialId}" />
										</p:column>
										<p:column styleClass='centerText'>
											<h:outputText value="#{attendanceDtl.entryTime}" />
										</p:column>
										<p:column styleClass='centerText'>
											<h:outputText value="#{attendanceDtl.entryDateString}" />
										</p:column>
										<p:column styleClass='centerText'>
											<h:outputText value="#{attendanceDtl.exitTime}" />
										</p:column>
										<p:column styleClass='centerText'>
											<h:outputText value="#{attendanceDtl.exitDateString}" />
										</p:column>
										<p:column styleClass='centerText'>
											<h:outputText value="#{attendanceDtl.visitorCardNumber}" />
										</p:column>
										<p:column styleClass='centerText'>
											<h:outputText id="carModelId" value="#{attendanceDtl.carModel}" />
											<h:inputHidden id="carModelHiddenId" value="#{attendanceDtl.carModel}" />
											<h:inputHidden id="domainCarModelHiddenId" value="#{attendanceDtl.domainCarModelId}" />
											<h:inputHidden id="empNonEmpCarHiddenId" value="#{attendanceDtl.empNonEmpCarsId}" />
										</p:column>
										<p:column styleClass='centerText'>
											<h:outputText id="plateNumberId" value="#{attendanceDtl.plateNumber}" />
											<h:inputHidden id="plateNumberHiddenId" value="#{attendanceDtl.plateNumber}" />
										</p:column>
										<p:column styleClass='centerText'>
											<h:outputText id="permitNoId" value="#{attendanceDtl.permitNo}" />
											<h:inputHidden id="permitNoHiddenId" value="#{attendanceDtl.permitNo}" />
										</p:column>
										<p:column styleClass='centerText'>
											<h:commandButton rendered="#{employeeNonEmployeeNightAttendance.canUpdateCar or empty attendanceDtl.empNonEmpCarsId}" styleClass="btn btn-default" id="carPermitsButtonId" value="#{msgs.label_carDetails}" onclick="updateIndex(this.id);" action="#{employeeNonEmployeeNightAttendance.selectCar(attendanceDtl)}">
												<f:ajax onevent="function(e){if(e.status == 'success') getCarPermits('#{request.contextPath}', #{attendanceDtl.employeeId == null ? false : true }, #{attendanceDtl.employeeId == null ? attendanceDtl.nonEmployeeId : attendanceDtl.employeeId}, 3);}" />
											</h:commandButton>
										</p:column>
									</p:dataTable>
								</td>
							</tr>
						</table>
					</td>
				</tr>
			</table>
			<h:panelGroup id="employeeDetailPanelId">
				<p:dialog dir="#{msgs.dir}" header="#{msgs.label_employees}" id="dlgId" widgetVar="dlg" modal="true" height="180px;" width="720px">
					<h:panelGroup id="internalDlgPanelId">
						<table class="sectionContent" border="0" cellpadding="0" cellspacing="0">
							<tr>
								<th width="15%">#{msgs.label_name}</th>
								<td>
									<h:outputText value="#{employeeNonEmployeeNightAttendance.selectedCar.fullName}" />
								</td>
								<th width="15%">#{msgs.label_identity}</th>
								<td>
									<h:outputText value="#{employeeNonEmployeeNightAttendance.selectedCar.socialId}" />
								</td>
							</tr>
							<tr>
								<th width="15%">#{msgs.label_unitDep}</th>
								<td>
									<h:outputText value="#{employeeNonEmployeeNightAttendance.selectedCar.departmentName}" />
								</td>
								<th width="15%">#{msgs.label_nationality}</th>
								<td>
									<h:outputText value="#{employeeNonEmployeeNightAttendance.selectedCar.nationality}" />
								</td>
							</tr>
							<tr>
								<th width="15%">#{msgs.label_rank}</th>
								<td>
									<h:outputText value="#{employeeNonEmployeeNightAttendance.selectedCar.rank}" />
								</td>
								<th width="15%">#{msgs.label_mobileNo}</th>
								<td>
									<h:outputText value="#{employeeNonEmployeeNightAttendance.selectedCar.mobileNo}" />
								</td>
							</tr>
							<tr>
								<th width="15%">#{msgs.label_telExt}</th>
								<td>
									<h:outputText value="#{employeeNonEmployeeNightAttendance.selectedCar.telephoneExt}" />
								</td>


							</tr>
						</table>
					</h:panelGroup>
				</p:dialog>
			</h:panelGroup>
		</ui:decorate>
	</h:form>
</h:body>
</html>